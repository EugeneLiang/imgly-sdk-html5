require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){(function(global){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},ImglyKit=_interopRequire(require("./src/js/imglykit"));!function(){"undefined"!=typeof window?window.ImglyKit=ImglyKit:"undefined"!=typeof module?module.exports=ImglyKit:"undefined"!=typeof global&&(global.ImglyKit=ImglyKit)}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/js/imglykit":43}],2:[function(require,module){"use strict";module.exports=function(Promise){function any(promises){var ret=new SomePromiseArray(promises),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise)}var SomePromiseArray=Promise._SomePromiseArray;Promise.any=function(promises){return any(promises)},Promise.prototype.any=function(){return any(this)}}},{}],3:[function(require,module){(function(process){"use strict";function Async(){this._isTickUsed=!1,this._lateQueue=new Queue(16),this._normalQueue=new Queue(16);var self=this;this.drainQueues=function(){self._drainQueues()},this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule}var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=require("./schedule.js"),Queue=require("./queue.js"),_process="undefined"!=typeof process?process:void 0;Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},Async.prototype._withDomain=function(fn){return void 0===_process||null==_process.domain||fn.domain||(fn=_process.domain.bind(fn)),fn},Async.prototype.throwLater=function(fn,arg){if(1===arguments.length&&(arg=fn,fn=function(){throw arg}),fn=this._withDomain(fn),"undefined"!=typeof setTimeout)setTimeout(function(){fn(arg)},0);else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},Async.prototype.invokeLater=function(fn,receiver,arg){fn=this._withDomain(fn),this._lateQueue.push(fn,receiver,arg),this._queueTick()},Async.prototype.invokeFirst=function(fn,receiver,arg){fn=this._withDomain(fn),this._normalQueue.unshift(fn,receiver,arg),this._queueTick()},Async.prototype.invoke=function(fn,receiver,arg){fn=this._withDomain(fn),this._normalQueue.push(fn,receiver,arg),this._queueTick()},Async.prototype.settlePromises=function(promise){this._normalQueue._pushOne(promise),this._queueTick()},Async.prototype._drainQueue=function(queue){for(;queue.length()>0;){var fn=queue.shift();if("function"==typeof fn){var receiver=queue.shift(),arg=queue.shift();fn.call(receiver,arg)}else fn._settlePromises()}},Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},Async.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},Async.prototype._reset=function(){this._isTickUsed=!1},module.exports=new Async,module.exports.firstLineError=firstLineError}).call(this,require("_process"))},{"./queue.js":26,"./schedule.js":29,_process:39}],4:[function(require,module){"use strict";function noConflict(){try{Promise===bluebird&&(Promise=old)}catch(e){}return bluebird}var old;"undefined"!=typeof Promise&&(old=Promise);var bluebird=require("./promise.js")();bluebird.noConflict=noConflict,module.exports=bluebird},{"./promise.js":21}],5:[function(require,module){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null),getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){function makeMethodCaller(methodName){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,methodName))}function makeGetter(propertyName){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",propertyName))}function getCompiled(name,compiler,cache){var ret=cache[name];if("function"!=typeof ret){if(!isIdentifier(name))return null;if(ret=compiler(name),cache[name]=ret,cache[" size"]++,cache[" size"]>512){for(var keys=Object.keys(cache),i=0;256>i;++i)delete cache[keys[i]];cache[" size"]=keys.length-256}}return ret}function getMethodCaller(name){return getCompiled(name,makeMethodCaller,callerCache)}function getGetter(name){return getCompiled(name,makeGetter,getterCache)}function caller(obj){return obj[this.pop()].apply(obj,this)}function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;return 0>index&&(index=Math.max(0,index+obj.length)),obj[index]}var util=require("./util.js"),canEvaluate=util.canEvaluate,isIdentifier=util.isIdentifier;Promise.prototype.call=function(methodName){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];if(canEvaluate){var maybeCaller=getMethodCaller(methodName);if(null!==maybeCaller)return this._then(maybeCaller,void 0,void 0,args,void 0)}return args.push(methodName),this._then(caller,void 0,void 0,args,void 0)},Promise.prototype.get=function(propertyName){var getter,isIndex="number"==typeof propertyName;if(isIndex)getter=indexedGetter;else if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=null!==maybeGetter?maybeGetter:namedGetter}else getter=namedGetter;return this._then(getter,void 0,void 0,propertyName,void 0)}}},{"./util.js":36}],6:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL){var errors=require("./errors.js"),async=require("./async.js"),CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;for(var parent,promiseToReject=this;void 0!==(parent=promiseToReject._cancellationParent)&&parent.isCancellable();)promiseToReject=parent;this._unsetCancellable();var trace=errors.ensureErrorObject(reason);promiseToReject._attachExtraTrace(trace),promiseToReject._target()._rejectUnchecked(reason,trace)},Promise.prototype.cancel=function(reason){return this.isCancellable()?(void 0===reason&&(reason=new CancellationError),async.invokeLater(this._cancel,this,reason),this):this},Promise.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},Promise.prototype.uncancellable=function(){var ret=new Promise(INTERNAL);return ret._propagateFrom(this,4),ret._follow(this),ret._unsetCancellable(),ret},Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,void 0,void 0);return ret._setCancellable(),ret._cancellationParent=void 0,ret}}},{"./async.js":3,"./errors.js":11}],7:[function(require,module){(function(process){"use strict";module.exports=function(){function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(void 0===parent?0:parent._length);captureStackTrace(this,CapturedTrace),length>32&&this.uncycle()}function protectErrorMessageNewlines(stack){for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line))break}if(1>=i)return 1;for(var errorMessageLines=[],j=0;i>j;++j)errorMessageLines.push(stack.shift());return stack.unshift(errorMessageLines.join("\x00")),i}function unProtectNewlines(stack){return stack.length>0&&(stack[0]=stack[0].split("\x00").join("\n"),"From previous event:"===stack[stack.length-1]&&stack.pop()),stack}function clean(stack,initialIndex){for(var ret=stack.slice(0,initialIndex),i=initialIndex;i<stack.length;++i){var line=stack[i],isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line,isInternalFrame=isTraceLine&&shouldIgnore(line);isTraceLine&&!isInternalFrame&&ret.push(line)}return ret}function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str))try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;return str.length<maxChars?str:str.substr(0,maxChars-3)+"..."}function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);return matches?{fileName:matches[1],line:parseInt(matches[2],10)}:void 0}var async=require("./async.js"),inherits=require("./util.js").inherits,bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/,stackFramePattern=null,formatStack=null;inherits(CapturedTrace,Error),CapturedTrace.prototype.uncycle=function(){var length=this._length;if(!(2>length)){for(var nodes=[],stackToIndex={},i=0,node=this;void 0!==node;++i)nodes.push(node),node=node._parent;length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;void 0===stackToIndex[stack]&&(stackToIndex[stack]=i)}for(var i=0;length>i;++i){var currentStack=nodes[i].stack,index=stackToIndex[currentStack];if(void 0!==index&&index!==i){index>0&&(nodes[index-1]._parent=void 0,nodes[index-1]._length=1),nodes[i]._parent=void 0,nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;length-1>index?(cycleEdgeNode._parent=nodes[index+1],cycleEdgeNode._parent.uncycle(),cycleEdgeNode._length=cycleEdgeNode._parent._length+1):(cycleEdgeNode._parent=void 0,cycleEdgeNode._length=1);for(var currentChildLength=cycleEdgeNode._length+1,j=i-2;j>=0;--j)nodes[j]._length=currentChildLength,currentChildLength++;return}}}},CapturedTrace.prototype.parent=function(){return this._parent},CapturedTrace.prototype.hasParent=function(){return void 0!==this._parent},CapturedTrace.prototype.attachExtraTrace=function(error){if(!error.__stackCleaned__){this.uncycle();var trace=this,stack=CapturedTrace.cleanStack(error,!1),headerLineCount=1,combinedTraces=1;do stack=trace.combine(stack),combinedTraces++;while(null!=(trace=trace.parent()));stack=unProtectNewlines(stack),error.stack=stack.length<=headerLineCount?"(No stack trace)":stack.join("\n")}},CapturedTrace.prototype.combine=function(current){for(var prev=clean(this.stack.split("\n"),0),currentLastIndex=current.length-1,currentLastLine=current[currentLastIndex],commonRootMeetPoint=-1,i=prev.length-1;i>=0;--i)if(prev[i]===currentLastLine){commonRootMeetPoint=i;break}for(var i=commonRootMeetPoint;i>=0;--i){var line=prev[i];if(current[currentLastIndex]!==line)break;current.pop(),currentLastIndex--}return"From previous event:"!==current[current.length-1]&&current.push("From previous event:"),current.concat(prev)},CapturedTrace.cleanStack=function(error,shouldUnProtectNewlines){if(!error.__stackCleaned__){error.__stackCleaned__=!0;var stack=error.stack;stack="string"==typeof stack?stack.split("\n"):[error.toString(),"    (No stack trace)"];var initialIndex=protectErrorMessageNewlines(stack);return stack=clean(stack,initialIndex),shouldUnProtectNewlines&&(stack=unProtectNewlines(stack)),error.stack=stack.join("\n"),stack}},CapturedTrace.formatAndLogError=function(error,title){if("object"==typeof console){var message;if("object"==typeof error||"function"==typeof error){var stack=error.stack;message=title+formatStack(stack,error)}else message=title+String(error);"function"==typeof console.warn||"object"==typeof console.warn?console.warn(message):("function"==typeof console.log||"object"==typeof console.log)&&console.log(message)}},CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ")},CapturedTrace.isSupported=function(){return"function"==typeof captureStackTrace},CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=!1;try{"function"==typeof localHandler&&(localEventFired=!0,"rejectionHandled"===name?localHandler(promise):localHandler(reason,promise))}catch(e){async.throwLater(e)}var globalEventFired=!1;try{globalEventFired=fireGlobalEvent(name,reason,promise)}catch(e){globalEventFired=!0,async.throwLater(e)}globalEventFired||localEventFired||"unhandledRejection"!==name||CapturedTrace.formatAndLogError(reason,"Possibly unhandled ")};var shouldIgnore=function(){return!1},parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;CapturedTrace.setBounds=function(firstLineError,lastLineError){if(CapturedTrace.isSupported()){for(var firstFileName,lastFileName,firstStackLines=firstLineError.stack.split("\n"),lastStackLines=lastLineError.stack.split("\n"),firstIndex=-1,lastIndex=-1,i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName,firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName,lastIndex=result.line;break}}0>firstIndex||0>lastIndex||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex||(shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return!0;var info=parseLineInfo(line);return info&&info.fileName===firstFileName&&firstIndex<=info.line&&info.line<=lastIndex?!0:!1})}};var captureStackTrace=function stackDetection(){var v8stackFramePattern=/^\s*at\s*/,v8stackFormatter=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;return shouldIgnore=function(line){return bluebirdFramePattern.test(line)},function(receiver,ignoreUntil){captureStackTrace(receiver,ignoreUntil)}}var err=new Error;if("string"==typeof err.stack&&"function"==typeof"".startsWith&&err.stack.startsWith("stackDetection@")&&"stackDetection"===stackDetection.name){stackFramePattern=/@/;var rline=/[@\n]/;return formatStack=function(stack,error){return"string"==typeof stack?error.name+". "+error.message+"\n"+stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)},function(o){for(var stack=(new Error).stack,split=stack.split(rline),len=split.length,ret="",i=0;len>i;i+=2)ret+=split[i],ret+="@",ret+=split[i+1],ret+="\n";o.stack=ret}}var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}return"stack"in err||!hasStackAfterThrow?(formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.name+". "+error.message},null):(stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter,function(o){try{throw new Error}catch(e){o.stack=e.stack}})}(),fireGlobalEvent=function(){if("undefined"!=typeof process&&"string"==typeof process.version&&"undefined"==typeof window)return function(name,reason,promise){return"rejectionHandled"===name?process.emit(name,promise):process.emit(name,reason,promise)};var toWindowMethodNameMap={};return toWindowMethodNameMap.unhandledRejection="onunhandledRejection".toLowerCase(),toWindowMethodNameMap.rejectionHandled="onrejectionHandled".toLowerCase(),function(name,reason,promise){var methodName=toWindowMethodNameMap[name],method=window[methodName];return method?("rejectionHandled"===name?method.call(window,promise):method.call(window,reason,promise),!0):!1}}();return CapturedTrace}}).call(this,require("_process"))},{"./async.js":3,"./util.js":36,_process:39}],8:[function(require,module){"use strict";module.exports=function(NEXT_FILTER){function CatchFilter(instances,callback,promise){this._instances=instances,this._callback=callback,this._promise=promise}function safePredicate(predicate,e){var safeObject={},retfilter=tryCatch1(predicate,safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);return safeKeys.length?(errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),errorObj):retfilter}var util=require("./util.js"),errors=require("./errors.js"),tryCatch1=util.tryCatch1,errorObj=util.errorObj,keys=require("./es5.js").keys,TypeError=errors.TypeError;return CatchFilter.prototype.doFilter=function(e){for(var cb=this._callback,promise=this._promise,boundTo=promise._boundTo,i=0,len=this._instances.length;len>i;++i){var item=this._instances[i],itemIsErrorType=item===Error||null!=item&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch1(cb,boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}if("function"==typeof item&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){var trace=errors.canAttachTrace(errorObj.e)?errorObj.e:new Error(util.toString(errorObj.e));this._promise._attachExtraTrace(trace),e=errorObj.e;break}if(shouldHandle){var ret=tryCatch1(cb,boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}}}return NEXT_FILTER.e=e,NEXT_FILTER},CatchFilter}},{"./errors.js":11,"./es5.js":13,"./util.js":36}],9:[function(require,module){"use strict";var util=require("./util.js"),isPrimitive=util.isPrimitive,wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;module.exports=function(Promise){var returner=function(){return this},thrower=function(){throw this},wrapper=function(value,action){return 1===action?function(){throw value}:2===action?function(){return value}:void 0};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){return wrapsPrimitiveReceiver&&isPrimitive(value)?this._then(wrapper(value,2),void 0,void 0,void 0,void 0):this._then(returner,void 0,void 0,value,void 0)},Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return wrapsPrimitiveReceiver&&isPrimitive(reason)?this._then(wrapper(reason,1),void 0,void 0,void 0,void 0):this._then(thrower,void 0,void 0,reason,void 0)}}},{"./util.js":36}],10:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,null,INTERNAL)},Promise.each=function(promises,fn){return PromiseReduce(promises,fn,null,INTERNAL)}}},{}],11:[function(require,module){"use strict";function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch(ignore){}}function originatesFromRejection(e){return null==e?!1:e instanceof OperationalError||e.isOperational===!0}function isError(obj){return obj instanceof Error}function canAttachTrace(obj){return isError(obj)&&propertyIsWritable(obj,"stack")}function subError(nameProperty,defaultMessage){function SubError(message){return this instanceof SubError?(notEnumerableProp(this,"message","string"==typeof message?message:defaultMessage),notEnumerableProp(this,"name",nameProperty),void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new SubError(message)}return inherits(SubError,Error),SubError}function OperationalError(message){notEnumerableProp(this,"name","OperationalError"),notEnumerableProp(this,"message",message),this.cause=message,this.isOperational=!0,message instanceof Error?(notEnumerableProp(this,"message",message.message),notEnumerableProp(this,"stack",message.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var _TypeError,_RangeError,Objectfreeze=require("./es5.js").freeze,propertyIsWritable=require("./es5.js").propertyIsWritable,util=require("./util.js"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error"),AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError,_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error"),_RangeError=subError("RangeError","range error")}for(var methods="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<methods.length;++i)"function"==typeof Array.prototype[methods[i]]&&(AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]);AggregateError.prototype.length=0,AggregateError.prototype.isOperational=!0;var level=0;AggregateError.prototype.toString=function(){var indent=Array(4*level+1).join(" "),ret="\n"+indent+"AggregateError of:\n";level++,indent=Array(4*level+1).join(" ");for(var i=0;i<this.length;++i){for(var str=this[i]===this?"[Circular AggregateError]":this[i]+"",lines=str.split("\n"),j=0;j<lines.length;++j)lines[j]=indent+lines[j];str=lines.join("\n"),ret+=str+"\n"}return level--,ret},inherits(OperationalError,Error);var key="__BluebirdErrorTypes__",errorTypes=Error[key];errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError}),notEnumerableProp(Error,key,errorTypes));var ensureErrorObject=function(){return"stack"in new Error?function(value){return canAttachTrace(value)?value:new Error(util.toString(value))}:function(value){if(canAttachTrace(value))return value;try{throw new Error(util.toString(value))}catch(err){return err}}}();module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject}},{"./es5.js":13,"./util.js":36}],12:[function(require,module){"use strict";module.exports=function(Promise){function apiRejection(msg){var error=new TypeError(msg),ret=Promise.reject(error),parent=ret._peekContext();return null!=parent&&parent.attachExtraTrace(error),ret}var TypeError=require("./errors.js").TypeError;return apiRejection}},{"./errors.js":11}],13:[function(require,module){var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!(descriptor&&!descriptor.writable&&!descriptor.set)}};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype,ObjectKeys=function(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret},ObjectDefineProperty=function(o,key,desc){return o[key]=desc.value,o},ObjectFreeze=function(obj){return obj},ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}},ArrayIsArray=function(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,defineProperty:ObjectDefineProperty,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return!0}}}},{}],14:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)},Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],15:[function(require,module){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){function returnThis(){return this}function throwThis(){throw this}function return$(r){return function(){return r}}function throw$(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;return then=wrapsPrimitiveReceiver&&isPrimitive(reasonOrValue)?isFulfilled?return$(reasonOrValue):throw$(reasonOrValue):isFulfilled?returnThis:throwThis,ret._then(then,thrower,void 0,reasonOrValue,void 0)}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo):handler();if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,void 0);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}return promise.isRejected()?(NEXT_FILTER.e=reasonOrValue,NEXT_FILTER):reasonOrValue}function tapHandler(value){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,void 0);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,value,!0)}return value}var util=require("./util.js"),wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver,isPrimitive=util.isPrimitive,thrower=util.thrower;Promise.prototype._passThroughHandler=function(handler,isFinally){if("function"!=typeof handler)return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:void 0,void 0,promiseAndHandler,void 0)},Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,!0)},Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,!1)}}},{"./util.js":36}],16:[function(require,module){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise){function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var _errorObj=errorObj,_Promise=Promise,len=yieldHandlers.length,i=0;len>i;++i){traceParent._pushContext();var result=tryCatch1(yieldHandlers[i],void 0,value);if(traceParent._popContext(),result===_errorObj)return _Promise.reject(_errorObj.e);var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof _Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace(),this._stack=stack,this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0,this._yieldHandlers="function"==typeof yieldHandler?[yieldHandler].concat(yieldHandlers):yieldHandlers}var errors=require("./errors.js"),TypeError=errors.TypeError,deprecated=require("./util.js").deprecated,util=require("./util.js"),errorObj=util.errorObj,tryCatch1=util.tryCatch1,yieldHandlers=[];PromiseSpawn.prototype.promise=function(){return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},PromiseSpawn.prototype._continue=function(result){if(result===errorObj){this._generator=void 0;var trace=errors.canAttachTrace(result.e)?result.e:new Error(util.toString(result.e));return this._promise._attachExtraTrace(trace),void this._promise._reject(result.e,trace)}var value=result.value;if(result.done===!0)this._generator=void 0,this._promise._tryFollow(value)||this._promise._fulfill(value);else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)&&(maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise),null===maybePromise))return void this._throw(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));maybePromise._then(this._next,this._throw,void 0,this,null)}},PromiseSpawn.prototype._throw=function(reason){errors.canAttachTrace(reason)&&this._promise._attachExtraTrace(reason),this._promise._pushContext();var result=tryCatch1(this._generator["throw"],this._generator,reason);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._next=function(value){this._promise._pushContext();var result=tryCatch1(this._generator.next,this._generator,value);this._promise._popContext(),this._continue(result)},Promise.coroutine=function(generatorFunction,options){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var yieldHandler=Object(options).yieldHandler,PromiseSpawn$=PromiseSpawn,stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,yieldHandler,stack);return spawn._generator=generator,spawn._next(void 0),spawn.promise()}},Promise.coroutine.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");yieldHandlers.push(fn)},Promise.spawn=function(generatorFunction){if(deprecated("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var spawn=new PromiseSpawn(generatorFunction,this),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors.js":11,"./util.js":36}],17:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){function reject(reason){this._reject(reason)}var util=require("./util.js"),canEvaluate=util.canEvaluate,tryCatch1=util.tryCatch1,errorObj=util.errorObj,errors=require("./errors.js");if(canEvaluate){for(var thenCallback=function(i){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,i))},caller=function(count){for(var values=[],i=1;count>=i;++i)values.push("holder.p"+i);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,values.join(", ")))},thenCallbacks=[],callers=[void 0],i=1;5>=i;++i)thenCallbacks.push(thenCallback(i)),callers.push(caller(i));var Holder=function(total,fn){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=fn,this.total=total,this.now=0};Holder.prototype.callers=callers,Holder.prototype.checkFulfillment=function(promise){var now=this.now;now++;var total=this.total;if(now>=total){var handler=this.callers[total];promise._pushContext();var ret=tryCatch1(handler,void 0,this);if(promise._popContext(),ret===errorObj){var reason=ret.e,trace=errors.ensureErrorObject(reason);
promise._attachExtraTrace(trace),promise._rejectUnchecked(reason,trace===reason?void 0:trace)}else promise._tryFollow(ret)||promise._fulfillUnchecked(ret)}else this.now=now}}Promise.join=function(){var fn,last=arguments.length-1;if(last>0&&"function"==typeof arguments[last]&&(fn=arguments[last],6>last&&canEvaluate)){var ret=new Promise(INTERNAL);ret._captureStackTrace();for(var holder=new Holder(last,fn),callbacks=thenCallbacks,i=0;last>i;++i){var maybePromise=tryConvertToPromise(arguments[i],void 0);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),maybePromise._isPending()?maybePromise._then(callbacks[i],reject,void 0,ret,holder):maybePromise._isFulfilled()?callbacks[i].call(ret,maybePromise._value(),holder):(ret._reject(maybePromise._reason()),maybePromise._unsetRejectionIsUnhandled())):callbacks[i].call(ret,maybePromise,holder)}return ret}for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];var ret=new PromiseArray(args).promise();return void 0!==fn?ret.spread(fn):ret}}},{"./errors.js":11,"./util.js":36}],18:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises),this._promise._setIsSpreadable(),this._promise._captureStackTrace(),this._callback=fn,this._preservedValues=_filter===INTERNAL?new Array(this.length()):null,this._limit=limit,this._inFlight=0,this._queue=limit>=1?[]:EMPTY_ARRAY,this._init$(void 0,-2)}function map(promises,fn,options,_filter){var limit="object"==typeof options&&null!==options?options.concurrency:0;return limit="number"==typeof limit&&isFinite(limit)&&limit>=1?limit:0,new MappingPromiseArray(promises,fn,limit,_filter)}var util=require("./util.js"),tryCatch3=util.tryCatch3,errorObj=util.errorObj,PENDING={},EMPTY_ARRAY=[];util.inherits(MappingPromiseArray,PromiseArray),MappingPromiseArray.prototype._init=function(){},MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values,length=this.length(),preservedValues=this._preservedValues,limit=this._limit;if(values[index]===PENDING){if(values[index]=value,limit>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(limit>=1&&this._inFlight>=limit)return values[index]=value,void this._queue.push(index);null!==preservedValues&&(preservedValues[index]=value);var callback=this._callback,receiver=this._promise._boundTo;this._promise._pushContext();var ret=tryCatch3(callback,receiver,value,index,length);if(this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return limit>=1&&this._inFlight++,values[index]=PENDING,maybePromise._proxyPromiseArray(this,index);if(!maybePromise._isFulfilled())return maybePromise._unsetRejectionIsUnhandled(),this._reject(maybePromise._reason());ret=maybePromise._value()}values[index]=ret}var totalResolved=++this._totalResolved;totalResolved>=length&&(null!==preservedValues?this._filter(values,preservedValues):this._resolve(values))},MappingPromiseArray.prototype._drainQueue=function(){for(var queue=this._queue,limit=this._limit,values=this._values;queue.length>0&&this._inFlight<limit;){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}},MappingPromiseArray.prototype._filter=function(booleans,values){for(var len=values.length,ret=new Array(len),j=0,i=0;len>i;++i)booleans[i]&&(ret[j++]=values[i]);ret.length=j,this._resolve(ret)},MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues},Promise.prototype.map=function(fn,options){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(this,fn,options,null).promise()},Promise.map=function(promises,fn,options,_filter){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(promises,fn,options,_filter).promise()}}},{"./util.js":36}],19:[function(require,module){"use strict";module.exports=function(Promise){function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=util.tryCatchApply(nodeback,[null].concat(val),promise._boundTo);ret===errorObj&&async.throwLater(ret.e)}function successAdapter(val,nodeback){var promise=this,receiver=promise._boundTo,ret=void 0===val?tryCatch1(nodeback,receiver,null):tryCatch2(nodeback,receiver,null,val);ret===errorObj&&async.throwLater(ret.e)}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var target=promise._target(),newReason=target._getCarriedStackTrace();newReason.cause=reason,reason=newReason}var ret=tryCatch1(nodeback,promise._boundTo,reason);ret===errorObj&&async.throwLater(ret.e)}var util=require("./util.js"),async=require("./async.js"),tryCatch2=util.tryCatch2,tryCatch1=util.tryCatch1,errorObj=util.errorObj;Promise.prototype.nodeify=function(nodeback,options){if("function"==typeof nodeback){var adapter=successAdapter;void 0!==options&&Object(options).spread&&(adapter=spreadAdapter),this._then(adapter,errorAdapter,void 0,this,nodeback)}return this}}},{"./async.js":3,"./util.js":36}],20:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray){var util=require("./util.js"),async=require("./async.js"),errors=require("./errors.js"),tryCatch1=util.tryCatch1,errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(void 0,void 0,handler,void 0,void 0)},Promise.prototype._progress=function(progressValue){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(progressValue)},Promise.prototype._progressHandlerAt=function(index){return 0===index?this._progressHandler0:this[(index<<2)+index-5+2]},Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value,handler=progression.handler,promise=progression.promise,receiver=progression.receiver,ret=tryCatch1(handler,receiver,progressValue);if(ret===errorObj){if(null!=ret.e&&"StopProgressPropagation"!==ret.e.name){var trace=errors.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace),promise._progress(ret.e)}}else ret instanceof Promise?ret._then(promise._progress,null,null,promise,void 0):promise._progress(ret)},Promise.prototype._progressUnchecked=function(progressValue){for(var len=this._length(),progress=this._progress,i=0;len>i;i++){var handler=this._progressHandlerAt(i),promise=this._promiseAt(i);if(promise instanceof Promise)"function"==typeof handler?async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue}):async.invoke(progress,promise,progressValue);else{var receiver=this._receiverAt(i);"function"==typeof handler?handler.call(receiver,progressValue,promise):receiver instanceof PromiseArray&&!receiver._isResolved()&&receiver._promiseProgressed(progressValue,promise)}}}}},{"./async.js":3,"./errors.js":11,"./util.js":36}],21:[function(require,module){(function(process){"use strict";module.exports=function(){function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,resolver!==INTERNAL&&this._resolveFromResolver(resolver)}function Context(){this._trace=new CapturedTrace(peekContext())}function createContext(){return debugging?new Context:void 0}function peekContext(){var lastIndex=contextStack.length-1;return lastIndex>=0?contextStack[lastIndex]:void 0}var unhandledRejectionHandled,possiblyUnhandledRejection,makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},reflect=function(){return new Promise.PromiseInspection(this._target())},util=require("./util.js"),async=require("./async.js"),errors=require("./errors.js"),INTERNAL=function(){},APPLY={},NEXT_FILTER={e:null},apiRejection=require("./errors_api_rejection")(Promise),tryConvertToPromise=require("./thenables.js")(Promise,INTERNAL),PromiseArray=require("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),CapturedTrace=require("./captured_trace.js")(),CatchFilter=require("./catch_filter.js")(NEXT_FILTER),PromiseResolver=require("./promise_resolver.js"),isArray=util.isArray,errorObj=util.errorObj,tryCatch0=util.tryCatch0,tryCatch1=util.tryCatch1,tryCatch2=util.tryCatch2,tryCatchApply=util.tryCatchApply,RangeError=errors.RangeError,TypeError=errors.TypeError,CancellationError=errors.CancellationError,TimeoutError=errors.TimeoutError,OperationalError=errors.OperationalError,originatesFromRejection=errors.originatesFromRejection,markAsOriginatingFromRejection=errors.markAsOriginatingFromRejection,canAttachTrace=errors.canAttachTrace,debugging=!1||!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg,this),ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();return maybePromise instanceof Promise?(target._then(INTERNAL,ret._reject,ret._progress,ret,null),maybePromise._then(function(thisArg){ret._isPending()&&(ret._setBoundTo(thisArg),ret._follow(target))},ret._reject,ret._progress,ret,null)):(ret._setBoundTo(thisArg),ret._follow(target)),ret},Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;len-1>i;++i){var item=arguments[i];if("function"!=typeof item){var error=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");return this._attachExtraTrace(error),Promise.reject(error)}catchInstances[j++]=item}catchInstances.length=j,fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0)}return this._then(void 0,fn,void 0,void 0,void 0)},Promise.prototype.reflect=function(){return this._then(reflect,reflect,void 0,this,void 0)},Promise.prototype.then=function(didFulfill,didReject,didProgress){return this._then(didFulfill,didReject,didProgress,void 0,void 0)},Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0);promise._setIsFinal()},Promise.prototype.spread=function(didFulfill,didReject){var followee=this._target(),target=followee._isSpreadable()?followee===this?this:this.then():this.all();return target._then(didFulfill,didReject,void 0,APPLY,void 0)},Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this.value(),ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this.reason(),ret.isRejected=!0),ret},Promise.prototype.all=function(){var ret=new PromiseArray(this).promise();return ret._setIsSpreadable(),ret},Promise.prototype.error=function(fn){return this.caught(originatesFromRejection,fn)},Promise.is=function(val){return val instanceof Promise},Promise.all=function(promises){var ret=new PromiseArray(promises).promise();return ret._setIsSpreadable(),ret},Promise.method=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace();var value;switch(ret._pushContext(),arguments.length){case 0:value=tryCatch0(fn,this);break;case 1:value=tryCatch1(fn,this,arguments[0]);break;case 2:value=tryCatch2(fn,this,arguments[0],arguments[1]);break;default:for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];value=tryCatchApply(fn,args,this)}return ret._popContext(),ret._resolveFromSyncValue(value),ret}},Promise.attempt=Promise["try"]=function(fn,args,ctx){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=isArray(args)?tryCatchApply(fn,args,ctx):tryCatch1(fn,ctx,args);return ret._popContext(),ret._resolveFromSyncValue(value),ret},Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise)},Promise.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg,void 0),ret=new Promise(INTERNAL);return maybePromise instanceof Promise?maybePromise._then(function(thisArg){ret._setBoundTo(thisArg),ret._fulfill(void 0)},ret._reject,ret._progress,ret,null):(ret._setBoundTo(thisArg),ret._setFulfilled()),ret},Promise.cast=function(obj){var ret=tryConvertToPromise(obj,void 0);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL),ret._setFulfilled(),ret._settledValue=val,ret._cleanValues()}return ret},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);ret._captureStackTrace(),markAsOriginatingFromRejection(reason);var hasStack=canAttachTrace(reason)&&"string"==typeof reason.stack,trace=errors.ensureErrorObject(reason);return ret._attachExtraTrace(reason,hasStack),ret._rejectUnchecked(reason,trace===reason?void 0:trace),ret},Promise.onPossiblyUnhandledRejection=function(fn){possiblyUnhandledRejection="function"==typeof fn?fn:void 0},Promise.onUnhandledRejectionHandled=function(fn){unhandledRejectionHandled="function"==typeof fn?fn:void 0},Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");debugging=CapturedTrace.isSupported()},Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()},Promise.setScheduler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");async._schedule=fn},Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=void 0!==internalData,ret=haveInternalData?internalData:new Promise(INTERNAL);haveInternalData||(ret._propagateFrom(this,5),ret._captureStackTrace());var target=this._target();target!==this&&(void 0===receiver&&(receiver=this._boundTo),haveInternalData||ret._setIsMigrated());var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);return target._isResolved()&&!target._isSettlePromisesQueued()&&async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex),ret},Promise.prototype._settlePromiseAtPostResolution=function(index){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(index)},Promise.prototype._length=function(){return 131071&this._bitField},Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},Promise.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=-131072&this._bitField|131071&len},Promise.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},Promise.prototype._setRejected=function(){this._bitField=134217728|this._bitField},Promise.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},Promise.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},Promise.prototype._isFinal=function(){return(33554432&this._bitField)>0},Promise.prototype._cancellable=function(){return(67108864&this._bitField)>0},Promise.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},Promise.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},Promise.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},Promise.prototype._isSpreadable=function(){return(131072&this._bitField)>0},Promise.prototype._setIsSpreadable=function(){this._bitField=131072|this._bitField},Promise.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},Promise.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},Promise.prototype._isMigrated=function(){return(4194304&this._bitField)>0},Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},Promise.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=capturedTrace},Promise.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},Promise.prototype._receiverAt=function(index){var ret=0===index?this._receiver0:this[5*index-5+4];return this._isBound()&&void 0===ret?this._boundTo:ret},Promise.prototype._promiseAt=function(index){return 0===index?this._promise0:this[5*index-5+3]},Promise.prototype._fulfillmentHandlerAt=function(index){return 0===index?this._fulfillmentHandler0:this[5*index-5+0]},Promise.prototype._rejectionHandlerAt=function(index){return 0===index?this._rejectionHandler0:this[5*index-5+1]},Promise.prototype._migrateCallbacks=function(fulfill,reject,progress,promise,receiver){promise instanceof Promise&&promise._setIsMigrated(),this._addCallbacks(fulfill,reject,progress,promise,receiver)},Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promise,void 0!==receiver&&(this._receiver0=receiver),"function"!=typeof fulfill||this._isCarryingStackTrace()||(this._fulfillmentHandler0=fulfill),"function"==typeof reject&&(this._rejectionHandler0=reject),"function"==typeof progress&&(this._progressHandler0=progress);else{var base=5*index-5;this[base+3]=promise,this[base+4]=receiver,"function"==typeof fulfill&&(this[base+0]=fulfill),"function"==typeof reject&&(this[base+1]=reject),"function"==typeof progress&&(this[base+2]=progress)}return this._setLength(index+1),index},Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promiseSlotValue,this._receiver0=receiver;else{var base=5*index-5;this[base+3]=promiseSlotValue,this[base+4]=receiver}this._setLength(index+1)},Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=8388608|this._bitField,this._boundTo=obj):this._bitField=-8388609&this._bitField},Promise.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},Promise.prototype._resolveFromResolver=function(resolver){var promise=this,synchronous=!0;this._captureStackTrace(),this._pushContext();var r=tryCatch2(resolver,void 0,function(value){promise._tryFollow(value)||promise._fulfill(value)},function(reason){markAsOriginatingFromRejection(reason);var trace=errors.ensureErrorObject(reason),hasStack=canAttachTrace(reason)&&"string"==typeof trace.stack;promise._attachExtraTrace(trace,synchronous?hasStack:!1),promise._reject(reason,trace===reason?void 0:trace)});if(synchronous=!1,this._popContext(),void 0!==r&&r===errorObj){var reason=r.e,hasStack=canAttachTrace(reason)&&"string"==typeof reason.stack,trace=errors.ensureErrorObject(reason);promise._attachExtraTrace(reason,hasStack),promise._reject(reason,trace===reason?void 0:trace)}},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(!promise._isRejected()){promise._pushContext();var x;if(x=receiver!==APPLY||this._isRejected()?tryCatch1(handler,receiver,value):tryCatchApply(handler,value,this._boundTo),promise._popContext(),x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e,trace=canAttachTrace(err)?err:new Error(util.toString(err));x!==NEXT_FILTER&&promise._attachExtraTrace(trace),promise._rejectUnchecked(err,trace)}else if(x=tryConvertToPromise(x,promise),x instanceof Promise){if(x=x._target(),x._isRejected()&&!x._isCarryingStackTrace()&&!canAttachTrace(x._reason())){var trace=new Error(util.toString(x._reason()));promise._attachExtraTrace(trace),x._setCarriedStackTrace(trace)}promise._follow(x)}else promise._fulfillUnchecked(x)}},Promise.prototype._target=function(){for(var ret=this;ret._isFollowing();)ret=ret._followee();return ret},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise},Promise.prototype._follow=function(promise){if(promise._isPending()){for(var len=this._length(),i=0;len>i;++i)promise._migrateCallbacks(this._fulfillmentHandlerAt(i),this._rejectionHandlerAt(i),this._progressHandlerAt(i),this._promiseAt(i),this._receiverAt(i));this._setFollowing(),this._setLength(0),this._setFollowee(promise),this._propagateFrom(promise,1)}else promise._isFulfilled()?this._fulfillUnchecked(promise._value()):this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace());promise._isRejectionUnhandled()&&promise._unsetRejectionIsUnhandled()},Promise.prototype._tryFollow=function(value){if(this._isFollowingOrFulfilledOrRejected()||value===this)return!1;var maybePromise=tryConvertToPromise(value,this);return maybePromise instanceof Promise?(this._follow(maybePromise._target()),!0):!1},Promise.prototype._captureStackTrace=function(){return debugging&&(this._trace=new CapturedTrace(this._peekContext())),this},Promise.prototype._canAttachTrace=function(error){return debugging&&canAttachTrace(error)},Promise.prototype._attachExtraTraceIgnoreSelf=function(error){this._canAttachTrace(error)&&void 0!==this._trace._parent&&this._trace._parent.attachExtraTrace(error)},Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;void 0!==trace&&ignoreSelf&&(trace=trace._parent),void 0!==trace?trace.attachExtraTrace(error):CapturedTrace.cleanStack(error,!0)}},Promise.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},Promise.prototype._propagateFrom=function(parent,flags){(1&flags)>0&&parent._cancellable()&&(this._setCancellable(),this._cancellationParent=parent),(4&flags)>0&&this._setBoundTo(parent._boundTo)},Promise.prototype._fulfill=function(value){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(value)},Promise.prototype._reject=function(reason,carriedStackTrace){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(reason,carriedStackTrace)},Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index),isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated())return promise._unsetIsMigrated(),async.invoke(this._settlePromiseAt,this,index);var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index),carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,value=this._settledValue,receiver=this._receiverAt(index);this._clearCallbackDataAtIndex(index),"function"==typeof handler?isPromise?this._settlePromiseFromHandler(handler,receiver,value,promise):handler.call(receiver,value,promise):receiver instanceof PromiseArray?receiver._isResolved()||(this._isFulfilled()?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise)):isPromise&&(this._isFulfilled()?promise._fulfill(value):promise._reject(value,carriedStackTrace)),index>=4&&4===(31&index)&&async.invokeLater(this._setLength,this,0)},Promise.prototype._clearCallbackDataAtIndex=function(index){if(0===index)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var base=5*index-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=void 0}},Promise.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},Promise.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},Promise.prototype._queueSettlePromises=function(){this._isSettlePromisesQueued()||(async.settlePromises(this),this._setSettlePromisesQueued())},Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err,void 0)}this._setFulfilled(),this._settledValue=value,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=errors.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?void 0:trace)},Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err)}return this._setRejected(),this._settledValue=reason,this._cleanValues(),this._isFinal()?void async.throwLater(function(e){throw"stack"in e&&async.invokeFirst(CapturedTrace.unhandledRejection,void 0,e),e},void 0===trace?reason:trace):(void 0!==trace&&trace!==reason&&this._setCarriedStackTrace(trace),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var len=this._length(),i=0;len>i;i++)this._settlePromiseAt(i)},Promise.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),async.invokeLater(this._notifyUnhandledRejection,this,void 0)},Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,void 0,this)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}};var contextStack=[];return Context.prototype._pushContext=function(){debugging&&contextStack.push(this._trace)},Context.prototype._popContext=function(){debugging&&contextStack.pop()},Promise.prototype._peekContext=peekContext,Promise.prototype._pushContext=Context.prototype._pushContext,Promise.prototype._popContext=Context.prototype._popContext,Promise.prototype._resolveFromSyncValue=function(value){if(value===errorObj){this._setRejected();var reason=value.e;this._settledValue=reason,this._cleanValues(),this._attachExtraTrace(reason),this._ensurePossibleRejectionHandled()}else{var maybePromise=tryConvertToPromise(value,this);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),this._follow(maybePromise)):(this._setFulfilled(),this._settledValue=value,this._cleanValues())}},CapturedTrace.isSupported()||(Promise.longStackTraces=function(){},debugging=!1),Promise._makeSelfResolutionError=makeSelfResolutionError,require("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise),require("./direct_resolve.js")(Promise),require("./synchronous_inspection.js")(Promise),require("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL),Promise.RangeError=RangeError,Promise.CancellationError=CancellationError,Promise.TimeoutError=TimeoutError,Promise.TypeError=TypeError,Promise.OperationalError=OperationalError,Promise.RejectionError=OperationalError,Promise.AggregateError=errors.AggregateError,util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),Promise.Promise=Promise,CapturedTrace.setBounds(async.firstLineError,util.lastLineError),require("./nodeify.js")(Promise),require("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext),require("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise),require("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),require("./cancel.js")(Promise,INTERNAL),require("./promisify.js")(Promise,INTERNAL),require("./props.js")(Promise,PromiseArray,tryConvertToPromise),require("./race.js")(Promise,INTERNAL,tryConvertToPromise),require("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),require("./settle.js")(Promise,PromiseArray),require("./call_get.js")(Promise),require("./some.js")(Promise,PromiseArray,apiRejection),require("./progress.js")(Promise,PromiseArray),require("./any.js")(Promise),require("./each.js")(Promise,INTERNAL),require("./timers.js")(Promise,INTERNAL,tryConvertToPromise),require("./filter.js")(Promise,INTERNAL),Promise.prototype=Promise.prototype,Promise}}).call(this,require("_process"))},{"./any.js":2,"./async.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./direct_resolve.js":9,"./each.js":10,"./errors.js":11,"./errors_api_rejection":12,"./filter.js":14,"./finally.js":15,"./generators.js":16,"./join.js":17,"./map.js":18,"./nodeify.js":19,"./progress.js":20,"./promise_array.js":22,"./promise_resolver.js":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection.js":32,"./thenables.js":33,"./timers.js":34,"./using.js":35,"./util.js":36,_process:39}],22:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function toResolutionValue(val){switch(val){case-1:return void 0;case-2:return[];case-3:return{}}}function PromiseArray(values){var parent,promise=this._promise=new Promise(INTERNAL);values instanceof Promise&&(parent=values,promise._propagateFrom(parent,5)),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var util=require("./util.js"),errors=require("./errors.js"),isArray=util.isArray;return PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,void 0);if(values instanceof Promise){if(values._setBoundTo(this._promise._boundTo),values=values._target(),this._values=values,!values._isFulfilled())return values._isPending()?void values._then(init,this._reject,void 0,this,resolveValueIfEmpty):(values._unsetRejectionIsUnhandled(),void this._reject(values._reason()));if(values=values._value(),!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(err)}}else if(!isArray(values))return void this._promise._follow(apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n"));
if(0===values.length)return void(-5===resolveValueIfEmpty?this._resolveEmptyArray():this._resolve(toResolutionValue(resolveValueIfEmpty)));var len=this.getActualLength(values.length);this._length=len,this._values=this.shouldCopyValues()?new Array(len):this._values;for(var promise=this._promise,i=0;len>i;++i){var isResolved=this._isResolved(),maybePromise=tryConvertToPromise(values[i],promise);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),isResolved?maybePromise._unsetRejectionIsUnhandled():maybePromise._isPending()?maybePromise._proxyPromiseArray(this,i):maybePromise._isFulfilled()?this._promiseFulfilled(maybePromise._value(),i):(maybePromise._unsetRejectionIsUnhandled(),this._promiseRejected(maybePromise._reason(),i))):isResolved||this._promiseFulfilled(maybePromise,i)}},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null;var trace=errors.ensureErrorObject(reason);this._promise._attachExtraTrace(trace),this._promise._reject(reason,trace)},PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue})},PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},PromiseArray.prototype._promiseRejected=function(reason){this._totalResolved++,this._reject(reason)},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(len){return len},PromiseArray}},{"./errors.js":11,"./util.js":36}],23:[function(require,module){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj),ret.name=obj.name,ret.message=obj.message,ret.stack=obj.stack;for(var keys=es5.keys(obj),i=0;i<keys.length;++i){var key=keys[i];rErrorKey.test(key)||(ret[key]=obj[key])}return ret}return errors.markAsOriginatingFromRejection(obj),obj}function nodebackForPromise(promise){return function(err,value){if(null!==promise){if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(arguments.length>2){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];promise._fulfill(args)}else promise._fulfill(value);promise=null}}}var PromiseResolver,util=require("./util.js"),maybeWrapAsError=util.maybeWrapAsError,errors=require("./errors.js"),TimeoutError=errors.TimeoutError,OperationalError=errors.OperationalError,async=require("./async.js"),haveGetters=util.haveGetters,es5=require("./es5.js"),rErrorKey=/^(?:name|message|stack|cause)$/;if(PromiseResolver=haveGetters?function(promise){this.promise=promise}:function(promise){this.promise=promise,this.asCallback=nodebackForPromise(promise),this.callback=this.asCallback},haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop),es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise,PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"},PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");var promise=this.promise;promise._tryFollow(value)||async.invoke(promise._fulfill,promise,value)},PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");var promise=this.promise;errors.markAsOriginatingFromRejection(reason);var trace=errors.ensureErrorObject(reason);async.invoke(promise._reject,promise,reason),trace!==reason&&async.invoke(this._setCarriedStackTrace,this,trace)},PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");async.invoke(this.promise._progress,this.promise,value)},PromiseResolver.prototype.cancel=function(){async.invoke(this.promise.cancel,this.promise,void 0)},PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))},PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()},PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()},PromiseResolver.prototype._setCarriedStackTrace=function(trace){this.promise.isRejected()&&this.promise._setCarriedStackTrace(trace)},module.exports=PromiseResolver},{"./async.js":3,"./errors.js":11,"./es5.js":13,"./util.js":36}],24:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL){function escapeIdentRegex(str){return str.replace(/([$])/,"\\$")}function isPromisified(fn){try{return fn.__isPromisified__===!0}catch(e){return!1}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):!1}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key))for(var keyWithoutAsyncSuffix=key.replace(suffixRegexp,""),j=0;j<ret.length;j+=2)if(ret[j]===keyWithoutAsyncSuffix)throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",suffix))}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){for(var keys=util.inheritedDataKeys(obj),ret=[],i=0;i<keys.length;++i){var key=keys[i],value=obj[key],passesDefaultFilter=filter===defaultFilter?!0:defaultFilter(key,value,obj);"function"!=typeof value||isPromisified(value)||hasPromisified(obj,key,suffix)||!filter(key,value,obj,passesDefaultFilter)||ret.push(key,value)}return checkValid(ret,suffix,suffixRegexp),ret}function switchCaseArgumentOrder(likelyArgumentCount){for(var ret=[likelyArgumentCount],min=Math.max(0,likelyArgumentCount-1-5),i=likelyArgumentCount-1;i>=min;--i)i!==likelyArgumentCount&&ret.push(i);for(var i=likelyArgumentCount+1;5>=i;++i)ret.push(i);return ret}function argumentSequence(argumentCount){return util.filledRange(argumentCount,"arguments[","]")}function parameterDeclaration(parameterCount){return util.filledRange(parameterCount,"_arg","")}function parameterCount(fn){return"number"==typeof fn.length?Math.max(Math.min(fn.length,1024),0):0}function generatePropertyAccess(key){return util.isIdentifier(key)?"."+key:"['"+key.replace(/(['\\])/g,"\\$1")+"']"}function makeNodePromisifiedEval(callback,receiver,originalName,fn,suffix){function generateCallForArgumentCount(count){var ret,args=argumentSequence(count).join(", "),comma=count>0?", ":"";return ret="string"==typeof callback?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",generatePropertyAccess(callback)):receiver===THIS?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==receiver?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",ret.replace("{{args}}",args).replace(", ",comma)}function generateArgumentSwitchCase(){for(var ret="",i=0;i<argumentOrder.length;++i)ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i]);var codeForCall;return codeForCall="string"==typeof callback?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",generatePropertyAccess(callback)):receiver===THIS?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",ret+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",codeForCall)}var newParameterCount=Math.max(0,parameterCount(fn)-1),argumentOrder=switchCaseArgumentOrder(newParameterCount),callbackName="string"==typeof originalName&&util.isIdentifier(originalName)?originalName+suffix:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            promise._setIsSpreadable();                                      \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",callbackName).replace("Parameters",parameterDeclaration(newParameterCount)).replace("[CodeForSwitchCase]",generateArgumentSwitchCase()))(Promise,callback,receiver,withAppended,maybeWrapAsError,nodebackForPromise,INTERNAL)}function makeNodePromisifiedClosure(callback,receiver){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this),"string"==typeof callback&&(callback=_receiver[callback]);var promise=new Promise(INTERNAL);promise._captureStackTrace(),promise._setIsSpreadable();var fn=nodebackForPromise(promise);try{callback.apply(_receiver,withAppended(arguments,fn))}catch(e){var wrapped=maybeWrapAsError(e);promise._attachExtraTrace(wrapped),promise._reject(wrapped)}return promise}return promisified.__isPromisified__=!0,promisified}function promisifyAll(obj,suffix,filter,promisifier){for(var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$"),methods=promisifiableMethods(obj,suffix,suffixRegexp,filter),i=0,len=methods.length;len>i;i+=2){var key=methods[i],fn=methods[i+1],promisifiedKey=key+suffix;obj[promisifiedKey]=promisifier===makeNodePromisified?makeNodePromisified(key,THIS,key,fn,suffix):promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix)})}return util.toFastProperties(obj),obj}function promisify(callback,receiver){return makeNodePromisified(callback,receiver,void 0,callback)}var THIS={},util=require("./util.js"),nodebackForPromise=require("./promise_resolver.js")._nodebackForPromise,withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,TypeError=require("./errors").TypeError,defaultSuffix="Async",defaultFilter=function(name,func){return util.isIdentifier(name)&&"_"!==name.charAt(0)&&!util.isClass(func)},defaultPromisified={__isPromisified__:!0},makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,receiver){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return isPromisified(fn)?fn:promisify(fn,arguments.length<2?THIS:receiver)},Promise.promisifyAll=function(target,options){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");options=Object(options);var suffix=options.suffix;"string"!=typeof suffix&&(suffix=defaultSuffix);var filter=options.filter;"function"!=typeof filter&&(filter=defaultFilter);var promisifier=options.promisifier;if("function"!=typeof promisifier&&(promisifier=makeNodePromisified),!util.isIdentifier(suffix))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var keys=util.inheritedDataKeys(target,{includeHidden:!0}),i=0;i<keys.length;++i){var value=target[keys[i]];"constructor"!==keys[i]&&util.isClass(value)&&(promisifyAll(value.prototype,suffix,filter,promisifier),promisifyAll(value,suffix,filter,promisifier))}return promisifyAll(target,suffix,filter,promisifier)}}},{"./errors":11,"./promise_resolver.js":23,"./util.js":36}],25:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise){function PropertiesPromiseArray(obj){for(var keys=es5.keys(obj),len=keys.length,values=new Array(2*len),i=0;len>i;++i){var key=keys[i];values[i]=obj[key],values[i+len]=key}this.constructor$(values)}function props(promises){var ret,castValue=tryConvertToPromise(promises,void 0);return isObject(castValue)?(ret=castValue instanceof Promise?castValue._then(Promise.props,void 0,void 0,void 0,void 0):new PropertiesPromiseArray(castValue).promise(),castValue instanceof Promise&&ret._propagateFrom(castValue,4),ret):apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var util=require("./util.js"),apiRejection=require("./errors_api_rejection")(Promise),isObject=util.isObject,es5=require("./es5.js");util.inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){this._init$(void 0,-3)},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){for(var val={},keyOffset=this.length(),i=0,len=this.length();len>i;++i)val[this._values[i+keyOffset]]=this._values[i];this._resolve(val)}},PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._promise._progress({key:this._values[index+this.length()],value:value})},PropertiesPromiseArray.prototype.shouldCopyValues=function(){return!1},PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1},Promise.prototype.props=function(){return props(this)},Promise.props=function(promises){return props(promises)}}},{"./errors_api_rejection":12,"./es5.js":13,"./util.js":36}],26:[function(require,module){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;len>j;++j)dst[j+dstIndex]=src[j+srcIndex],src[j+srcIndex]=void 0}function Queue(capacity){this._capacity=capacity,this._length=0,this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg,this._length=length+1},Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front,i=(front-1&capacity-1^capacity)-capacity;this[i]=value,this._front=i,this._length=this.length()+1},Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg),this._unshiftOne(receiver),this._unshiftOne(fn)},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<1)},Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front,length=this._length;if(front+length>oldCapacity){var moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)}},module.exports=Queue},{}],27:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){function race(promises,parent){var maybePromise=tryConvertToPromise(promises,void 0);if(maybePromise instanceof Promise)return raceLater(maybePromise);if(!isArray(promises))return apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var ret=new Promise(INTERNAL);void 0!==parent&&ret._propagateFrom(parent,5);for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;len>i;++i){var val=promises[i];(void 0!==val||i in promises)&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}var apiRejection=require("./errors_api_rejection.js")(Promise),isArray=require("./util.js").isArray,raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};Promise.race=function(promises){return race(promises,void 0)},Promise.prototype.race=function(){return race(this,void 0)}}},{"./errors_api_rejection.js":12,"./util.js":36}],28:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function ReductionPromiseArray(promises,fn,accum,_each){this.constructor$(promises),this._promise._captureStackTrace(),this._preservedValues=_each===INTERNAL?[]:null,this._zerothIsAccum=void 0===accum,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var maybePromise=tryConvertToPromise(accum,void 0),rejected=!1,isPromise=maybePromise instanceof Promise;isPromise&&(maybePromise=maybePromise._target(),maybePromise._isPending()?maybePromise._proxyPromiseArray(this,-1):maybePromise._isFulfilled()?(accum=maybePromise._value(),this._gotAccum=!0):(maybePromise._unsetRejectionIsUnhandled(),this._reject(maybePromise._reason()),rejected=!0)),isPromise||this._zerothIsAccum||(this._gotAccum=!0),this._callback=fn,this._accum=accum,rejected||this._init$(void 0,-5)}function reduce(promises,fn,initialValue,_each){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}var util=require("./util.js"),tryCatch4=util.tryCatch4,tryCatch3=util.tryCatch3,errorObj=util.errorObj;util.inherits(ReductionPromiseArray,PromiseArray),ReductionPromiseArray.prototype._init=function(){},ReductionPromiseArray.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},ReductionPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;values[index]=value;var valuesPhaseIndex,length=this.length(),preservedValues=this._preservedValues,isEach=null!==preservedValues,gotAccum=this._gotAccum,valuesPhase=this._valuesPhase;if(!valuesPhase)for(valuesPhase=this._valuesPhase=Array(length),valuesPhaseIndex=0;length>valuesPhaseIndex;++valuesPhaseIndex)valuesPhase[valuesPhaseIndex]=0;if(valuesPhaseIndex=valuesPhase[index],0===index&&this._zerothIsAccum?(gotAccum||(this._accum=value,this._gotAccum=gotAccum=!0),valuesPhase[index]=0===valuesPhaseIndex?1:2):-1===index?gotAccum||(this._accum=value,this._gotAccum=gotAccum=!0):0===valuesPhaseIndex?valuesPhase[index]=1:(valuesPhase[index]=2,gotAccum&&(this._accum=value)),gotAccum){for(var ret,callback=this._callback,receiver=this._promise._boundTo,i=this._reducingIndex;length>i;++i)if(valuesPhaseIndex=valuesPhase[i],2!==valuesPhaseIndex){if(1!==valuesPhaseIndex)return;if(value=values[i],value instanceof Promise){if(value=value._target(),!value._isFulfilled())return value._isPending()?void 0:(value._unsetRejectionIsUnhandled(),this._reject(value._reason()));value=value._value()}if(this._promise._pushContext(),isEach?(preservedValues.push(value),ret=tryCatch3(callback,receiver,value,i,length)):ret=tryCatch4(callback,receiver,this._accum,value,i,length),this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return valuesPhase[i]=4,maybePromise._proxyPromiseArray(this,i);if(!maybePromise._isFulfilled())return maybePromise._unsetRejectionIsUnhandled(),this._reject(maybePromise._reason());ret=maybePromise._value()}this._reducingIndex=i+1,this._accum=ret}else this._reducingIndex=i+1;this._reducingIndex<length||this._resolve(isEach?preservedValues:this._accum)}},Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)},Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./util.js":36}],29:[function(require,module){(function(process){"use strict";var schedule;"object"==typeof process&&"string"==typeof process.version?schedule=parseInt(process.version.split(".")[1],10)>10?setImmediate:process.nextTick:"undefined"!=typeof MutationObserver?(schedule=function(fn){var div=document.createElement("div"),observer=new MutationObserver(fn);return observer.observe(div,{attributes:!0}),function(){div.classList.toggle("foo")}},schedule.isStatic=!0):schedule="undefined"!=typeof setTimeout?function(fn){setTimeout(fn,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")},module.exports=schedule}).call(this,require("_process"))},{_process:39}],30:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray){function SettledPromiseArray(values){this.constructor$(values),this._promise._setIsSpreadable()}var PromiseInspection=Promise.PromiseInspection,util=require("./util.js");util.inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=268435456,ret._settledValue=value,this._promiseResolved(index,ret)},SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=134217728,ret._settledValue=reason,this._promiseResolved(index,ret)},Promise.settle=function(promises){return new SettledPromiseArray(promises).promise()},Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise()}}},{"./util.js":36}],31:[function(require,module){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){function SomePromiseArray(values){this.constructor$(values),this._howMany=0,this._unwrap=!1,this._initialized=!1}function some(promises,howMany){if((0|howMany)!==howMany||0>howMany)return apiRejection("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var ret=new SomePromiseArray(promises),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(howMany),ret.init(),promise)}var util=require("./util.js"),RangeError=require("./errors.js").RangeError,AggregateError=require("./errors.js").AggregateError,isArray=util.isArray;util.inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(this._promise._setIsSpreadable(),0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var isArrayResolved=isArray(this._values);!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._isResolved()||(this._howMany=count)},SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values))},SomePromiseArray.prototype._promiseRejected=function(reason){if(this._addRejected(reason),this.howMany()>this._canPossiblyFulfill()){for(var e=new AggregateError,i=this.length();i<this._values.length;++i)e.push(this._values[i]);this._reject(e)}},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)},SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},Promise.some=function(promises,howMany){return some(promises,howMany)},Promise.prototype.some=function(howMany){return some(this,howMany)},Promise._SomePromiseArray=SomePromiseArray}},{"./errors.js":11,"./util.js":36}],32:[function(require,module){"use strict";module.exports=function(Promise){function PromiseInspection(promise){void 0!==promise?(promise=promise._target(),this._bitField=promise._bitField,this._settledValue=promise._isResolved()?promise._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(134217728&this._bitField)>0},PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return 0===(402653184&this._bitField)},PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(402653184&this._bitField)>0},Promise.prototype.isPending=function(){return this._target()._isPending()},Promise.prototype.isRejected=function(){return this._target()._isRejected()},Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled()},Promise.prototype.isResolved=function(){return this._target()._isResolved()},Promise.prototype._value=function(){return this._settledValue},Promise.prototype._reason=function(){return this._settledValue},Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return target._settledValue},Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return target._settledValue},Promise.PromiseInspection=PromiseInspection}},{}],33:[function(require,module){"use strict";module.exports=function(Promise,INTERNAL){function getThen(obj){try{return obj.then}catch(e){return errorObj.e=e,errorObj}}function tryConvertToPromise(obj,traceParent){if(isObject(obj)){if(obj instanceof Promise)return obj;if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null),ret}var then=getThen(obj);if(then===errorObj)return void 0!==traceParent&&canAttachTrace(then.e)&&traceParent._attachExtraTrace(then.e),Promise.reject(then.e);if("function"==typeof then)return doThenable(obj,then,traceParent)}return obj}function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function doThenable(x,then,traceParent){function resolveFromThenable(y){if(!called){if(called=!0,x===y){var e=Promise._makeSelfResolutionError();return void 0!==traceParent&&traceParent._attachExtraTrace(e),void resolver.promise._reject(e,void 0)}resolver.resolve(y)}}function rejectFromThenable(r){if(!called){called=!0;var trace=canAttachTrace(r)?r:new Error(util.toString(r));void 0!==traceParent&&traceParent._attachExtraTrace(trace),resolver.promise._reject(r,trace)}}function progressFromThenable(v){if(!called){var promise=resolver.promise;"function"==typeof promise._progress&&promise._progress(v)}}var resolver=Promise.defer(),called=!1;try{then.call(x,resolveFromThenable,rejectFromThenable,progressFromThenable)}catch(e){if(!called){called=!0;var trace=canAttachTrace(e)?e:new Error(util.toString(e));void 0!==traceParent&&traceParent._attachExtraTrace(trace),resolver.promise._reject(e,trace)}}return resolver.promise}var util=require("./util.js"),canAttachTrace=require("./errors.js").canAttachTrace,errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;return tryConvertToPromise}},{"./errors.js":11,"./util.js":36}],34:[function(require,module){"use strict";
module.exports=function(Promise,INTERNAL,tryConvertToPromise){function successClear(value){var handle=this;return handle instanceof Number&&(handle=+handle),clearTimeout(handle),value}function failureClear(reason){var handle=this;throw handle instanceof Number&&(handle=+handle),clearTimeout(handle),reason}var errors=require("./errors.js"),TimeoutError=Promise.TimeoutError,afterTimeout=function(promise,message){if(promise.isPending()){"string"!=typeof message&&(message="operation timed out");var err=new TimeoutError(message);errors.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._cancel(err)}},afterDelay=function(value,promise){promise._fulfill(value)},delay=Promise.delay=function(value,ms){void 0===ms&&(ms=value,value=void 0),ms=+ms;var maybePromise=tryConvertToPromise(value,void 0),promise=new Promise(INTERNAL);return maybePromise instanceof Promise?(promise._propagateFrom(maybePromise,5),promise._follow(maybePromise._target()),promise.then(function(value){return Promise.delay(value,ms)})):(setTimeout(function(){afterDelay(value,promise)},ms),promise)};Promise.prototype.delay=function(ms){return delay(this,ms)},Promise.prototype.timeout=function(ms,message){var target=this._target();ms=+ms;var ret=new Promise(INTERNAL).cancellable();ret._propagateFrom(this,5),ret._follow(target);var handle=setTimeout(function(){afterTimeout(ret,message)},ms);return ret._then(successClear,failureClear,void 0,handle,void 0)}}},{"./errors.js":11}],35:[function(require,module){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext){function inspectionMapper(inspections){for(var len=inspections.length,i=0;len>i;++i){var inspection=inspections[i];if(inspection.isRejected())return Promise.reject(inspection.error());inspections[i]=inspection._settledValue}return inspections}function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable,void 0);return maybePromise!==thenable&&"function"==typeof thenable._isDisposable&&"function"==typeof thenable._getDisposer&&thenable._isDisposable()&&maybePromise._setDisposable(thenable._getDisposer()),maybePromise}function dispose(resources,inspection){function iterator(){if(i>=len)return ret.resolve();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),void 0)}catch(e){return thrower(e)}if(maybePromise instanceof Promise)return maybePromise._then(iterator,thrower,null,null,null)}iterator()}var i=0,len=resources.length,ret=Promise.defer();return iterator(),ret.promise}function disposerSuccess(value){var inspection=new PromiseInspection;return inspection._settledValue=value,inspection._bitField=268435456,dispose(this,inspection).thenReturn(value)}function disposerFail(reason){var inspection=new PromiseInspection;return inspection._settledValue=reason,inspection._bitField=134217728,dispose(this,inspection).thenThrow(reason)}function Disposer(data,promise,context){this._data=data,this._promise=promise,this._context=context}function FunctionDisposer(fn,promise){this.constructor$(fn,promise)}function maybeUnwrapDisposer(value){return Disposer.isDisposer(value)?(this.resources[this.index]._setDisposable(value),value.promise()):value}var TypeError=require("./errors.js").TypeError,inherits=require("./util.js").inherits,PromiseInspection=Promise.PromiseInspection;Disposer.prototype.data=function(){return this._data},Disposer.prototype.promise=function(){return this._promise},Disposer.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},Disposer.prototype.tryDispose=function(inspection){var resource=this.resource(),context=this._context;void 0!==context&&context._pushContext();var ret=null!==resource?this.doDispose(resource,inspection):null;return void 0!==context&&context._popContext(),this._promise._unsetDisposable(),this._data=null,ret},Disposer.isDisposer=function(d){return null!=d&&"function"==typeof d.resource&&"function"==typeof d.tryDispose},inherits(FunctionDisposer,Disposer),FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)},Promise.using=function(){var len=arguments.length;if(2>len)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");len--;for(var resources=new Array(len),i=0;len>i;++i){var resource=arguments[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise(),resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource,void 0);maybePromise instanceof Promise&&(resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},void 0))}resources[i]=resource}var promise=Promise.settle(resources).then(inspectionMapper).then(function(vals){promise._pushContext();var ret;try{ret=fn.apply(void 0,vals)}finally{promise._popContext()}return ret})._then(disposerSuccess,disposerFail,void 0,resources,void 0);return promise},Promise.prototype._setDisposable=function(disposer){this._bitField=262144|this._bitField,this._disposer=disposer},Promise.prototype._isDisposable=function(){return(262144&this._bitField)>0},Promise.prototype._getDisposer=function(){return this._disposer},Promise.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},Promise.prototype.disposer=function(fn){if("function"==typeof fn)return new FunctionDisposer(fn,this,createContext());throw new TypeError}}},{"./errors.js":11,"./util.js":36}],36:[function(require,module,exports){"use strict";function tryCatch0(fn,receiver){try{return fn.call(receiver)}catch(e){return errorObj.e=e,errorObj}}function tryCatch1(fn,receiver,arg){try{return fn.call(receiver,arg)}catch(e){return errorObj.e=e,errorObj}}function tryCatch2(fn,receiver,arg,arg2){try{return fn.call(receiver,arg,arg2)}catch(e){return errorObj.e=e,errorObj}}function tryCatch3(fn,receiver,arg,arg2,arg3){try{return fn.call(receiver,arg,arg2,arg3)}catch(e){return errorObj.e=e,errorObj}}function tryCatch4(fn,receiver,arg,arg2,arg3,arg4){try{return fn.call(receiver,arg,arg2,arg3,arg4)}catch(e){return errorObj.e=e,errorObj}}function tryCatchApply(fn,args,receiver){try{return fn.apply(receiver,args)}catch(e){return errorObj.e=e,errorObj}}function asString(val){return"string"==typeof val?val:""+val}function isPrimitive(val){return null==val||val===!0||val===!1||"string"==typeof val||"number"==typeof val}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(asString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;len>i;++i)ret[i]=target[i];return ret[i]=appendee,ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(!es5.isES5)return{}.hasOwnProperty.call(obj,key)?obj[key]:void 0;var desc=Object.getOwnPropertyDescriptor(obj,key);return null!=desc?null==desc.get&&null==desc.set?desc.value:defaultValue:void 0}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function isClass(fn){try{if("function"==typeof fn){var keys=es5.keys(fn.prototype);return keys.length>0&&!(1===keys.length&&"constructor"===keys[0])}return!1}catch(e){return!1}}function toFastProperties(obj){function f(){}return f.prototype=obj,f}function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){for(var ret=new Array(count),i=0;count>i;++i)ret[i]=prefix+i+suffix;return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}var es5=require("./es5.js"),haveGetters=function(){try{var o={};return es5.defineProperty(o,"f",{get:function(){return 3}}),3===o.f}catch(e){return!1}}(),canEvaluate="undefined"==typeof navigator,errorObj={e:{}},inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},wrapsPrimitiveReceiver=function(){return"string"!==this}.call("string"),inheritedDataKeys=function(){return es5.isES5?function(obj,opts){for(var ret=[],visitedKeys=Object.create(null),getKeys=Object(opts).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=obj;){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(!visitedKeys[key]){visitedKeys[key]=!0;var desc=Object.getOwnPropertyDescriptor(obj,key);null!=desc&&null==desc.get&&null==desc.set&&ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}:function(obj){var ret=[];for(var key in obj)ret.push(key);return ret}}(),rident=/^[a-z$_][a-z$_0-9]*$/i,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch0:tryCatch0,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatch3:tryCatch3,tryCatch4:tryCatch4,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString};try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5.js":13}],37:[function(){},{}],38:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;length>i;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return 0>start&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:39}],39:[function(require,module){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],40:[function(require,module){!function(){"use strict";function resolveDefs(c,block,def){return("string"==typeof block?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?(c.defineParams&&value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}}),code in def||(def[code]=value)):new Function("def","def['"+code+"']="+value)(def)),""}).replace(c.use||skip,function(m,code){c.useParams&&(code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");return def.__exp=def.__exp||{},def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2"),s+"def.__exp['"+rw+"']"}}));var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var _globals,doT={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};doT.encodeHTMLSource=function(doNotSkipEncoded){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=doNotSkipEncoded?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):""}},_globals=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):_globals.doT=doT;var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var needhtmlencode,indv,cse=c.append?startend.append:startend.split,sid=0,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){return needhtmlencode=!0,cse.startencode+unescape(code)+cse.end}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='":code?"';if("+unescape(code)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(m,iterate,vname,iname){return iterate?(sid+=1,indv=iname||"i"+sid,iterate=unescape(iterate),"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),needhtmlencode&&(c.selfcontained||!_globals||_globals._encodeHTML||(_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded)),str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||"")+"));"+str);try{return new Function(c.varname,str)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),e}},doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}}()},{}],41:[function(require,module){function InstallDots(o){this.__path=o.path||"./","/"!==this.__path[this.__path.length-1]&&(this.__path+="/"),this.__destination=o.destination||this.__path,"/"!==this.__destination[this.__destination.length-1]&&(this.__destination+="/"),this.__global=o.global||"window.render",this.__rendermodule=o.rendermodule||{},this.__settings=o.templateSettings?copy(o.templateSettings,copy(doT.templateSettings)):void 0,this.__includes={}}function addexports(exports){for(var ret="",i=0;i<exports.length;i++)ret+="itself."+exports[i]+"="+exports[i]+";";return ret}function copy(o,to){to=to||{};for(var property in o)to[property]=o[property];return to}function readdata(path){var data=fs.readFileSync(path);return data?data.toString():void console.log("problems with "+path)}var fs=require("fs"),doT=module.exports=require("./doT");doT.process=function(options){return new InstallDots(options).compileAll()},InstallDots.prototype.compileToFile=function(path,template,def){def=def||{};var fn,modulename=path.substring(path.lastIndexOf("/")+1,path.lastIndexOf(".")),defs=copy(this.__includes,copy(def)),settings=this.__settings||doT.templateSettings,compileoptions=copy(settings),defaultcompiled=doT.template(template,settings,defs),exports=[],compiled="";for(var property in defs)defs[property]!==def[property]&&defs[property]!==this.__includes[property]&&(fn=void 0,"string"==typeof defs[property]?fn=doT.template(defs[property],settings,defs):"function"==typeof defs[property]?fn=defs[property]:defs[property].arg&&(compileoptions.varname=defs[property].arg,fn=doT.template(defs[property].text,compileoptions,defs)),fn&&(compiled+=fn.toString().replace("anonymous",property),exports.push(property)));compiled+=defaultcompiled.toString().replace("anonymous",modulename),fs.writeFileSync(path,"(function(){"+compiled+"var itself="+modulename+", _encodeHTML=("+doT.encodeHTMLSource.toString()+"("+(settings.doNotSkipEncoded||"")+"));"+addexports(exports)+"if(typeof module!=='undefined' && module.exports) module.exports=itself;else if(typeof define==='function')define(function(){return itself;});else {"+this.__global+"="+this.__global+"||{};"+this.__global+"['"+modulename+"']=itself;}}());")},InstallDots.prototype.compilePath=function(path){var data=readdata(path);return data?doT.template(data,this.__settings||doT.templateSettings,copy(this.__includes)):void 0},InstallDots.prototype.compileAll=function(){console.log("Compiling all doT templates...");var k,l,name,defFolder=this.__path,sources=fs.readdirSync(defFolder);for(k=0,l=sources.length;l>k;k++)name=sources[k],/\.def(\.dot|\.jst)?$/.test(name)&&(console.log("Loaded def "+name),this.__includes[name.substring(0,name.indexOf("."))]=readdata(defFolder+name));for(k=0,l=sources.length;l>k;k++)name=sources[k],/\.dot(\.def|\.jst)?$/.test(name)&&(console.log("Compiling "+name+" to function"),this.__rendermodule[name.substring(0,name.indexOf("."))]=this.compilePath(defFolder+name)),/\.jst(\.dot|\.def)?$/.test(name)&&(console.log("Compiling "+name+" to file"),this.compileToFile(this.__destination+name.substring(0,name.indexOf("."))+".js",readdata(defFolder+name)));return this.__rendermodule}},{"./doT":40,fs:37}],42:[function(require,module,exports){"use strict";exports.RenderType={IMAGE:"image",DATAURL:"data-url"},exports.ImageFormat={PNG:"image/png",JPEG:"image/jpeg"};Object.defineProperty(exports,"__esModule",{value:!0})},{}],43:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),bluebird=_interopRequire(require("bluebird")),RenderImage=_interopRequire(require("./lib/render-image")),ImageExporter=_interopRequire(require("./lib/image-exporter")),_constants=require("./constants"),RenderType=_constants.RenderType,ImageFormat=_constants.ImageFormat,Utils=_interopRequire(require("./lib/utils")),NightUI=_interopRequire(require("./ui/night/ui"));bluebird.onPossiblyUnhandledRejection(function(error){throw error});var ImglyKit=function(){function ImglyKit(options){if(_classCallCheck(this,ImglyKit),"undefined"==typeof options)throw new Error("No options given.");if(options=_.defaults(options,{assetsUrl:"assets",container:null,ui:!0,renderOnWindowResize:!1}),this._options=options,"undefined"==typeof this._options.image)throw new Error("`options.image` is undefined.");this.operationsStack=[],this._registeredUIs={},this._registerUIs(),this._registeredOperations={},this._registerOperations(),this._options.ui&&(this._initUI(),this._options.renderOnWindowResize&&this._handleWindowResize())}return _prototypeProperties(ImglyKit,null,{render:{value:function(renderType,imageFormat,dimensions){var settings=ImageExporter.validateSettings(renderType,imageFormat);renderType=settings.renderType,imageFormat=settings.imageFormat;var renderImage=new RenderImage(this._options.image,this.operationsStack,dimensions,this._options.renderer),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.operationsStack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&(operation.dirty=!0)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return renderImage.render().then(function(){var canvas=renderImage.getRenderer().getCanvas();return ImageExporter["export"](canvas,renderType,imageFormat)})},writable:!0,configurable:!0},reset:{value:function(){},writable:!0,configurable:!0},getAssetPath:{value:function(asset){var isBrowser="undefined"!=typeof window;if(isBrowser)return this._options.assetsUrl+"/"+asset;var path=require("path");return path.resolve(this._options.assetsUrl,asset)},writable:!0,configurable:!0},_handleWindowResize:{value:function(){var _this=this,timer=null;window.addEventListener("resize",function(){null!==timer&&clearTimeout(timer),timer=setTimeout(function(){timer=null,_this.ui.render()},300)})},writable:!0,configurable:!0},_registerUIs:{value:function(){this.registerUI(NightUI)},writable:!0,configurable:!0},_registerOperations:{value:function(){for(var operationName in ImglyKit.Operations)this.registerOperation(ImglyKit.Operations[operationName])},writable:!0,configurable:!0},registerOperation:{value:function(operation){this._registeredOperations[operation.prototype.identifier]=operation},writable:!0,configurable:!0},registerUI:{value:function(ui){this._registeredUIs[ui.prototype.identifier]=ui},writable:!0,configurable:!0},_initUI:{value:function(){var UI;if(UI=this._options.ui===!0?Utils.values(this._registeredUIs)[0]:this._registeredUIs[this._options.ui],"undefined"==typeof UI)throw new Error("ImglyKit: Unknown UI: "+this._options.ui);this.ui=new UI(this,this._options)},writable:!0,configurable:!0},registeredOperations:{get:function(){return this._registeredOperations},configurable:!0},run:{value:function(){"undefined"!=typeof this.ui&&this.ui.run()},writable:!0,configurable:!0}}),ImglyKit}();ImglyKit.version="2.0.0-beta3",ImglyKit.RenderImage=RenderImage,ImglyKit.Color=require("./lib/color"),ImglyKit.Filter=require("./operations/filters/filter"),ImglyKit.Operation=require("./operations/operation"),ImglyKit.Operations={},ImglyKit.Operations.Filters=require("./operations/filters-operation"),ImglyKit.Operations.Crop=require("./operations/crop-operation"),ImglyKit.Operations.Rotation=require("./operations/rotation-operation"),ImglyKit.Operations.Saturation=require("./operations/saturation-operation"),ImglyKit.Operations.Contrast=require("./operations/contrast-operation"),ImglyKit.Operations.Brightness=require("./operations/brightness-operation"),ImglyKit.Operations.Flip=require("./operations/flip-operation"),ImglyKit.Operations.TiltShift=require("./operations/tilt-shift-operation"),ImglyKit.Operations.RadialBlur=require("./operations/radial-blur-operation"),ImglyKit.Operations.Text=require("./operations/text-operation"),ImglyKit.Operations.Stickers=require("./operations/stickers-operation"),ImglyKit.Operations.Frames=require("./operations/frames-operation"),ImglyKit.Filters={},ImglyKit.Filters.A15=require("./operations/filters/a15-filter"),ImglyKit.Filters.Breeze=require("./operations/filters/breeze-filter"),ImglyKit.Filters.BW=require("./operations/filters/bw-filter"),ImglyKit.Filters.BWHard=require("./operations/filters/bwhard-filter"),ImglyKit.Filters.Celsius=require("./operations/filters/celsius-filter"),ImglyKit.Filters.Chest=require("./operations/filters/chest-filter"),ImglyKit.Filters.Fixie=require("./operations/filters/fixie-filter"),ImglyKit.Filters.Food=require("./operations/filters/food-filter"),ImglyKit.Filters.Fridge=require("./operations/filters/fridge-filter"),ImglyKit.Filters.Front=require("./operations/filters/front-filter"),ImglyKit.Filters.Glam=require("./operations/filters/glam-filter"),ImglyKit.Filters.Gobblin=require("./operations/filters/gobblin-filter"),ImglyKit.Filters.K1=require("./operations/filters/k1-filter"),ImglyKit.Filters.K2=require("./operations/filters/k2-filter"),ImglyKit.Filters.K6=require("./operations/filters/k6-filter"),ImglyKit.Filters.KDynamic=require("./operations/filters/kdynamic-filter"),ImglyKit.Filters.Lenin=require("./operations/filters/lenin-filter"),ImglyKit.Filters.Lomo=require("./operations/filters/lomo-filter"),ImglyKit.Filters.Mellow=require("./operations/filters/mellow-filter"),ImglyKit.Filters.Morning=require("./operations/filters/morning-filter"),ImglyKit.Filters.Orchid=require("./operations/filters/orchid-filter"),ImglyKit.Filters.Pola=require("./operations/filters/pola-filter"),ImglyKit.Filters.Pola669=require("./operations/filters/pola669-filter"),ImglyKit.Filters.Quozi=require("./operations/filters/quozi-filter"),ImglyKit.Filters.Semired=require("./operations/filters/semired-filter"),ImglyKit.Filters.Sunny=require("./operations/filters/sunny-filter"),ImglyKit.Filters.Texas=require("./operations/filters/texas-filter"),ImglyKit.Filters.X400=require("./operations/filters/x400-filter"),ImglyKit.RenderType=RenderType,ImglyKit.ImageFormat=ImageFormat,ImglyKit.Vector2=require("./lib/math/vector2"),module.exports=ImglyKit},{"./constants":42,"./lib/color":44,"./lib/image-exporter":48,"./lib/math/vector2":49,"./lib/render-image":50,"./lib/utils":51,"./operations/brightness-operation":52,"./operations/contrast-operation":53,"./operations/crop-operation":54,"./operations/filters-operation":55,"./operations/filters/a15-filter":56,"./operations/filters/breeze-filter":57,"./operations/filters/bw-filter":58,"./operations/filters/bwhard-filter":59,"./operations/filters/celsius-filter":60,"./operations/filters/chest-filter":61,"./operations/filters/filter":62,"./operations/filters/fixie-filter":63,"./operations/filters/food-filter":64,"./operations/filters/fridge-filter":65,"./operations/filters/front-filter":66,"./operations/filters/glam-filter":67,"./operations/filters/gobblin-filter":68,"./operations/filters/k1-filter":70,"./operations/filters/k2-filter":71,"./operations/filters/k6-filter":72,"./operations/filters/kdynamic-filter":73,"./operations/filters/lenin-filter":74,"./operations/filters/lomo-filter":75,"./operations/filters/mellow-filter":76,"./operations/filters/morning-filter":77,"./operations/filters/orchid-filter":78,"./operations/filters/pola-filter":79,"./operations/filters/pola669-filter":80,"./operations/filters/quozi-filter":94,"./operations/filters/semired-filter":95,"./operations/filters/sunny-filter":96,"./operations/filters/texas-filter":97,"./operations/filters/x400-filter":98,"./operations/flip-operation":99,"./operations/frames-operation":100,"./operations/operation":101,"./operations/radial-blur-operation":102,"./operations/rotation-operation":103,"./operations/saturation-operation":104,"./operations/stickers-operation":105,"./operations/text-operation":106,"./operations/tilt-shift-operation":107,"./ui/night/ui":131,bluebird:4,lodash:"lodash",path:38}],44:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Color=function(){function Color(r,g,b,a){_classCallCheck(this,Color),"undefined"==typeof a&&(a=1),this.r=r,this.g=g,this.b=b,this.a=a}return _prototypeProperties(Color,null,{toRGBA:{value:function(){var colors=[Math.round(255*this.r),Math.round(255*this.g),Math.round(255*this.b),this.a];return"rgba("+colors.join(",")+")"},writable:!0,configurable:!0},toHex:{value:function(){var components=[this._componentToHex(Math.round(255*this.r)),this._componentToHex(Math.round(255*this.g)),this._componentToHex(Math.round(255*this.b))];return"#"+components.join("")},writable:!0,configurable:!0},toGLColor:{value:function(){return[this.r,this.g,this.b,this.a]},writable:!0,configurable:!0},toRGBGLColor:{value:function(){return[this.r,this.g,this.b]
},writable:!0,configurable:!0},toHSV:{value:function(){var max=Math.max(this.r,this.g,this.b),min=Math.min(this.r,this.g,this.b),h=void 0,s=void 0,v=max,d=max-min;if(s=0===max?0:d/max,max==min)h=0;else{switch(max){case this.r:h=(this.g-this.b)/d+(this.g<this.b?6:0);break;case this.g:h=(this.b-this.r)/d+2;break;case this.b:h=(this.r-this.g)/d+4}h/=6}return[h,s,v]},writable:!0,configurable:!0},fromHSV:{value:function(h,s,v){var _ref=this,r=_ref.r,g=_ref.g,b=_ref.b,i=Math.floor(6*h),f=6*h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}this.r=r,this.g=g,this.b=b},writable:!0,configurable:!0},clone:{value:function(){return new Color(this.r,this.g,this.b,this.a)},writable:!0,configurable:!0},_componentToHex:{value:function(component){var hex=component.toString(16);return 1==hex.length?"0"+hex:hex},writable:!0,configurable:!0},toString:{value:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},writable:!0,configurable:!0}}),Color}();module.exports=Color},{}],45:[function(require,module){"use strict";function error(message){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];console.error.apply(console,[message].concat(args)),console.trace()}var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},DEFAULT_MAX_LISTENERS=12,EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter),this._maxListeners=DEFAULT_MAX_LISTENERS,this._events={}}return _prototypeProperties(EventEmitter,null,{on:{value:function(type,listener){if("function"!=typeof listener)throw new TypeError;var listeners=this._events[type]||(this._events[type]=[]);return-1!=listeners.indexOf(listener)?this:(listeners.push(listener),listeners.length>this._maxListeners&&error("possible memory leak, added %i %s listeners, use EventEmitter#setMaxListeners(number) if you want to increase the limit (%i now)",listeners.length,type,this._maxListeners),this)},writable:!0,configurable:!0},once:{value:function(type,listener){function onceCallback(){eventsInstance.off(type,onceCallback),listener.apply(null,arguments)}var eventsInstance=this;return this.on(type,onceCallback)},writable:!0,configurable:!0},off:{value:function(type){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];if(0===args.length)return this._events[type]=null,this;var listener=arguments[1];if("function"!=typeof listener)throw new TypeError;var listeners=this._events[type];if(!listeners||!listeners.length)return this;var indexOfListener=listeners.indexOf(listener);return-1==indexOfListener?this:(listeners.splice(indexOfListener,1),this)},writable:!0,configurable:!0},emit:{value:function(type){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];var listeners=this._events[type];return listeners&&listeners.length?(listeners.forEach(function(fn){return fn.apply(null,args)}),!0):!1},writable:!0,configurable:!0},setMaxListeners:{value:function(newMaxListeners){if(parseInt(newMaxListeners)!==newMaxListeners)throw new TypeError;this._maxListeners=newMaxListeners},writable:!0,configurable:!0}}),EventEmitter}();module.exports=EventEmitter},{}],46:[function(require,module){"use strict";module.exports=function(prototypeProperties,classProperties){var child,parent=this;child=prototypeProperties&&prototypeProperties.hasOwnProperty("constructor")?prototypeProperties.constructor:function(){return parent.apply(this,arguments)};var key;for(key in parent)child[key]=parent[key];if("undefined"!=typeof classProperties)for(key in classProperties)child[key]=classProperties[key];var Surrogate=function(){this.constructor=child};if(Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,prototypeProperties)for(key in prototypeProperties)child.prototype[key]=prototypeProperties[key];return child.__super__=parent.prototype,child}},{}],47:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},ImageDimensions=function(){function ImageDimensions(dimensions){_classCallCheck(this,ImageDimensions),this._modifiers={FIXED:"!"},this._dimensionsString=dimensions,this._rules=this._parse(),this._validateRules()}return _prototypeProperties(ImageDimensions,null,{_parse:{value:function(){if("undefined"==typeof this._dimensionsString)return null;var match=this._dimensionsString.match(/^([0-9]+)?x([0-9]+)?([\!])?$/i);if(!match)throw new Error("Invalid size option: "+this._dimensionsString);return{x:isNaN(match[1])?null:parseInt(match[1]),y:isNaN(match[2])?null:parseInt(match[2]),modifier:match[3]}},writable:!0,configurable:!0},_validateRules:{value:function(){if(null!==this._rules){var xAvailable=null!==this._rules.x,yAvailable=null!==this._rules.y;if(!(this._rules.modifier!==this._modifiers.FIXED||xAvailable&&yAvailable))throw new Error("Both `x` and `y` have to be set when using the fixed (!) modifier.");if(!xAvailable&&!yAvailable)throw new Error("Neither `x` nor `y` are given.")}},writable:!0,configurable:!0},calculateFinalDimensions:{value:function(initialDimensions){var ratio,dimensions=initialDimensions.clone();return null===this._rules?dimensions:(this._rules.modifier===this._modifiers.FIXED?dimensions.set(this._rules.x,this._rules.y):null!==this._rules.x&&null!==this._rules.y?(ratio=Math.min(this._rules.x/dimensions.x,this._rules.y/dimensions.y),dimensions.multiply(ratio)):null!==this._rules.x?(ratio=initialDimensions.y/initialDimensions.x,dimensions.x=this._rules.x,dimensions.y=dimensions.x*ratio):null!==this._rules.y&&(ratio=initialDimensions.x/initialDimensions.y,dimensions.y=this._rules.y,dimensions.x=dimensions.y*ratio),dimensions)},writable:!0,configurable:!0}}),ImageDimensions}();module.exports=ImageDimensions},{}],48:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_constants=require("../constants"),RenderType=_constants.RenderType,ImageFormat=_constants.ImageFormat,Utils=_interopRequire(require("./utils")),ImageExporter=function(){function ImageExporter(){_classCallCheck(this,ImageExporter)}return _prototypeProperties(ImageExporter,{validateSettings:{value:function(renderType,imageFormat){var settings={renderType:renderType,imageFormat:imageFormat};if("undefined"!=typeof settings.renderType&&null!==settings.renderType&&-1===Utils.values(RenderType).indexOf(settings.renderType))throw new Error("Invalid render type: "+settings.renderType);if("undefined"==typeof renderType&&(settings.renderType=RenderType.DATA_URL),"undefined"!=typeof settings.imageFormat&&null!==settings.imageFormat&&-1===Utils.values(ImageFormat).indexOf(settings.imageFormat))throw new Error("Invalid image format: "+settings.imageFormat);return"undefined"==typeof imageFormat&&(settings.imageFormat=ImageFormat.PNG),settings},writable:!0,configurable:!0},"export":{value:function(canvas,renderType,imageFormat){var result=canvas.toDataURL(imageFormat);if(renderType==RenderType.IMAGE){var image;if("undefined"==typeof window){var CanvasImage=require("canvas").Image;image=new CanvasImage}else image=new Image;image.src=result,result=image}return result},writable:!0,configurable:!0}}),ImageExporter}();module.exports=ImageExporter},{"../constants":42,"./utils":51,canvas:"canvas"}],49:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=function(){function Vector2(x,y){_classCallCheck(this,Vector2),this.x=x,this.y=y,"undefined"==typeof this.x&&(this.x=0),"undefined"==typeof this.y&&(this.y=0)}return _prototypeProperties(Vector2,null,{set:{value:function(x,y){return this.x=x,this.y=y,this},writable:!0,configurable:!0},clone:{value:function(){return new Vector2(this.x,this.y)},writable:!0,configurable:!0},copy:{value:function(other){return this.x=other.x,this.y=other.y,this},writable:!0,configurable:!0},clamp:{value:function(minimum,maximum){var minimumSet=null!==minimum&&"undefined"!=typeof minimum,maximumSet=null!==maximum&&"undefined"!=typeof maximum;return minimum instanceof Vector2||!minimumSet||(minimum=new Vector2(minimum,minimum)),maximum instanceof Vector2||!maximumSet||(maximum=new Vector2(maximum,maximum)),minimumSet&&(this.x=Math.max(minimum.x,this.x),this.y=Math.max(minimum.y,this.y)),maximumSet&&(this.x=Math.min(maximum.x,this.x),this.y=Math.min(maximum.y,this.y)),this},writable:!0,configurable:!0},divide:{value:function(divisor,y){return divisor instanceof Vector2?(this.x/=divisor.x,this.y/=divisor.y):(this.x/=divisor,this.y/="undefined"==typeof y?divisor:y),this},writable:!0,configurable:!0},subtract:{value:function(subtrahend,y){return subtrahend instanceof Vector2?(this.x-=subtrahend.x,this.y-=subtrahend.y):(this.x-=subtrahend,this.y-="undefined"==typeof y?subtrahend:y),this},writable:!0,configurable:!0},multiply:{value:function(factor,y){return factor instanceof Vector2?(this.x*=factor.x,this.y*=factor.y):(this.x*=factor,this.y*="undefined"==typeof y?factor:y),this},writable:!0,configurable:!0},add:{value:function(addend,y){return addend instanceof Vector2?(this.x+=addend.x,this.y+=addend.y):(this.x+=addend,this.y+="undefined"==typeof y?addend:y),this},writable:!0,configurable:!0},equals:{value:function(vec,y){return vec instanceof Vector2?vec.x===this.x&&vec.y===this.y:vec===this.x&&y===this.y},writable:!0,configurable:!0},flip:{value:function(){var tempX=this.x;return this.x=this.y,this.y=tempX,this},writable:!0,configurable:!0},toString:{value:function(){return"Vector2({ x: "+this.x+", y: "+this.y+" })"},writable:!0,configurable:!0}}),Vector2}();module.exports=Vector2},{}],50:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},bluebird=_interopRequire(require("bluebird")),ImageDimensions=_interopRequire(require("./image-dimensions")),Vector2=_interopRequire(require("./math/vector2")),CanvasRenderer=_interopRequire(require("../renderers/canvas-renderer")),WebGLRenderer=_interopRequire(require("../renderers/webgl-renderer")),RenderImage=function(){function RenderImage(image,operationsStack,dimensions,preferredRenderer){_classCallCheck(this,RenderImage),this._options={preferredRenderer:preferredRenderer},this._webglEnabled=!1,this._renderer=null,this._image=image,this._stack=operationsStack,this._dimensions=new ImageDimensions(dimensions),this._initialDimensions=new Vector2(this._image.width,this._image.height),this._initRenderer()}return _prototypeProperties(RenderImage,null,{_initRenderer:{value:function(){if(WebGLRenderer.isSupported()&&"canvas"!==this._options.preferredRenderer?(this._renderer=new WebGLRenderer(this._initialDimensions),this._webglEnabled=!0):CanvasRenderer.isSupported()&&(this._renderer=new CanvasRenderer(this._initialDimensions),this._webglEnabled=!1),null===this._renderer)throw new Error("Neither Canvas nor WebGL renderer are supported.");this._renderer.drawImage(this._image)},writable:!0,configurable:!0},render:{value:function(){var stack=this.sanitizedStack,self=this;return bluebird.map(stack,function(operation){return operation.validateSettings()}).then(function(){return bluebird.map(stack,function(operation){return operation.render(self._renderer)},{concurrency:1}).then(function(){return self._renderer.renderFinal()})}).then(function(){var initialSize=self._renderer.getSize(),finalDimensions=self._dimensions.calculateFinalDimensions(initialSize);return finalDimensions.equals(initialSize)?void 0:self._renderer.resizeTo(finalDimensions)})},writable:!0,configurable:!0},getRenderer:{value:function(){return this._renderer},writable:!0,configurable:!0},sanitizedStack:{get:function(){var sanitizedStack=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._stack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&sanitizedStack.push(operation)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return sanitizedStack},configurable:!0}}),RenderImage}();module.exports=RenderImage},{"../renderers/canvas-renderer":108,"../renderers/webgl-renderer":110,"./image-dimensions":47,"./math/vector2":49,bluebird:4}],51:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=_interopRequire(require("./math/vector2")),Utils=function(){function Utils(){_classCallCheck(this,Utils)}return _prototypeProperties(Utils,{isArray:{value:function(object){return"[object Array]"===Object.prototype.toString.call(object)},writable:!0,configurable:!0},select:{value:function(items){var selector=void 0===arguments[1]?null:arguments[1];if(null===selector)return items;if("string"==typeof selector&&(selector=selector.split(",").map(function(identifier){return identifier.trim()})),Utils.isArray(selector)&&(selector={only:selector}),"undefined"!=typeof selector.only)return"string"==typeof selector.only&&(selector.only=selector.only.split(",").map(function(identifier){return identifier.trim()})),items.filter(function(item){return-1!==selector.only.indexOf(item)});if("undefined"!=typeof selector.except)return"string"==typeof selector.except&&(selector.except=selector.except.split(",").map(function(identifier){return identifier.trim()})),items.filter(function(item){return-1===selector.except.indexOf(item)});throw new Error("Utils#select failed to filter items.")},writable:!0,configurable:!0},values:{value:function(_values){var _valuesWrapper=function(){return _values.apply(this,arguments)};return _valuesWrapper.toString=function(){return _values.toString()},_valuesWrapper}(function(object){var values=[];for(var key in object)values.push(object[key]);return values}),writable:!0,configurable:!0},isDOMElement:{value:function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName},writable:!0,configurable:!0},getEventPosition:{value:function(e){var x=e.pageX,y=e.pageY;return-1!==e.type.indexOf("touch")&&(x=e.touches[0].pageX,y=e.touches[0].pageY),new Vector2(x,y)},writable:!0,configurable:!0}}),Utils}();module.exports=Utils},{"./math/vector2":49}],52:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),BrightnessPrimitive=_interopRequire(require("./filters/primitives/brightness")),BrightnessOperation=function(Operation){function BrightnessOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,BrightnessOperation),this.availableOptions={brightness:{type:"number","default":0}},_get(Object.getPrototypeOf(BrightnessOperation.prototype),"constructor",this).apply(this,args)}return _inherits(BrightnessOperation,Operation),_prototypeProperties(BrightnessOperation,null,{identifier:{get:function(){return"brightness"},configurable:!0},_renderWebGL:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new BrightnessPrimitive({brightness:this._options.brightness})),stack.render(renderer)},writable:!0,configurable:!0}}),BrightnessOperation}(Operation);module.exports=BrightnessOperation},{"./filters/primitives-stack":81,"./filters/primitives/brightness":82,"./operation":101}],53:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),ContrastPrimitive=_interopRequire(require("./filters/primitives/contrast")),ContrastOperation=function(Operation){function ContrastOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,ContrastOperation),this.availableOptions={contrast:{type:"number","default":1}},_get(Object.getPrototypeOf(ContrastOperation.prototype),"constructor",this).apply(this,args)}return _inherits(ContrastOperation,Operation),_prototypeProperties(ContrastOperation,null,{identifier:{get:function(){return"contrast"},configurable:!0},_renderWebGL:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new ContrastPrimitive({contrast:this._options.contrast})),stack.render(renderer)},writable:!0,configurable:!0}}),ContrastOperation}(Operation);module.exports=ContrastOperation},{"./filters/primitives-stack":81,"./filters/primitives/contrast":83,"./operation":101}],54:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),CropOperation=function(Operation){function CropOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,CropOperation),this.availableOptions={start:{type:"vector2",required:!0,"default":new Vector2(0,0)},end:{type:"vector2",required:!0,"default":new Vector2(1,1)}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n      uniform vec2 u_cropStart;\n      uniform vec2 u_cropEnd;\n\n      void main() {\n        vec2 size = u_cropEnd - u_cropStart;\n        gl_FragColor = texture2D(u_image, v_texCoord * size + u_cropStart);\n      }\n    ",_get(Object.getPrototypeOf(CropOperation.prototype),"constructor",this).apply(this,args)}return _inherits(CropOperation,Operation),_prototypeProperties(CropOperation,null,{identifier:{get:function(){return"crop"},configurable:!0},_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),start=this._options.start.clone(),end=this._options.end.clone();"absolute"===this._options.numberFormat&&(start.divide(canvasSize),end.divide(canvasSize));var originalStartY=start.y;start.y=1-end.y,end.y=1-originalStartY;var newDimensions=this.getNewDimensions(renderer);canvas.width=newDimensions.x,canvas.height=newDimensions.y,renderer.runShader(null,this.fragmentShader,{uniforms:{u_cropStart:{type:"2f",value:[start.x,start.y]},u_cropEnd:{type:"2f",value:[end.x,end.y]}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),dimensions=new Vector2(canvas.width,canvas.height),newDimensions=this.getNewDimensions(renderer),newCanvas=renderer.createCanvas();newCanvas.width=newDimensions.x,newCanvas.height=newDimensions.y;var newContext=newCanvas.getContext("2d"),startPosition=this._options.start.clone();"relative"===this._options.numberFormat&&startPosition.multiply(dimensions),newContext.drawImage(canvas,startPosition.x,startPosition.y,newDimensions.x,newDimensions.y,0,0,newDimensions.x,newDimensions.y),renderer.setCanvas(newCanvas)},writable:!0,configurable:!0},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();dimensions=dimensions||new Vector2(canvas.width,canvas.height);var newDimensions=this._options.end.clone().subtract(this._options.start);return"relative"===this._options.numberFormat&&newDimensions.multiply(dimensions),newDimensions},writable:!0,configurable:!0}}),CropOperation}(Operation);module.exports=CropOperation},{"../lib/math/vector2":49,"./operation":101}],55:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),IdentityFilter=_interopRequire(require("./filters/identity-filter")),FiltersOperation=function(Operation){function FiltersOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FiltersOperation),this.availableOptions={filter:{type:"object","default":IdentityFilter,setter:function(Filter){return this._selectedFilter=new Filter,Filter}}},_get(Object.getPrototypeOf(FiltersOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FiltersOperation,Operation),_prototypeProperties(FiltersOperation,null,{identifier:{get:function(){return"filters"},configurable:!0},_renderWebGL:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_render:{value:function(renderer){this._selectedFilter.render(renderer)},writable:!0,configurable:!0}}),FiltersOperation}(Operation);module.exports=FiltersOperation},{"./filters/identity-filter":69,"./operation":101}],56:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),A15Filter=function(Filter){function A15Filter(){_classCallCheck(this,A15Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(A15Filter,Filter),_prototypeProperties(A15Filter,{identifier:{get:function(){return"a15"},configurable:!0}},{name:{get:function(){return"15"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Contrast({contrast:.63})),stack.add(new Filter.Primitives.Brightness({brightness:.12})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,38],[94,94],[148,142],[175,187],[255,255]],green:[[0,0],[77,53],[171,190],[255,255]],blue:[[0,10],[48,85],[174,228],[255,255]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),A15Filter}(Filter);module.exports=A15Filter},{"./filter":62}],57:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BreezeFilter=function(Filter){function BreezeFilter(){_classCallCheck(this,BreezeFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(BreezeFilter,Filter),_prototypeProperties(BreezeFilter,{identifier:{get:function(){return"breeze"},configurable:!0}},{name:{get:function(){return"Breeze"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.5})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[170,170],[212,219],[234,242],[255,255]],green:[[0,0],[170,168],[234,231],[255,255]],blue:[[0,0],[170,170],[212,208],[255,255]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),BreezeFilter}(Filter);module.exports=BreezeFilter},{"./filter":62}],58:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BWFilter=function(Filter){function BWFilter(){_classCallCheck(this,BWFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(BWFilter,Filter),_prototypeProperties(BWFilter,{identifier:{get:function(){return"bw"},configurable:!0}},{name:{get:function(){return"B&W"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Grayscale),stack.render(renderer)},writable:!0,configurable:!0}}),BWFilter
}(Filter);module.exports=BWFilter},{"./filter":62}],59:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BWHardFilter=function(Filter){function BWHardFilter(){_classCallCheck(this,BWHardFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(BWHardFilter,Filter),_prototypeProperties(BWHardFilter,{identifier:{get:function(){return"bwhard"},configurable:!0}},{name:{get:function(){return"1920"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Grayscale),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)},writable:!0,configurable:!0}}),BWHardFilter}(Filter);module.exports=BWHardFilter},{"./filter":62}],60:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),CelsiusFilter=function(Filter){function CelsiusFilter(){_classCallCheck(this,CelsiusFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(CelsiusFilter,Filter),_prototypeProperties(CelsiusFilter,{identifier:{get:function(){return"celsius"},configurable:!0}},{name:{get:function(){return"Celsius"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,69],[55,110],[202,230],[255,255]],green:[[0,44],[89,93],[185,141],[255,189]],blue:[[0,76],[39,82],[218,138],[255,171]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),CelsiusFilter}(Filter);module.exports=CelsiusFilter},{"./filter":62}],61:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),ChestFilter=function(Filter){function ChestFilter(){_classCallCheck(this,ChestFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(ChestFilter,Filter),_prototypeProperties(ChestFilter,{identifier:{get:function(){return"chest"},configurable:!0}},{name:{get:function(){return"Chest"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[44,44],[124,143],[221,204],[255,255]],green:[[0,0],[130,127],[213,199],[255,255]],blue:[[0,0],[51,52],[219,204],[255,255]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),ChestFilter}(Filter);module.exports=ChestFilter},{"./filter":62}],62:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=function(){function Filter(){_classCallCheck(this,Filter)}return _prototypeProperties(Filter,{identifier:{get:function(){return null},configurable:!0}},{render:{value:function(){throw new Error("Filter#render is abstract and not implemented in inherited class.")},writable:!0,configurable:!0}}),Filter}();Filter.extend=require("../../lib/extend"),Filter.PrimitivesStack=require("./primitives-stack"),Filter.Primitives={},Filter.Primitives.Saturation=require("./primitives/saturation"),Filter.Primitives.LookupTable=require("./primitives/lookup-table"),Filter.Primitives.ToneCurve=require("./primitives/tone-curve"),Filter.Primitives.SoftColorOverlay=require("./primitives/soft-color-overlay"),Filter.Primitives.Desaturation=require("./primitives/desaturation"),Filter.Primitives.X400=require("./primitives/x400"),Filter.Primitives.Grayscale=require("./primitives/grayscale"),Filter.Primitives.Contrast=require("./primitives/contrast"),Filter.Primitives.Glow=require("./primitives/glow"),Filter.Primitives.Gobblin=require("./primitives/gobblin"),Filter.Primitives.Brightness=require("./primitives/brightness"),module.exports=Filter},{"../../lib/extend":46,"./primitives-stack":81,"./primitives/brightness":82,"./primitives/contrast":83,"./primitives/desaturation":84,"./primitives/glow":85,"./primitives/gobblin":86,"./primitives/grayscale":87,"./primitives/lookup-table":88,"./primitives/saturation":90,"./primitives/soft-color-overlay":91,"./primitives/tone-curve":92,"./primitives/x400":93}],63:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FixieFilter=function(Filter){function FixieFilter(){_classCallCheck(this,FixieFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(FixieFilter,Filter),_prototypeProperties(FixieFilter,{identifier:{get:function(){return"fixie"},configurable:!0}},{name:{get:function(){return"Fixie"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[44,28],[63,48],[128,132],[235,248],[255,255]],green:[[0,0],[20,10],[60,45],[190,209],[211,231],[255,255]],blue:[[0,31],[41,62],[150,142],[234,212],[255,224]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),FixieFilter}(Filter);module.exports=FixieFilter},{"./filter":62}],64:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FoodFilter=function(Filter){function FoodFilter(){_classCallCheck(this,FoodFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(FoodFilter,Filter),_prototypeProperties(FoodFilter,{identifier:{get:function(){return"food"},configurable:!0}},{name:{get:function(){return"Food"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Saturation({saturation:1.35})),stack.add(new Filter.Primitives.Contrast({contrast:1.1})),stack.render(renderer)},writable:!0,configurable:!0}}),FoodFilter}(Filter);module.exports=FoodFilter},{"./filter":62}],65:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FridgeFilter=function(Filter){function FridgeFilter(){_classCallCheck(this,FridgeFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(FridgeFilter,Filter),_prototypeProperties(FridgeFilter,{identifier:{get:function(){return"fridge"},configurable:!0}},{name:{get:function(){return"Fridge"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,9],[21,11],[45,24],[255,220]],green:[[0,12],[21,21],[42,42],[150,150],[170,173],[255,210]],blue:[[0,28],[43,72],[128,185],[255,220]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),FridgeFilter}(Filter);module.exports=FridgeFilter},{"./filter":62}],66:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FrontFilter=function(Filter){function FrontFilter(){_classCallCheck(this,FrontFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(FrontFilter,Filter),_prototypeProperties(FrontFilter,{identifier:{get:function(){return"front"},configurable:!0}},{name:{get:function(){return"Front"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,65],[28,67],[67,113],[125,183],[187,217],[255,229]],green:[[0,52],[42,59],[104,134],[169,209],[255,240]],blue:[[0,52],[65,68],[93,104],[150,153],[255,198]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),FrontFilter}(Filter);module.exports=FrontFilter},{"./filter":62}],67:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),GlamFilter=function(Filter){function GlamFilter(){_classCallCheck(this,GlamFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(GlamFilter,Filter),_prototypeProperties(GlamFilter,{identifier:{get:function(){return"glam"},configurable:!0}},{name:{get:function(){return"Glam"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Contrast({contrast:1.1})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[127,127],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),GlamFilter}(Filter);module.exports=GlamFilter},{"./filter":62}],68:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),GobblinFilter=function(Filter){function GobblinFilter(){_classCallCheck(this,GobblinFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(GobblinFilter,Filter),_prototypeProperties(GobblinFilter,{identifier:{get:function(){return"gobblin"},configurable:!0}},{name:{get:function(){return"Gobblin"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Gobblin),stack.render(renderer)},writable:!0,configurable:!0}}),GobblinFilter}(Filter);module.exports=GobblinFilter},{"./filter":62}],69:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),IdentityFilter=function(Filter){function IdentityFilter(){_classCallCheck(this,IdentityFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(IdentityFilter,Filter),_prototypeProperties(IdentityFilter,{identifier:{get:function(){return"identity"},configurable:!0}},{name:{get:function(){return"Original"},configurable:!0},render:{value:function(){},writable:!0,configurable:!0}}),IdentityFilter}(Filter);module.exports=IdentityFilter},{"./filter":62}],70:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),K1Filter=function(Filter){function K1Filter(){_classCallCheck(this,K1Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(K1Filter,Filter),_prototypeProperties(K1Filter,{identifier:{get:function(){return"k1"},configurable:!0}},{name:{get:function(){return"K1"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[53,32],[91,80],[176,205],[255,255]]})),stack.add(new Filter.Primitives.Saturation({saturation:.9})),stack.render(renderer)},writable:!0,configurable:!0}}),K1Filter}(Filter);module.exports=K1Filter},{"./filter":62}],71:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),Color=_interopRequire(require("../../lib/color")),K2Filter=function(Filter){function K2Filter(){_classCallCheck(this,K2Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(K2Filter,Filter),_prototypeProperties(K2Filter,{identifier:{get:function(){return"k2"},configurable:!0}},{name:{get:function(){return"K2"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[54,33],[77,82],[94,103],[122,126],[177,193],[229,232],[255,255]]})),stack.add(new Filter.Primitives.SoftColorOverlay({color:new Color(40/255,40/255,40/255)})),stack.render(renderer)},writable:!0,configurable:!0}}),K2Filter}(Filter);module.exports=K2Filter},{"../../lib/color":44,"./filter":62}],72:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),K6Filter=function(Filter){function K6Filter(){_classCallCheck(this,K6Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(K6Filter,Filter),_prototypeProperties(K6Filter,{identifier:{get:function(){return"k6"},configurable:!0}},{name:{get:function(){return"K6"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Saturation({saturation:.5})),stack.render(renderer)},writable:!0,configurable:!0}}),K6Filter}(Filter);module.exports=K6Filter},{"./filter":62}],73:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),KDynamicFilter=function(Filter){function KDynamicFilter(){_classCallCheck(this,KDynamicFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(KDynamicFilter,Filter),_prototypeProperties(KDynamicFilter,{identifier:{get:function(){return"kdynamic"},configurable:!0}},{name:{get:function(){return"KDynamic"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[17,27],[46,69],[90,112],[156,200],[203,243],[255,255]]})),stack.add(new Filter.Primitives.Saturation({saturation:.7})),stack.render(renderer)},writable:!0,configurable:!0}}),KDynamicFilter}(Filter);module.exports=KDynamicFilter},{"./filter":62}],74:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),LeninFilter=function(Filter){function LeninFilter(){_classCallCheck(this,LeninFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(LeninFilter,Filter),_prototypeProperties(LeninFilter,{identifier:{get:function(){return"lenin"},configurable:!0}},{name:{get:function(){return"Lenin"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.4})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,20],[40,20],[106,111],[129,153],[190,223],[255,255]],green:[[0,20],[40,20],[62,41],[106,108],[132,159],[203,237],[255,255]],blue:[[0,40],[40,40],[73,60],[133,160],[191,297],[203,237],[237,239],[255,255]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),LeninFilter}(Filter);module.exports=LeninFilter},{"./filter":62}],75:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),LomoFilter=function(Filter){function LomoFilter(){_classCallCheck(this,LomoFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(LomoFilter,Filter),_prototypeProperties(LomoFilter,{identifier:{get:function(){return"lomo"},configurable:!0}},{name:{get:function(){return"Lomo"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[87,20],[131,156],[183,205],[255,200]]})),stack.render(renderer)},writable:!0,configurable:!0}}),LomoFilter}(Filter);module.exports=LomoFilter},{"./filter":62}],76:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),MellowFilter=function(Filter){function MellowFilter(){_classCallCheck(this,MellowFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(MellowFilter,Filter),_prototypeProperties(MellowFilter,{identifier:{get:function(){return"mellow"},configurable:!0}},{name:{get:function(){return"Mellow"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[41,84],[87,134],[255,255]],green:[[0,0],[255,216]],blue:[[0,0],[255,131]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),MellowFilter}(Filter);module.exports=MellowFilter},{"./filter":62}],77:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),MorningFilter=function(Filter){function MorningFilter(){_classCallCheck(this,MorningFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(MorningFilter,Filter),_prototypeProperties(MorningFilter,{identifier:{get:function(){return"morning"},configurable:!0}},{name:{get:function(){return"Morning"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,40],[255,230]],green:[[0,10],[255,225]],blue:[[0,20],[255,181]]}})),stack.add(new Filter.Primitives.Glow),stack.render(renderer)},writable:!0,configurable:!0}}),MorningFilter}(Filter);module.exports=MorningFilter},{"./filter":62}],78:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),OrchidFilter=function(Filter){function OrchidFilter(){_classCallCheck(this,OrchidFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(OrchidFilter,Filter),_prototypeProperties(OrchidFilter,{identifier:{get:function(){return"orchid"},configurable:!0}},{name:{get:function(){return"Orchid"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[115,130],[195,215],[255,255]],green:[[0,0],[148,153],[172,215],[255,255]],blue:[[0,46],[58,75],[178,205],[255,255]]}})),stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[117,151],[189,217],[255,255]]})),stack.add(new Filter.Primitives.Desaturation({desaturation:.65})),stack.render(renderer)},writable:!0,configurable:!0}}),OrchidFilter}(Filter);module.exports=OrchidFilter},{"./filter":62}],79:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);
subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),PolaFilter=function(Filter){function PolaFilter(){_classCallCheck(this,PolaFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(PolaFilter,Filter),_prototypeProperties(PolaFilter,{identifier:{get:function(){return"pola"},configurable:!0}},{name:{get:function(){return"Pola SX"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[34,34],[99,76],[176,190],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}})),stack.add(new Filter.Primitives.Saturation({saturation:.8})),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)},writable:!0,configurable:!0}}),PolaFilter}(Filter);module.exports=PolaFilter},{"./filter":62}],80:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),Pola669Filter=function(Filter){function Pola669Filter(){_classCallCheck(this,Pola669Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(Pola669Filter,Filter),_prototypeProperties(Pola669Filter,{identifier:{get:function(){return"pola669"},configurable:!0}},{name:{get:function(){return"Pola 669"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[56,18],[196,209],[255,255]],green:[[0,38],[71,84],[255,255]],blue:[[0,0],[131,133],[204,211],[255,255]]}})),stack.add(new Filter.Primitives.Saturation({saturation:.8})),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)},writable:!0,configurable:!0}}),Pola669Filter}(Filter);module.exports=Pola669Filter},{"./filter":62}],81:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},PrimitivesStack=function(){function PrimitivesStack(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,PrimitivesStack),_get(Object.getPrototypeOf(PrimitivesStack.prototype),"constructor",this).apply(this,args),this._stack=[]}return _prototypeProperties(PrimitivesStack,null,{add:{value:function(primitive){this._stack.push(primitive)},writable:!0,configurable:!0},render:{value:function(renderer){for(var i=0;i<this._stack.length;i++){var primitive=this._stack[i];primitive.render(renderer)}},writable:!0,configurable:!0}}),PrimitivesStack}();module.exports=PrimitivesStack},{}],82:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Brightness=function(Primitive){function Brightness(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Brightness),_get(Object.getPrototypeOf(Brightness.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{brightness:1}),this._fragmentShader="\n\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_brightness;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        gl_FragColor = vec4((texColor.rgb + vec3(u_brightness)), texColor.a);\n      }\n\n    "}return _inherits(Brightness,Primitive),_prototypeProperties(Brightness,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_brightness:{type:"f",value:this._options.brightness}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),brightness=this._options.brightness,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=imageData.data[index]+255*brightness,imageData.data[index+1]=imageData.data[index+1]+255*brightness,imageData.data[index+2]=imageData.data[index+2]+255*brightness}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Brightness}(Primitive);module.exports=Brightness},{"./primitive":89,lodash:"lodash"}],83:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Contrast=function(Primitive){function Contrast(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Contrast),_get(Object.getPrototypeOf(Contrast.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{contrast:1}),this._fragmentShader="\n\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_contrast;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        gl_FragColor = vec4(((texColor.rgb - vec3(0.5)) * u_contrast + vec3(0.5)), texColor.a);\n      }\n\n    "}return _inherits(Contrast,Primitive),_prototypeProperties(Contrast,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_contrast:{type:"f",value:this._options.contrast}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),contrast=this._options.contrast,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=(imageData.data[index]-127)*contrast+127,imageData.data[index+1]=(imageData.data[index+1]-127)*contrast+127,imageData.data[index+2]=(imageData.data[index+2]-127)*contrast+127}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Contrast}(Primitive);module.exports=Contrast},{"./primitive":89,lodash:"lodash"}],84:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Desaturation=function(Primitive){function Desaturation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Desaturation),_get(Object.getPrototypeOf(Desaturation.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{desaturation:1}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_desaturation;\n\n      const vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).xyz;\n        vec3 grayXfer = vec3(0.3, 0.59, 0.11);\n        vec3 gray = vec3(dot(grayXfer, texColor));\n        gl_FragColor = vec4(mix(texColor, gray, u_desaturation), 1.0);\n      }\n    "}return _inherits(Desaturation,Primitive),_prototypeProperties(Desaturation,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_desaturation:{type:"f",value:this._options.desaturation}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),desaturation=this._options.desaturation,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.3*imageData.data[index]+.59*imageData.data[index+1]+.11*imageData.data[index+2];imageData.data[index]=luminance*(1-desaturation)+imageData.data[index]*desaturation,imageData.data[index+1]=luminance*(1-desaturation)+imageData.data[index+1]*desaturation,imageData.data[index+2]=luminance*(1-desaturation)+imageData.data[index+2]*desaturation}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Desaturation}(Primitive);module.exports=Desaturation},{"./primitive":89,lodash:"lodash"}],85:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Color=_interopRequire(require("../../../lib/color")),Glow=function(Primitive){function Glow(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Glow),_get(Object.getPrototypeOf(Glow.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{color:new Color(1,1,1)}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      uniform vec3 u_color;\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).rgb;\n\n        vec2 textureCoord = v_texCoord - vec2(0.5, 0.5);\n        textureCoord /= 0.75;\n\n        float d = 1.0 - dot(textureCoord, textureCoord);\n        d = clamp(d, 0.2, 1.0);\n        vec3 newColor = texColor * d * u_color.rgb;\n        gl_FragColor = vec4(vec3(newColor),1.0);\n      }\n    "}return _inherits(Glow,Primitive),_prototypeProperties(Glow,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_color:{type:"3f",value:this._options.color.toRGBGLColor()}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var d,canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),color=this._options.color,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),x01=x/canvas.width,y01=y/canvas.height,nx=(x01-.5)/.75,ny=(y01-.5)/.75,scalarX=nx*nx,scalarY=ny*ny;d=1-(scalarX+scalarY),d=Math.min(Math.max(d,.1),1),imageData.data[index]=imageData.data[index]*d*color.r,imageData.data[index+1]=imageData.data[index+1]*d*color.g,imageData.data[index+2]=imageData.data[index+2]*d*color.b,imageData.data[index+3]=255}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Glow}(Primitive);module.exports=Glow},{"../../../lib/color":44,"./primitive":89,lodash:"lodash"}],86:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),Gobblin=function(Primitive){function Gobblin(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Gobblin),_get(Object.getPrototypeOf(Gobblin.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        texColor.b = texColor.g * 0.33;\n        texColor.r = texColor.r * 0.6;\n        texColor.b += texColor.r * 0.33;\n        texColor.g = texColor.g * 0.7;\n        gl_FragColor = texColor;\n      }\n    "}return _inherits(Gobblin,Primitive),_prototypeProperties(Gobblin,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index+2]=.33*imageData.data[index+1],imageData.data[index]=.6*imageData.data[index],imageData.data[index+2]+=.33*imageData.data[index],imageData.data[index+1]=.7*imageData.data[index+1],imageData.data[index+3]=255}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Gobblin}(Primitive);module.exports=Gobblin},{"./primitive":89}],87:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),Grayscale=function(Primitive){function Grayscale(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Grayscale),_get(Object.getPrototypeOf(Grayscale.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      vec3 W = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).rgb;\n        float luminance = dot(texColor, W);\n        gl_FragColor = vec4(vec3(luminance), 1.0);\n      }\n    "}return _inherits(Grayscale,Primitive),_prototypeProperties(Grayscale,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.2125*imageData.data[index]+.7154*imageData.data[index+1]+.0721*imageData.data[index+2];imageData.data[index]=luminance,imageData.data[index+1]=luminance,imageData.data[index+2]=luminance}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Grayscale}(Primitive);module.exports=Grayscale},{"./primitive":89}],88:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),LookupTable=function(Primitive){function LookupTable(){_classCallCheck(this,LookupTable),Primitive.apply(this,arguments),this._textureIndex=3,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_lookupTable;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float r = texture2D(u_lookupTable, vec2(texColor.r, 0.0)).r;\n        float g = texture2D(u_lookupTable, vec2(texColor.g, 0.0)).g;\n        float b = texture2D(u_lookupTable, vec2(texColor.b, 0.0)).b;\n\n        gl_FragColor = vec4(r, g, b, texColor.a);\n      }\n    "}return _inherits(LookupTable,Primitive),_prototypeProperties(LookupTable,null,{renderWebGL:{value:function(renderer){this._updateTexture(renderer),renderer.runShader(null,this._fragmentShader,{uniforms:{u_lookupTable:{type:"i",value:3}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),table=this._options.data,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),r=imageData.data[index];imageData.data[index]=table[4*r];var g=imageData.data[index+1];imageData.data[index+1]=table[1+4*g];var b=imageData.data[index+2];imageData.data[index+2]=table[2+4*b]}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0},_updateTexture:{value:function(renderer){var gl=renderer.getContext();if("undefined"==typeof this._options.data)throw new Error("LookupTable: No data specified.");var dataTypedArray=new Uint8Array(this._options.data);gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture||(this._texture=gl.createTexture()),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,256,1,0,gl.RGBA,gl.UNSIGNED_BYTE,dataTypedArray),gl.activeTexture(gl.TEXTURE0)},writable:!0,configurable:!0}}),LookupTable}(Primitive);module.exports=LookupTable},{"./primitive":89}],89:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=function(){function Primitive(options){_classCallCheck(this,Primitive),options=options||{},this._options=options}return _prototypeProperties(Primitive,null,{render:{value:function(renderer){"webgl"===renderer.identifier?this.renderWebGL(renderer):this.renderCanvas(renderer)},writable:!0,configurable:!0},renderWebGL:{value:function(){throw new Error("Primitive#renderWebGL is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},renderCanvas:{value:function(){throw new Error("Primitive#renderCanvas is abstract and not implemented in inherited class.")},writable:!0,configurable:!0}}),Primitive}();module.exports=Primitive},{}],90:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Saturation=function(Primitive){function Saturation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Saturation),_get(Object.getPrototypeOf(Saturation.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{saturation:0}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_saturation;\n\n      const vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float luminance = dot(texColor.rgb, luminanceWeighting);\n\n        vec3 greyScaleColor = vec3(luminance);\n\n        gl_FragColor = vec4(mix(greyScaleColor, texColor.rgb, u_saturation), texColor.a);\n      }\n    "}return _inherits(Saturation,Primitive),_prototypeProperties(Saturation,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_saturation:{type:"f",value:this._options.saturation}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),saturation=this._options.saturation,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.2125*imageData.data[index]+.7154*imageData.data[index+1]+.0721*imageData.data[index+2];imageData.data[index]=luminance*(1-saturation)+imageData.data[index]*saturation,imageData.data[index+1]=luminance*(1-saturation)+imageData.data[index+1]*saturation,imageData.data[index+2]=luminance*(1-saturation)+imageData.data[index+2]*saturation}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),Saturation}(Primitive);module.exports=Saturation},{"./primitive":89,lodash:"lodash"}],91:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Color=_interopRequire(require("../../../lib/color")),SoftColorOverlay=function(Primitive){function SoftColorOverlay(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,SoftColorOverlay),_get(Object.getPrototypeOf(SoftColorOverlay.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{color:new Color(1,1,1)}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform vec3 u_overlay;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        vec4 overlayVec4 = vec4(u_overlay, texColor.a);\n        gl_FragColor = max(overlayVec4, texColor);\n      }\n    "}return _inherits(SoftColorOverlay,Primitive),_prototypeProperties(SoftColorOverlay,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_overlay:{type:"3f",value:this._options.color.toRGBGLColor()}}})},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=Math.max(this._options.color.r,imageData.data[index]),imageData.data[index+1]=Math.max(this._options.color.g,imageData.data[index+1]),imageData.data[index+2]=Math.max(this._options.color.b,imageData.data[index+2])}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),SoftColorOverlay}(Primitive);module.exports=SoftColorOverlay},{"../../../lib/color":44,"./primitive":89,lodash:"lodash"}],92:[function(require,module){"use strict";
var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),LookupTable=_interopRequire(require("./lookup-table")),ToneCurve=function(LookupTable){function ToneCurve(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,ToneCurve),_get(Object.getPrototypeOf(ToneCurve.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{rgbControlPoints:{red:this._options.controlPoints,green:this._options.controlPoints,blue:this._options.controlPoints}}),"undefined"!=typeof this._options.rgbControlPoints&&this._updateLookupTable()}return _inherits(ToneCurve,LookupTable),_prototypeProperties(ToneCurve,null,{_updateLookupTable:{value:function(){var r=this._calculateSplineCurve(this._options.rgbControlPoints.red),g=this._calculateSplineCurve(this._options.rgbControlPoints.green),b=this._calculateSplineCurve(this._options.rgbControlPoints.blue);this._options.data=this._buildLookupTable(r,g,b)},writable:!0,configurable:!0},_buildLookupTable:{value:function(r,g,b){for(var data=[],i=0;256>i;i++)data.push(Math.min(Math.max(i+r[i],0),255)),data.push(Math.min(Math.max(i+g[i],0),255)),data.push(Math.min(Math.max(i+b[i],0),255)),data.push(255);return data},writable:!0,configurable:!0},_calculateSplineCurve:{value:function(points){points=points.sort(function(a,b){return a[0]>b[0]});var i,splinePoints=this._getSplineCurve(points),firstSplinePoint=splinePoints[0];if(firstSplinePoint[0]>0)for(i=0;i<firstSplinePoint[0];i++)splinePoints.unshift([0,0]);var preparedPoints=[];for(i=0;i<splinePoints.length;i++){var newPoint=splinePoints[i],origPoint=[newPoint[0],newPoint[0]],distance=Math.sqrt(Math.pow(origPoint[0]-newPoint[0],2)+Math.pow(origPoint[1]-newPoint[1],2));origPoint[1]>newPoint[1]&&(distance=-distance),preparedPoints.push(distance)}return preparedPoints},writable:!0,configurable:!0},_getSplineCurve:{value:function(points){var i,sdA=this._secondDerivative(points),n=sdA.length,sd=[];for(i=0;n>i;i++)sd[i]=sdA[i];var output=[];for(i=0;n-1>i;i++)for(var cur=points[i],next=points[i+1],x=cur[0];x<next[0];x++){var t=(x-cur[0])/(next[0]-cur[0]),a=1-t,b=t,h=next[0]-cur[0],y=a*cur[1]+b*next[1]+h*h/6*((a*a*a-a)*sd[i]+(b*b*b-b)*sd[i+1]);y>255?y=255:0>y&&(y=0),output.push([x,y])}return 255===output.length&&output.push(points[points.length-1]),output},writable:!0,configurable:!0},_secondDerivative:{value:function(points){var n=points.length;if(0>=n||1===n)return null;var i,k,matrix=[],result=[];for(matrix[0]=[0,1,0],i=1;n-1>i;i++){var P1=points[i-1],P2=points[i],P3=points[i+1];matrix[i]=matrix[i]||[],matrix[i][0]=(P2[0]-P1[0])/6,matrix[i][1]=(P3[0]-P1[0])/3,matrix[i][2]=(P3[0]-P2[0])/6,result[i]=(P3[1]-P2[1])/(P3[0]-P2[0])-(P2[1]-P1[1])/(P2[0]-P1[0])}for(result[0]=0,result[n-1]=0,matrix[n-1]=[0,1,0],i=1;n>i;i++)k=matrix[1][0]/matrix[i-1][1],matrix[i][1]-=k*matrix[i-1][2],matrix[i][0]=0,result[i]-=k*result[i-1];for(i=n-2;i>0;i--)k=matrix[i][2]/matrix[i+1][1],matrix[i][1]-=k*matrix[i+1][0],matrix[i][2]=0,result[i]-=k*result[i+1];var y2=[];for(i=0;n>i;i++)y2[i]=result[i]/matrix[i][1];return y2},writable:!0,configurable:!0}}),ToneCurve}(LookupTable);module.exports=ToneCurve},{"./lookup-table":88,lodash:"lodash"}],93:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),X400=function(Primitive){function X400(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,X400),_get(Object.getPrototypeOf(X400.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float gray = texColor.r * 0.3 + texColor.g * 0.3 + texColor.b * 0.3;\n        gray -= 0.2;\n        gray = clamp(gray, 0.0, 1.0);\n        gray += 0.15;\n        gray *= 1.4;\n        gl_FragColor = vec4(vec3(gray), 1.0);\n      }\n    "}return _inherits(X400,Primitive),_prototypeProperties(X400,null,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)},writable:!0,configurable:!0},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),gray=imageData.data[index]/255*.3+imageData.data[index+1]/255*.3+imageData.data[index+2]/255*.3;gray-=.2,gray=Math.max(0,Math.min(1,gray)),gray+=.15,gray*=1.4,gray*=255,imageData.data[index]=gray,imageData.data[index+1]=gray,imageData.data[index+2]=gray}renderer.getContext().putImageData(imageData,0,0)},writable:!0,configurable:!0}}),X400}(Primitive);module.exports=X400},{"./primitive":89}],94:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),QuoziFilter=function(Filter){function QuoziFilter(){_classCallCheck(this,QuoziFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(QuoziFilter,Filter),_prototypeProperties(QuoziFilter,{identifier:{get:function(){return"quozi"},configurable:!0}},{name:{get:function(){return"Quozi"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.65})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,50],[40,78],[118,170],[181,211],[255,255]],green:[[0,27],[28,45],[109,157],[157,195],[179,208],[206,212],[255,240]],blue:[[0,50],[12,55],[46,103],[103,162],[194,182],[241,201],[255,219]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),QuoziFilter}(Filter);module.exports=QuoziFilter},{"./filter":62}],95:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),SemiredFilter=function(Filter){function SemiredFilter(){_classCallCheck(this,SemiredFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(SemiredFilter,Filter),_prototypeProperties(SemiredFilter,{identifier:{get:function(){return"semired"},configurable:!0}},{name:{get:function(){return"Semi Red"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,129],[75,153],[181,227],[255,255]],green:[[0,8],[111,85],[212,158],[255,226]],blue:[[0,5],[75,22],[193,90],[255,229]]}})),stack.add(new Filter.Primitives.Glow),stack.render(renderer)},writable:!0,configurable:!0}}),SemiredFilter}(Filter);module.exports=SemiredFilter},{"./filter":62}],96:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),SunnyFilter=function(Filter){function SunnyFilter(){_classCallCheck(this,SunnyFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(SunnyFilter,Filter),_prototypeProperties(SunnyFilter,{identifier:{get:function(){return"sunny"},configurable:!0}},{name:{get:function(){return"Sunny"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[62,82],[141,154],[255,255]],green:[[0,39],[56,96],[192,176],[255,255]],blue:[[0,0],[174,99],[255,235]]}})),stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[55,20],[158,191],[255,255]]})),stack.render(renderer)},writable:!0,configurable:!0}}),SunnyFilter}(Filter);module.exports=SunnyFilter},{"./filter":62}],97:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),TexasFilter=function(Filter){function TexasFilter(){_classCallCheck(this,TexasFilter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(TexasFilter,Filter),_prototypeProperties(TexasFilter,{identifier:{get:function(){return"texas"},configurable:!0}},{name:{get:function(){return"Texas"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,72],[89,99],[176,212],[255,237]],green:[[0,49],[255,192]],blue:[[0,72],[255,151]]}})),stack.render(renderer)},writable:!0,configurable:!0}}),TexasFilter}(Filter);module.exports=TexasFilter},{"./filter":62}],98:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),X400Filter=function(Filter){function X400Filter(){_classCallCheck(this,X400Filter),null!=Filter&&Filter.apply(this,arguments)}return _inherits(X400Filter,Filter),_prototypeProperties(X400Filter,{identifier:{get:function(){return"x400"},configurable:!0}},{name:{get:function(){return"X400"},configurable:!0},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.X400),stack.render(renderer)},writable:!0,configurable:!0}}),X400Filter}(Filter);module.exports=X400Filter},{"./filter":62}],99:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),FlipOperation=function(Operation){function FlipOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FlipOperation),this.availableOptions={horizontal:{type:"boolean","default":!1},vertical:{type:"boolean","default":!1}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n      uniform bool u_flipVertical;\n      uniform bool u_flipHorizontal;\n\n      void main() {\n        vec2 texCoord = vec2(v_texCoord);\n        if (u_flipVertical) {\n          texCoord.y = 1.0 - texCoord.y;\n        }\n        if (u_flipHorizontal) {\n          texCoord.x = 1.0 - texCoord.x;\n        }\n        gl_FragColor = texture2D(u_image, texCoord);\n      }\n    ",_get(Object.getPrototypeOf(FlipOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FlipOperation,Operation),_prototypeProperties(FlipOperation,null,{identifier:{get:function(){return"flip"},configurable:!0},_renderWebGL:{value:function(renderer){renderer.runShader(null,this.fragmentShader,{uniforms:{u_flipVertical:{type:"f",value:this._options.vertical},u_flipHorizontal:{type:"f",value:this._options.horizontal}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),context=renderer.getContext(),scaleX=1,scaleY=1,translateX=0,translateY=0;this._options.horizontal&&(scaleX=-1,translateX=canvas.width),this._options.vertical&&(scaleY=-1,translateY=canvas.height),context.save(),context.translate(translateX,translateY),context.scale(scaleX,scaleY);var tempCanvas=renderer.cloneCanvas();context.drawImage(tempCanvas,0,0),context.restore()},writable:!0,configurable:!0}}),FlipOperation}(Operation);module.exports=FlipOperation},{"./operation":101}],100:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Color=_interopRequire(require("../lib/color")),FramesOperation=function(Operation){function FramesOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FramesOperation),this.availableOptions={color:{type:"color","default":new Color(0,0,0,1)},thickness:{type:"number","default":.02}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_frameImage;\n      uniform vec4 u_color;\n      uniform vec2 u_thickness;\n\n      void main() {\n        vec4 fragColor = texture2D(u_image, v_texCoord);\n        if (v_texCoord.x < u_thickness.x || v_texCoord.x > 1.0 - u_thickness.x ||\n          v_texCoord.y < u_thickness.y || v_texCoord.y > 1.0 - u_thickness.y) {\n            fragColor = mix(fragColor, u_color, u_color.a);\n          }\n\n        gl_FragColor = fragColor;\n      }\n    ",_get(Object.getPrototypeOf(FramesOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FramesOperation,Operation),_prototypeProperties(FramesOperation,null,{identifier:{get:function(){return"frames"},configurable:!0},_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),color=this._options.color,thickness=this._options.thickness*canvas.height,thicknessVec2=[thickness/canvas.width,thickness/canvas.height];renderer.runShader(null,this._fragmentShader,{uniforms:{u_color:{type:"4f",value:color.toGLColor()},u_thickness:{type:"2f",value:thicknessVec2}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),context=renderer.getContext(),color=this._options.color,thickness=this._options.thickness*canvas.height;context.save(),context.beginPath(),context.lineWidth=2*thickness,context.strokeStyle=color.toRGBA(),context.rect(0,0,canvas.width,canvas.height),context.stroke(),context.restore()},writable:!0,configurable:!0}}),FramesOperation}(Operation);module.exports=FramesOperation},{"../lib/color":44,"./operation":101}],101:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Vector2=_interopRequire(require("../lib/math/vector2")),Color=_interopRequire(require("../lib/color")),EventEmitter=_interopRequire(require("../lib/event-emitter")),Operation=function(EventEmitter){function Operation(kit,options){if(_classCallCheck(this,Operation),_get(Object.getPrototypeOf(Operation.prototype),"constructor",this).call(this),"ImglyKit"!==kit.constructor.name)throw new Error("Operation: First parameter for constructor has to be an ImglyKit instance.");this._kit=kit,this.availableOptions=_.extend(this.availableOptions||{},{numberFormat:{type:"string","default":"relative",available:["absolute","relative"]}}),this._dirty=!0,this._uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)}),this._initOptions(options||{})}return _inherits(Operation,EventEmitter),_prototypeProperties(Operation,null,{identifier:{get:function(){return null},configurable:!0},validateSettings:{value:function(){var identifier=this.identifier;for(var optionName in this.availableOptions){var optionConfig=this.availableOptions[optionName];if(optionConfig.required&&"undefined"==typeof this._options[optionName])throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` is required.")}},writable:!0,configurable:!0},render:{value:function(renderer){var renderFn=void 0;renderFn="webgl"===renderer.identifier?this._renderWebGL.bind(this):this._renderCanvas.bind(this),this._dirty?(renderFn(renderer),renderer.cache(this._uuid),this._dirty=!1):renderer.drawCached(this._uuid)},writable:!0,configurable:!0},_renderWebGL:{value:function(){throw new Error("Operation#_renderWebGL is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},_renderCanvas:{value:function(){throw new Error("Operation#_renderCanvas is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},_initOptions:{value:function(userOptions){this._options={};var optionName,option,capitalized,self=this;for(optionName in this.availableOptions)capitalized=optionName.charAt(0).toUpperCase()+optionName.slice(1),option=this.availableOptions[optionName],function(optionName,option){self["set"+capitalized]=function(value){"undefined"!=typeof option.setter&&(value=option.setter.call(this,value)),self._setOption(optionName,value)},self["get"+capitalized]=function(){return self._getOption(optionName)}}(optionName,option),"undefined"!=typeof option["default"]&&this["set"+capitalized](option["default"]);for(optionName in userOptions){if("undefined"==typeof this.availableOptions[optionName])throw new Error("Invalid option: "+optionName);capitalized=optionName.charAt(0).toUpperCase()+optionName.slice(1),this["set"+capitalized](userOptions[optionName])}},writable:!0,configurable:!0},set:{value:function(options){for(var optionName in options)this._setOption(optionName,options[optionName],!1);this.emit("update")},writable:!0,configurable:!0},_getOption:{value:function(optionName){return this._options[optionName]},writable:!0,configurable:!0},_setOption:{value:function(optionName,value){var update=void 0===arguments[2]?!0:arguments[2],optionConfig=this.availableOptions[optionName],identifier=this.identifier;switch("undefined"!=typeof optionConfig.validation&&optionConfig.validation(value),optionConfig.type){case"string":if("string"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a string.");var available=optionConfig.available;if("undefined"!=typeof available&&-1===available.indexOf(value))throw new Error("Operation `"+identifier+"`: Invalid value for `"+optionName+"` (valid values are: "+optionConfig.available.join(", ")+")");this._options[optionName]=value;break;case"number":if("number"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a number.");this._options[optionName]=value;break;case"boolean":if("boolean"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a boolean.");this._options[optionName]=value;break;case"vector2":if(!(value instanceof Vector2))throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be an instance of ImglyKit.Vector2.");this._options[optionName]=value.clone();break;case"color":if(!(value instanceof Color))throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be an instance of ImglyKit.Color.");this._options[optionName]=value;break;case"object":this._options[optionName]=value}this._dirty=!0,update&&this.emit("update")},writable:!0,configurable:!0},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();return dimensions=dimensions||new Vector2(canvas.width,canvas.height)},writable:!0,configurable:!0},dirty:{set:function(dirty){this._dirty=dirty},get:function(){return this._dirty},configurable:!0}}),Operation}(EventEmitter),extend=_interopRequire(require("../lib/extend"));Operation.extend=extend,module.exports=Operation},{"../lib/color":44,"../lib/event-emitter":45,"../lib/extend":46,"../lib/math/vector2":49,lodash:"lodash"}],102:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);if(null!==parent)return set(parent,property,value,receiver)}else{if("value"in desc&&desc.writable)return desc.value=value;var setter=desc.set;if(void 0!==setter)return setter.call(receiver,value)}},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),StackBlur=_interopRequire(require("../vendor/stack-blur")),RadialBlurOperation=function(Operation){function RadialBlurOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,RadialBlurOperation),this.availableOptions={position:{type:"vector2","default":new Vector2(.5,.5)},gradientRadius:{type:"number","default":50},blurRadius:{type:"number","default":20}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      uniform float blurRadius;\n      uniform float gradientRadius;\n      uniform vec2 position;\n      uniform vec2 delta;\n      uniform vec2 texSize;\n      varying vec2 v_texCoord;\n\n      float random(vec3 scale, float seed) {\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n      }\n\n      void main() {\n          vec4 color = vec4(0.0);\n          float total = 0.0;\n\n          float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n          float radius = smoothstep(0.0, 1.0, abs(distance(v_texCoord * texSize, position)) / (gradientRadius * 2.0)) * blurRadius;\n          for (float t = -30.0; t <= 30.0; t++) {\n              float percent = (t + offset - 0.5) / 30.0;\n              float weight = 1.0 - abs(percent);\n              vec4 sample = texture2D(u_image, v_texCoord + delta * percent * radius / texSize);\n\n              sample.rgb *= sample.a;\n\n              color += sample * weight;\n              total += weight;\n          }\n\n          gl_FragColor = color / total;\n          gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n      }\n    ",_get(Object.getPrototypeOf(RadialBlurOperation.prototype),"constructor",this).apply(this,args),this._cachedBlurredCanvas=null,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius}return _inherits(RadialBlurOperation,Operation),_prototypeProperties(RadialBlurOperation,null,{identifier:{get:function(){return"radial-blur"},configurable:!0},_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),position=this._options.position.clone();position.y=1-position.y,"relative"===this._options.numberFormat&&position.multiply(canvasSize);var uniforms={blurRadius:{type:"f",value:this._options.blurRadius},gradientRadius:{type:"f",value:this._options.gradientRadius},position:{type:"2f",value:[position.x,position.y]},texSize:{type:"2f",value:[canvas.width,canvas.height]},delta:{type:"2f",value:[1,1]}};renderer.runShader(null,this.fragmentShader,{uniforms:uniforms}),uniforms.delta.value=[-1,1],renderer.runShader(null,this.fragmentShader,{uniforms:uniforms})
},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),blurRadiusChanged=this._options.blurRadius!==this._lastBlurRadius,blurryCanvas=void 0;blurRadiusChanged||null===this._cachedBlurredCanvas?(blurryCanvas=this._blurCanvas(renderer),this._cachedBlurredCanvas=blurryCanvas,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius):blurryCanvas=this._cachedBlurredCanvas;var maskCanvas=this._createMask(renderer);this._applyMask(canvas,blurryCanvas,maskCanvas)},writable:!0,configurable:!0},_blurCanvas:{value:function(renderer){var newCanvas=renderer.cloneCanvas(),blurryContext=newCanvas.getContext("2d"),blurryImageData=blurryContext.getImageData(0,0,newCanvas.width,newCanvas.height);return StackBlur.stackBlurCanvasRGBA(blurryImageData,0,0,newCanvas.width,newCanvas.height,this._options.blurRadius),blurryContext.putImageData(blurryImageData,0,0),newCanvas},writable:!0,configurable:!0},_createMask:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),gradientRadius=this._options.gradientRadius,maskCanvas=renderer.createCanvas(canvas.width,canvas.height),maskContext=maskCanvas.getContext("2d"),position=this._options.position.clone();"relative"===this._options.numberFormat&&position.multiply(canvasSize);var gradient=maskContext.createRadialGradient(position.x,position.y,0,position.x,position.y,gradientRadius);return gradient.addColorStop(0,"#FFFFFF"),gradient.addColorStop(1,"#000000"),maskContext.fillStyle=gradient,maskContext.fillRect(0,0,canvas.width,canvas.height),maskCanvas},writable:!0,configurable:!0},_applyMask:{value:function(inputCanvas,blurryCanvas,maskCanvas){for(var index,alpha,inputContext=inputCanvas.getContext("2d"),blurryContext=blurryCanvas.getContext("2d"),maskContext=maskCanvas.getContext("2d"),inputImageData=inputContext.getImageData(0,0,inputCanvas.width,inputCanvas.height),pixels=inputImageData.data,blurryPixels=blurryContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,maskPixels=maskContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,y=0;y<inputCanvas.height;y++)for(var x=0;x<inputCanvas.width;x++)index=4*(y*inputCanvas.width+x),alpha=maskPixels[index]/255,pixels[index]=alpha*pixels[index]+(1-alpha)*blurryPixels[index],pixels[index+1]=alpha*pixels[index+1]+(1-alpha)*blurryPixels[index+1],pixels[index+2]=alpha*pixels[index+2]+(1-alpha)*blurryPixels[index+2];inputContext.putImageData(inputImageData,0,0)},writable:!0,configurable:!0},dirty:{set:function(dirty){_set(Object.getPrototypeOf(RadialBlurOperation.prototype),"dirty",dirty,this),this._cachedBlurredCanvas=null},get:function(){return _get(Object.getPrototypeOf(RadialBlurOperation.prototype),"dirty",this)},configurable:!0}}),RadialBlurOperation}(Operation);module.exports=RadialBlurOperation},{"../lib/math/vector2":49,"../vendor/stack-blur":132,"./operation":101}],103:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),RotationOperation=function(Operation){function RotationOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,RotationOperation),this.availableOptions={degrees:{type:"number","default":0,validation:function(value){if(value%90!==0)throw new Error("RotationOperation: `rotation` has to be a multiple of 90.")}}},this.vertexShader="\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n      uniform mat3 u_matrix;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    ",_get(Object.getPrototypeOf(RotationOperation.prototype),"constructor",this).apply(this,args)}return _inherits(RotationOperation,Operation),_prototypeProperties(RotationOperation,null,{identifier:{get:function(){return"rotation"},configurable:!0},_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),actualDegrees=this._options.degrees%360;if(actualDegrees%180!==0){var newDimensions=this.getNewDimensions(renderer);canvas.width=newDimensions.x,canvas.height=newDimensions.y}var radians=actualDegrees*(Math.PI/180),c=Math.cos(radians),s=Math.sin(radians),rotationMatrix=[c,-s,0,s,c,0,0,0,1];renderer.runShader(this.vertexShader,null,{uniforms:{u_matrix:{type:"mat3fv",value:rotationMatrix}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),actualDegrees=this._options.degrees%360,newDimensions=this.getNewDimensions(renderer),newCanvas=renderer.createCanvas();newCanvas.width=newDimensions.x,newCanvas.height=newDimensions.y;var newContext=newCanvas.getContext("2d");newContext.save(),newContext.translate(newCanvas.width/2,newCanvas.height/2),newContext.rotate(actualDegrees*(Math.PI/180));var tempCanvas=renderer.cloneCanvas();newContext.drawImage(tempCanvas,-canvas.width/2,-canvas.height/2),newContext.restore(),renderer.setCanvas(newCanvas)},writable:!0,configurable:!0},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();dimensions=dimensions||new Vector2(canvas.width,canvas.height);var actualDegrees=this._options.degrees%360;if(actualDegrees%180!==0){var tempX=dimensions.x;dimensions.x=dimensions.y,dimensions.y=tempX}return dimensions},writable:!0,configurable:!0}}),RotationOperation}(Operation);module.exports=RotationOperation},{"../lib/math/vector2":49,"./operation":101}],104:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),SaturationPrimitive=_interopRequire(require("./filters/primitives/saturation")),SaturationOperation=function(Operation){function SaturationOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,SaturationOperation),this.availableOptions={saturation:{type:"number","default":1}},_get(Object.getPrototypeOf(SaturationOperation.prototype),"constructor",this).apply(this,args)}return _inherits(SaturationOperation,Operation),_prototypeProperties(SaturationOperation,null,{identifier:{get:function(){return"saturation"},configurable:!0},_renderWebGL:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){this._render(renderer)},writable:!0,configurable:!0},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new SaturationPrimitive({saturation:this._options.saturation})),stack.render(renderer)},writable:!0,configurable:!0}}),SaturationOperation}(Operation);module.exports=SaturationOperation},{"./filters/primitives-stack":81,"./filters/primitives/saturation":90,"./operation":101}],105:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),bluebird=(_interopRequire(require("../lib/utils")),_interopRequire(require("bluebird"))),StickersOperation=function(Operation){function StickersOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,StickersOperation),this.availableOptions={sticker:{type:"string"},position:{type:"vector2","default":new Vector2(0,0)},size:{type:"vector2","default":new Vector2(0,0)}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_stickerImage;\n      uniform vec2 u_position;\n      uniform vec2 u_size;\n\n      void main() {\n        vec4 color0 = texture2D(u_image, v_texCoord);\n        vec2 relative = (v_texCoord - u_position) / u_size;\n\n        if (relative.x >= 0.0 && relative.x <= 1.0 &&\n          relative.y >= 0.0 && relative.y <= 1.0) {\n\n            vec4 color1 = texture2D(u_stickerImage, relative);\n            gl_FragColor = vec4(mix(color0.rgb, color1.rgb, color1.a), 1.0);\n\n        } else {\n\n          gl_FragColor = color0;\n\n        }\n      }\n    ",this._loadedStickers={},_get(Object.getPrototypeOf(StickersOperation.prototype),"constructor",this).apply(this,args)}return _inherits(StickersOperation,Operation),_prototypeProperties(StickersOperation,null,{identifier:{get:function(){return"stickers"},configurable:!0},render:{value:function(renderer){var self=this;return this._loadSticker().then(function(image){return"webgl"===renderer.identifier?self._renderWebGL(renderer,image):self._renderCanvas(renderer,image)})},writable:!0,configurable:!0},_renderWebGL:{value:function(renderer,image){var canvas=renderer.getCanvas(),gl=renderer.getContext(),position=this._options.position.clone(),canvasSize=new Vector2(canvas.width,canvas.height);"absolute"===this._options.numberFormat&&position.divide(canvasSize);var size=new Vector2(image.width,image.height);if("undefined"!=typeof this._options.size){size.copy(this._options.size),"relative"===this._options.numberFormat&&size.multiply(canvasSize);var ratio=image.height/image.width;size.y=size.x*ratio}size.divide(canvasSize),position.y=1-position.y,position.y-=size.y,gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),gl.activeTexture(gl.TEXTURE0),renderer.runShader(null,this._fragmentShader,{uniforms:{u_stickerImage:{type:"i",value:this._textureIndex},u_position:{type:"2f",value:[position.x,position.y]},u_size:{type:"2f",value:[size.x,size.y]}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer,image){var canvas=renderer.getCanvas(),context=renderer.getContext(),canvasSize=new Vector2(canvas.width,canvas.height),scaledPosition=this._options.position.clone();"relative"===this._options.numberFormat&&scaledPosition.multiply(canvasSize);var size=new Vector2(image.width,image.height);"undefined"!=typeof this._options.size&&(size.copy(this._options.size),"relative"===this._options.numberFormat&&size.multiply(canvasSize)),context.drawImage(image,0,0,image.width,image.height,scaledPosition.x,scaledPosition.y,size.x,size.y)},writable:!0,configurable:!0},_loadSticker:{value:function(){var isBrowser="undefined"!=typeof window;return isBrowser?this._loadImageBrowser(this._options.sticker):this._loadImageNode(this._options.sticker)},writable:!0,configurable:!0},_loadImageBrowser:{value:function(fileName){var self=this;return new Promise(function(resolve,reject){if(self._loadedStickers[fileName])return resolve(self._loadedStickers[fileName]);var image=new Image;image.addEventListener("load",function(){self._loadedStickers[fileName]=image,resolve(image)}),image.addEventListener("error",function(){reject(new Error("Could not load sticker: "+fileName))}),image.src=self._kit.getAssetPath(fileName)})},writable:!0,configurable:!0},_loadImageNode:{value:function(fileName){var Canvas=require("canvas"),self=this,image=new Canvas.Image,path=self._kit.getAssetPath(fileName);return bluebird.promisify(fs.readFile)(path).then(function(buffer){return image.src=buffer,image})},writable:!0,configurable:!0},stickers:{get:function(){return this._stickers},configurable:!0}}),StickersOperation}(Operation);module.exports=StickersOperation},{"../lib/math/vector2":49,"../lib/utils":51,"./operation":101,bluebird:4,canvas:"canvas"}],106:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),Color=_interopRequire(require("../lib/color")),TextOperation=function(Operation){function TextOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,TextOperation),this.availableOptions={fontSize:{type:"number","default":.1},lineHeight:{type:"number","default":1.1},fontFamily:{type:"string","default":"Times New Roman"},fontWeight:{type:"string","default":"normal"},alignment:{type:"string","default":"left",available:["left","center","right"]},verticalAlignment:{type:"string","default":"top",available:["top","center","bottom"]},color:{type:"color","default":new Color(1,1,1,1)},backgroundColor:{type:"color","default":new Color(0,0,0,0)},position:{type:"vector2","default":new Vector2(0,0)},text:{type:"string",required:!0},maxWidth:{type:"number","default":1}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textImage;\n      uniform vec2 u_position;\n      uniform vec2 u_size;\n\n      void main() {\n        vec4 color0 = texture2D(u_image, v_texCoord);\n        vec2 relative = (v_texCoord - u_position) / u_size;\n\n        if (relative.x >= 0.0 && relative.x <= 1.0 &&\n          relative.y >= 0.0 && relative.y <= 1.0) {\n\n            vec4 color1 = texture2D(u_textImage, relative);\n            gl_FragColor = vec4(mix(color0.rgb, color1.rgb, color1.a), 1.0);\n\n        } else {\n\n          gl_FragColor = color0;\n\n        }\n      }\n    ",_get(Object.getPrototypeOf(TextOperation.prototype),"constructor",this).apply(this,args)}return _inherits(TextOperation,Operation),_prototypeProperties(TextOperation,null,{identifier:{get:function(){return"text"},configurable:!0},_renderWebGL:{value:function(renderer){var textCanvas=this._renderTextCanvas(renderer),canvas=renderer.getCanvas(),gl=renderer.getContext(),position=this._options.position.clone(),canvasSize=new Vector2(canvas.width,canvas.height),size=new Vector2(textCanvas.width,textCanvas.height).divide(canvasSize);"absolute"===this._options.numberFormat&&position.divide(canvasSize),position.y=1-position.y,position.y-=size.y,"center"===this._options.verticalAlignment?position.y+=size.y/2:"bottom"===this._options.verticalAlignment&&(position.y+=size.y),"center"===this._options.alignment?position.x-=size.x/2:"right"===this._options.alignment&&(position.x-=size.x),gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textCanvas),gl.activeTexture(gl.TEXTURE0),renderer.runShader(null,this._fragmentShader,{uniforms:{u_textImage:{type:"i",value:this._textureIndex},u_position:{type:"2f",value:[position.x,position.y]},u_size:{type:"2f",value:[size.x,size.y]}}})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var textCanvas=this._renderTextCanvas(renderer),canvas=renderer.getCanvas(),context=renderer.getContext(),canvasSize=new Vector2(canvas.width,canvas.height),scaledPosition=this._options.position.clone();"relative"===this._options.numberFormat&&scaledPosition.multiply(canvasSize),"center"===this._options.verticalAlignment?scaledPosition.y-=textCanvas.height/2:"bottom"===this._options.verticalAlignment&&(scaledPosition.y-=textCanvas.height),"center"===this._options.alignment?scaledPosition.x-=textCanvas.width/2:"right"===this._options.alignment&&(scaledPosition.x-=textCanvas.width),context.drawImage(textCanvas,scaledPosition.x,scaledPosition.y)},writable:!0,configurable:!0},_renderTextCanvas:{value:function(renderer){var line=void 0,lineNum=void 0,canvas=renderer.createCanvas(),context=canvas.getContext("2d"),outputCanvas=renderer.getCanvas(),canvasSize=new Vector2(outputCanvas.width,outputCanvas.height),maxWidth=this._options.maxWidth,actualFontSize=this._options.fontSize*canvasSize.y,actualLineHeight=this._options.lineHeight*actualFontSize;"relative"===this._options.numberFormat&&(maxWidth*=renderer.getCanvas().width),this._applyTextOptions(renderer,context);var boundingBox=new Vector2,lines=this._options.text.split("\n");if("undefined"!=typeof maxWidth)boundingBox.x=maxWidth,lines=this._buildOutputLines(context,maxWidth);else for(lineNum=0;lineNum<lines.length;lineNum++)line=lines[lineNum],boundingBox.x=Math.max(boundingBox.x,context.measureText(line).width);for(boundingBox.y=actualLineHeight*lines.length,canvas.width=boundingBox.x,canvas.height=boundingBox.y,context=canvas.getContext("2d"),context.fillStyle=this._options.backgroundColor.toRGBA(),context.fillRect(0,0,canvas.width,canvas.height),this._applyTextOptions(renderer,context),lineNum=0;lineNum<lines.length;lineNum++)line=lines[lineNum],this._drawText(context,line,actualLineHeight*lineNum);return canvas},writable:!0,configurable:!0},_applyTextOptions:{value:function(renderer,context){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),actualFontSize=this._options.fontSize*canvasSize.y;context.font=this._options.fontWeight+" "+actualFontSize+"px "+this._options.fontFamily,context.textBaseline="top",context.textAlign=this._options.alignment,context.fillStyle=this._options.color.toRGBA()},writable:!0,configurable:!0},_buildOutputLines:{value:function(context,maxWidth){for(var inputLines=this._options.text.split("\n"),outputLines=[],currentChars=[],lineNum=0;lineNum<inputLines.length;lineNum++){var inputLine=inputLines[lineNum],lineChars=inputLine.split("");0===lineChars.length&&outputLines.push("");for(var charNum=0;charNum<lineChars.length;charNum++){var currentChar=lineChars[charNum];currentChars.push(currentChar);var currentLine=currentChars.join(""),lineWidth=context.measureText(currentLine).width;if(lineWidth>maxWidth&&1===currentChars.length)outputLines.push(currentChars[0]),currentChars=[];else if(lineWidth>maxWidth){var lastWord=currentChars.pop();outputLines.push(currentChars.join("")),currentChars=[],currentChars=[lastWord]}else charNum===lineChars.length-1&&(outputLines.push(currentChars.join("")),currentChars=[])}currentChars.length&&(outputLines.push(currentChars.join("")),currentChars=[])}return outputLines},writable:!0,configurable:!0},_drawText:{value:function(context,text,y){var canvas=context.canvas;"center"===this._options.alignment?context.fillText(text,canvas.width/2,y):"left"===this._options.alignment?context.fillText(text,0,y):"right"===this._options.alignment&&context.fillText(text,canvas.width,y)},writable:!0,configurable:!0}}),TextOperation}(Operation);module.exports=TextOperation},{"../lib/color":44,"../lib/math/vector2":49,"./operation":101}],107:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);if(null!==parent)return set(parent,property,value,receiver)}else{if("value"in desc&&desc.writable)return desc.value=value;var setter=desc.set;if(void 0!==setter)return setter.call(receiver,value)}},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),StackBlur=_interopRequire(require("../vendor/stack-blur")),TiltShiftOperation=function(Operation){function TiltShiftOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,TiltShiftOperation),this.availableOptions={start:{type:"vector2","default":new Vector2(0,.5)},end:{type:"vector2","default":new Vector2(1,.5)},blurRadius:{type:"number","default":30},gradientRadius:{type:"number","default":50}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      uniform float blurRadius;\n      uniform float gradientRadius;\n      uniform vec2 start;\n      uniform vec2 end;\n      uniform vec2 delta;\n      uniform vec2 texSize;\n      varying vec2 v_texCoord;\n\n      float random(vec3 scale, float seed) {\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n      }\n\n      void main() {\n          vec4 color = vec4(0.0);\n          float total = 0.0;\n\n          float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n          vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n          float radius = smoothstep(0.0, 1.0, abs(dot(v_texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\n          for (float t = -30.0; t <= 30.0; t++) {\n              float percent = (t + offset - 0.5) / 30.0;\n              float weight = 1.0 - abs(percent);\n              vec4 sample = texture2D(u_image, v_texCoord + delta * percent * radius / texSize);\n\n              sample.rgb *= sample.a;\n\n              color += sample * weight;\n              total += weight;\n          }\n\n          gl_FragColor = color / total;\n          gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n      }\n    ",_get(Object.getPrototypeOf(TiltShiftOperation.prototype),"constructor",this).apply(this,args),this._cachedBlurredCanvas=null,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius}return _inherits(TiltShiftOperation,Operation),_prototypeProperties(TiltShiftOperation,null,{identifier:{get:function(){return"tilt-shift"},configurable:!0},_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),start=this._options.start.clone(),end=this._options.end.clone();"relative"===this._options.numberFormat&&(start.multiply(canvasSize),end.multiply(canvasSize)),start.y=canvasSize.y-start.y,end.y=canvasSize.y-end.y;var delta=end.clone().subtract(start),d=Math.sqrt(delta.x*delta.x+delta.y*delta.y),uniforms={blurRadius:{type:"f",value:this._options.blurRadius},gradientRadius:{type:"f",value:this._options.gradientRadius},start:{type:"2f",value:[start.x,start.y]},end:{type:"2f",value:[end.x,end.y]},delta:{type:"2f",value:[delta.x/d,delta.y/d]},texSize:{type:"2f",value:[canvas.width,canvas.height]}};renderer.runShader(null,this.fragmentShader,{uniforms:uniforms}),uniforms.delta.value=[-delta.y/d,delta.x/d],renderer.runShader(null,this.fragmentShader,{uniforms:uniforms})},writable:!0,configurable:!0},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),optionsChanged=this._options.blurRadius!==this._lastBlurRadius||this._options.gradientRadius!==this._lastGradientRadius,blurryCanvas=void 0;optionsChanged||null===this._cachedBlurredCanvas?(blurryCanvas=this._blurCanvas(renderer),this._cachedBlurredCanvas=blurryCanvas,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius):blurryCanvas=this._cachedBlurredCanvas;var maskCanvas=this._createMask(renderer);this._applyMask(canvas,blurryCanvas,maskCanvas)},writable:!0,configurable:!0},_blurCanvas:{value:function(renderer){var newCanvas=renderer.cloneCanvas(),blurryContext=newCanvas.getContext("2d"),blurryImageData=blurryContext.getImageData(0,0,newCanvas.width,newCanvas.height);return StackBlur.stackBlurCanvasRGBA(blurryImageData,0,0,newCanvas.width,newCanvas.height,this._options.blurRadius),blurryContext.putImageData(blurryImageData,0,0),newCanvas},writable:!0,configurable:!0},_createMask:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),gradientRadius=this._options.gradientRadius,maskCanvas=renderer.createCanvas(canvas.width,canvas.height),maskContext=maskCanvas.getContext("2d"),start=this._options.start.clone(),end=this._options.end.clone();"relative"===this._options.numberFormat&&(start.multiply(canvasSize),end.multiply(canvasSize));var dist=end.clone().subtract(start),middle=start.clone().add(dist.clone().divide(2)),totalDist=Math.sqrt(Math.pow(dist.x,2)+Math.pow(dist.y,2)),factor=dist.clone().divide(totalDist),gradientStart=middle.clone().add(gradientRadius*factor.y,-gradientRadius*factor.x),gradientEnd=middle.clone().add(-gradientRadius*factor.y,gradientRadius*factor.x),gradient=maskContext.createLinearGradient(gradientStart.x,gradientStart.y,gradientEnd.x,gradientEnd.y);return gradient.addColorStop(0,"#000000"),gradient.addColorStop(.5,"#FFFFFF"),gradient.addColorStop(1,"#000000"),maskContext.fillStyle=gradient,maskContext.fillRect(0,0,canvas.width,canvas.height),maskCanvas},writable:!0,configurable:!0},_applyMask:{value:function(inputCanvas,blurryCanvas,maskCanvas){for(var inputContext=inputCanvas.getContext("2d"),blurryContext=blurryCanvas.getContext("2d"),maskContext=maskCanvas.getContext("2d"),inputImageData=inputContext.getImageData(0,0,inputCanvas.width,inputCanvas.height),pixels=inputImageData.data,blurryPixels=blurryContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,maskPixels=maskContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,i=0;i<maskPixels.length;i++){var alpha=maskPixels[i]/255;pixels[i]=alpha*pixels[i]+(1-alpha)*blurryPixels[i]}inputContext.putImageData(inputImageData,0,0)},writable:!0,configurable:!0},dirty:{set:function(dirty){_set(Object.getPrototypeOf(TiltShiftOperation.prototype),"dirty",dirty,this),this._cachedBlurredCanvas=null},get:function(){return _get(Object.getPrototypeOf(TiltShiftOperation.prototype),"dirty",this)},configurable:!0}}),TiltShiftOperation}(Operation);module.exports=TiltShiftOperation},{"../lib/math/vector2":49,"../vendor/stack-blur":132,"./operation":101}],108:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")
},Renderer=_interopRequire(require("./renderer")),Vector2=_interopRequire(require("../lib/math/vector2")),CanvasRenderer=function(Renderer){function CanvasRenderer(){_classCallCheck(this,CanvasRenderer),null!=Renderer&&Renderer.apply(this,arguments)}return _inherits(CanvasRenderer,Renderer),_prototypeProperties(CanvasRenderer,{identifier:{get:function(){return"canvas"},configurable:!0},isSupported:{value:function(){var elem=this.prototype.createCanvas();return!(!elem.getContext||!elem.getContext("2d"))},writable:!0,configurable:!0}},{cache:{value:function(identifier){this._cache[identifier]={data:this._context.getImageData(0,0,this._canvas.width,this._canvas.height),size:new Vector2(this._canvas.width,this._canvas.height)}},writable:!0,configurable:!0},drawCached:{value:function(identifier){var _cache$identifier=this._cache[identifier],data=_cache$identifier.data,size=_cache$identifier.size;this._canvas.width=size.x,this._canvas.height=size.y,this._context.putImageData(data,0,0)},writable:!0,configurable:!0},_getContext:{value:function(){return this._canvas.getContext("2d")},writable:!0,configurable:!0},drawImage:{value:function(image){this._context.drawImage(image,0,0,image.width,image.height,0,0,this._canvas.width,this._canvas.height)},writable:!0,configurable:!0},resizeTo:{value:function(dimensions){var newCanvas=this.createCanvas();newCanvas.width=dimensions.x,newCanvas.height=dimensions.y;var newContext=newCanvas.getContext("2d");newContext.drawImage(this._canvas,0,0,this._canvas.width,this._canvas.height,0,0,newCanvas.width,newCanvas.height),this.setCanvas(newCanvas)},writable:!0,configurable:!0},cloneCanvas:{value:function(){var canvas=this.createCanvas(),context=canvas.getContext("2d");return canvas.width=this._canvas.width,canvas.height=this._canvas.height,context.drawImage(this._canvas,0,0),canvas},writable:!0,configurable:!0}}),CanvasRenderer}(Renderer);module.exports=CanvasRenderer},{"../lib/math/vector2":49,"./renderer":109}],109:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=_interopRequire(require("../lib/math/vector2")),EventEmitter=_interopRequire(require("../lib/event-emitter")),Renderer=function(EventEmitter){function Renderer(dimensions,canvas){_classCallCheck(this,Renderer),_get(Object.getPrototypeOf(Renderer.prototype),"constructor",this).call(this),this._canvas=canvas||this.createCanvas(),canvas||this.setSize(dimensions),this._context=this._getContext(),this._cache={}}return _inherits(Renderer,EventEmitter),_prototypeProperties(Renderer,{isSupported:{value:function(){throw new Error("Renderer#isSupported is abstract and not implemented in inherited class.")},writable:!0,configurable:!0}},{identifier:{get:function(){return null},configurable:!0},cache:{value:function(){},writable:!0,configurable:!0},drawCached:{value:function(){},writable:!0,configurable:!0},createCanvas:{value:function(width,height){var canvas,isBrowser="undefined"!=typeof window;if(isBrowser)canvas=document.createElement("canvas");else{var Canvas=require("canvas");canvas=new Canvas}return"undefined"!=typeof width&&(canvas.width=width),"undefined"!=typeof height&&(canvas.height=height),canvas},writable:!0,configurable:!0},getSize:{value:function(){return new Vector2(this._canvas.width,this._canvas.height)},writable:!0,configurable:!0},setSize:{value:function(dimensions){this._canvas.width=dimensions.x,this._canvas.height=dimensions.y},writable:!0,configurable:!0},_getContext:{value:function(){throw new Error("Renderer#_getContext is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},resizeTo:{value:function(){throw new Error("Renderer#resizeTo is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},drawImage:{value:function(){throw new Error("Renderer#drawImage is abstract and not implemented in inherited class.")},writable:!0,configurable:!0},renderFinal:{value:function(){},writable:!0,configurable:!0},getCanvas:{value:function(){return this._canvas},writable:!0,configurable:!0},getContext:{value:function(){return this._context},writable:!0,configurable:!0},setCanvas:{value:function(canvas){this._canvas=canvas,this._context=this._getContext(),this.emit("new-canvas",this._canvas)},writable:!0,configurable:!0},setContext:{value:function(context){this._context=context},writable:!0,configurable:!0},reset:{value:function(){},writable:!0,configurable:!0}}),Renderer}(EventEmitter);module.exports=Renderer},{"../lib/event-emitter":45,"../lib/math/vector2":49,canvas:"canvas"}],110:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Renderer=_interopRequire(require("./renderer")),Vector2=_interopRequire(require("../lib/math/vector2")),WebGLRenderer=function(Renderer){function WebGLRenderer(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,WebGLRenderer),_get(Object.getPrototypeOf(WebGLRenderer.prototype),"constructor",this).apply(this,args),this._defaultProgram=this.setupGLSLProgram(),this.reset()}return _inherits(WebGLRenderer,Renderer),_prototypeProperties(WebGLRenderer,{isSupported:{value:function(){return!("undefined"==typeof window||!window.WebGLRenderingContext)},writable:!0,configurable:!0}},{identifier:{get:function(){return"webgl"},configurable:!0},cache:{value:function(identifier){var size=new Vector2(this._canvas.width,this._canvas.height),fbo=void 0,texture=void 0,cacheObject=void 0;cacheObject=this._cache[identifier]?this._cache[identifier]:this._createFramebuffer(),fbo=cacheObject.fbo,texture=cacheObject.texture;var gl=this._context;gl.useProgram(this._defaultProgram),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.viewport(0,0,size.x,size.y),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture),gl.drawArrays(gl.TRIANGLES,0,6),this._cache[identifier]={fbo:fbo,texture:texture,size:size}},writable:!0,configurable:!0},_drawCachedFinal:{value:function(identifier){var _cache$identifier=this._cache[identifier],texture=_cache$identifier.texture,size=_cache$identifier.size,gl=this._context;gl.useProgram(this._defaultProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.bindTexture(gl.TEXTURE_2D,texture),this._canvas.width=size.x,this._canvas.height=size.y,gl.viewport(0,0,size.x,size.y),gl.drawArrays(gl.TRIANGLES,0,6)},writable:!0,configurable:!0},drawCached:{value:function(identifier){var _cache$identifier=this._cache[identifier],texture=_cache$identifier.texture,size=_cache$identifier.size,fbo=this.getCurrentFramebuffer(),currentTexture=this.getCurrentTexture(),gl=this._context;gl.useProgram(this._defaultProgram),this._canvas.width=size.x,this._canvas.height=size.y;for(var i=0;i<this._textures.length;i++){var otherTexture=this._textures[i];gl.bindTexture(gl.TEXTURE_2D,otherTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.bindTexture(gl.TEXTURE_2D,currentTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindTexture(gl.TEXTURE_2D,texture),gl.viewport(0,0,size.x,size.y),gl.drawArrays(gl.TRIANGLES,0,6),this.setLastTexture(currentTexture),this.selectNextBuffer()},writable:!0,configurable:!0},defaultVertexShader:{get:function(){var shader="\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    ";return shader},configurable:!0},defaultFragmentShader:{get:function(){var shader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n\n      void main() {\n        gl_FragColor = texture2D(u_image, v_texCoord);\n      }\n    ";return shader},configurable:!0},_getContext:{value:function(){return this._canvas.getContext("webgl")||this._canvas.getContext("webgl-experimental")},writable:!0,configurable:!0},drawImage:{value:function(image){var gl=this._context;gl.useProgram(this._defaultProgram);var texture=this.createTexture();gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),this._inputTexture=texture,this.setLastTexture(texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),gl.drawArrays(gl.TRIANGLES,0,6)},writable:!0,configurable:!0},runShader:{value:function(vertexShader,fragmentShader,options){"undefined"==typeof options&&(options={}),"undefined"==typeof options.uniforms&&(options.uniforms={});var gl=this._context,program=this.setupGLSLProgram(vertexShader,fragmentShader);gl.useProgram(program);var fbo=this.getCurrentFramebuffer(),currentTexture=this.getCurrentTexture();gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.bindTexture(gl.TEXTURE_2D,currentTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._canvas.width,this._canvas.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture);for(var name in options.uniforms){var location=gl.getUniformLocation(program,name),uniform=options.uniforms[name];switch(uniform.type){case"i":case"1i":gl.uniform1i(location,uniform.value);break;case"f":case"1f":gl.uniform1f(location,uniform.value);break;case"2f":gl.uniform2f(location,uniform.value[0],uniform.value[1]);break;case"3f":gl.uniform3f(location,uniform.value[0],uniform.value[1],uniform.value[2]);break;case"4f":gl.uniform4f(location,uniform.value[0],uniform.value[1],uniform.value[2],uniform.value[3]);break;case"2fv":gl.uniform2fv(location,uniform.value);break;case"mat3fv":gl.uniformMatrix3fv(location,!1,uniform.value);break;default:throw new Error("Unknown uniform type: "+uniform.type)}}gl.drawArrays(gl.TRIANGLES,0,6),this.setLastTexture(currentTexture),this.selectNextBuffer()},writable:!0,configurable:!0},renderFinal:{value:function(){var gl=this._context,program=this._defaultProgram;gl.useProgram(program),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture),gl.drawArrays(gl.TRIANGLES,0,6)},writable:!0,configurable:!0},setupGLSLProgram:{value:function(vertexShader,fragmentShader){var gl=this._context,shaders=[];vertexShader=this._createShader(gl.VERTEX_SHADER,vertexShader||WebGLRenderer.prototype.defaultVertexShader),shaders.push(vertexShader),fragmentShader=this._createShader(gl.FRAGMENT_SHADER,fragmentShader||WebGLRenderer.prototype.defaultFragmentShader),shaders.push(fragmentShader);for(var program=gl.createProgram(),i=0;i<shaders.length;i++)gl.attachShader(program,shaders[i]);gl.linkProgram(program);var linked=gl.getProgramParameter(program,gl.LINK_STATUS);if(!linked){var lastError=gl.getProgramInfoLog(program);throw gl.deleteProgram(program),new Error("WebGL program linking error: "+lastError)}var positionLocation=gl.getAttribLocation(program,"a_position"),texCoordLocation=gl.getAttribLocation(program,"a_texCoord"),texCoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),gl.STATIC_DRAW),gl.enableVertexAttribArray(texCoordLocation),gl.vertexAttribPointer(texCoordLocation,2,gl.FLOAT,!1,0,0);var buffer=gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.enableVertexAttribArray(positionLocation),gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,!1,0,0),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW),program},writable:!0,configurable:!0},_createShader:{value:function(shaderType,shaderSource){var gl=this._context,shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource),gl.compileShader(shader);var compiled=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!compiled){var lastError=gl.getShaderInfoLog(shader);throw gl.deleteShader(shader),new Error("WebGL shader compilation error: "+lastError)}return shader},writable:!0,configurable:!0},createTexture:{value:function(){var gl=this._context,texture=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),texture},writable:!0,configurable:!0},_createFramebuffers:{value:function(){for(var i=0;2>i;i++){var _createFramebuffer=this._createFramebuffer(),fbo=_createFramebuffer.fbo,texture=_createFramebuffer.texture;this._textures.push(texture),this._framebuffers.push(fbo)}},writable:!0,configurable:!0},_createFramebuffer:{value:function(){var gl=this._context,texture=this.createTexture();gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._canvas.width,this._canvas.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var fbo=gl.createFramebuffer();return gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0),{fbo:fbo,texture:texture}},writable:!0,configurable:!0},resizeTo:{value:function(dimensions){var gl=this._context;this._canvas.width=dimensions.x,this._canvas.height=dimensions.y,gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.drawArrays(gl.TRIANGLES,0,6)},writable:!0,configurable:!0},getCurrentFramebuffer:{value:function(){return this._framebuffers[this._bufferIndex%2]},writable:!0,configurable:!0},getCurrentTexture:{value:function(){return this._textures[this._bufferIndex%2]},writable:!0,configurable:!0},selectNextBuffer:{value:function(){this._bufferIndex++},writable:!0,configurable:!0},getDefaultProgram:{value:function(){return this._defaultProgram},writable:!0,configurable:!0},getLastTexture:{value:function(){return this._lastTexture},writable:!0,configurable:!0},getTextures:{value:function(){return this._textures},writable:!0,configurable:!0},setLastTexture:{value:function(texture){this._lastTexture=texture},writable:!0,configurable:!0},reset:{value:function(){this._lastTexture=null,this._textures=[],this._framebuffers=[],this._bufferIndex=0,this._createFramebuffers(),this.setLastTexture(this._inputTexture)},writable:!0,configurable:!0}}),WebGLRenderer}(Renderer);module.exports=WebGLRenderer},{"../lib/math/vector2":49,"./renderer":109}],111:[function(require,module){"use strict";var _prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Helpers=function(){function Helpers(kit,ui,options){_classCallCheck(this,Helpers),this._kit=kit,this._ui=ui,this._options=options}return _prototypeProperties(Helpers,null,{assetPath:{value:function(asset){return this._options.assetsUrl+"/"+asset},writable:!0,configurable:!0}}),Helpers}();module.exports=Helpers},{}],112:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},dot=_interopRequire(require("dot")),Utils=_interopRequire(require("../../lib/utils")),Helpers=_interopRequire(require("./helpers")),BaseUI=function(){function BaseUI(kit,options){_classCallCheck(this,BaseUI),this._kit=kit,this._options=options,this._operations=[],this._helpers=new Helpers(this.kit,this,options),this.selectOperations(null)}return _prototypeProperties(BaseUI,null,{run:{value:function(){this._attach()},writable:!0,configurable:!0},identifier:{get:function(){return null},configurable:!0},_attach:{value:function(){if(null===this._options.container)throw new Error("BaseUI#attach: No container set.");var html=this._render();this._options.container.innerHTML=html,this._options.container.style.position="relative"},writable:!0,configurable:!0},_render:{value:function(){if("undefined"==typeof this._template)throw new Error("BaseUI#_render: No template set.");var renderFn=dot.template(this._template);return renderFn(this.context)},writable:!0,configurable:!0},selectOperations:{value:function(selector){var registeredOperations=this._kit.registeredOperations,operationIdentifiers=Object.keys(registeredOperations),selectedOperations=Utils.select(operationIdentifiers,selector);this._operations=selectedOperations.map(function(identifier){return registeredOperations[identifier]})},writable:!0,configurable:!0},isOperationSelected:{value:function(identifier){var operationIdentifiers=this._operations.map(function(operation){return operation.prototype.identifier});return-1!==operationIdentifiers.indexOf(identifier)},writable:!0,configurable:!0},context:{get:function(){return{operations:this._operations,helpers:this._helpers}},configurable:!0},container:{get:function(){return this._options.container},configurable:!0},operations:{get:function(){return this._operations},configurable:!0},options:{get:function(){return this._options},configurable:!0},canvas:{get:function(){return this._canvas},configurable:!0},helpers:{get:function(){return this._helpers},configurable:!0},image:{get:function(){return this._options.image},configurable:!0}}),BaseUI}();module.exports=BaseUI},{"../../lib/utils":51,"./helpers":111,dot:41}],113:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Slider=_interopRequire(require("../lib/slider")),BrightnessControl=function(Control){function BrightnessControl(){_classCallCheck(this,BrightnessControl),null!=Control&&Control.apply(this,arguments)}return _inherits(BrightnessControl,Control),_prototypeProperties(BrightnessControl,null,{identifier:{get:function(){return"brightness"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)},writable:!0,configurable:!0},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.brightness,this._operation=this._ui.getOrCreateOperation("brightness");var brightness=this._operation.getBrightness();this._initialBrightness=brightness;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:-1,maxValue:1,defaultValue:brightness}),this._slider.on("update",this._onUpdate.bind(this))},writable:!0,configurable:!0},_onBack:{value:function(){_get(Object.getPrototypeOf(BrightnessControl.prototype),"_onBack",this).call(this),this._operationExistedBefore?this._operation.setBrightness(this._initialBrightness):this._ui.removeOperation("brightness"),this._ui.canvas.render()},writable:!0,configurable:!0},_onUpdate:{value:function(value){this._operation.setBrightness(value),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{brightness:this._initialBrightness},this._operationExistedBefore)},writable:!0,configurable:!0}}),BrightnessControl}(Control);module.exports=BrightnessControl},{"../lib/slider":129,"./control":115}],114:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Slider=_interopRequire(require("../lib/slider")),ContrastControl=function(Control){function ContrastControl(){_classCallCheck(this,ContrastControl),null!=Control&&Control.apply(this,arguments)}return _inherits(ContrastControl,Control),_prototypeProperties(ContrastControl,null,{identifier:{get:function(){return"contrast"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)},writable:!0,configurable:!0},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.contrast,this._operation=this._ui.getOrCreateOperation("contrast");var contrast=this._operation.getContrast();this._initialContrast=contrast;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:0,maxValue:2,defaultValue:contrast}),this._slider.on("update",this._onUpdate.bind(this))},writable:!0,configurable:!0},_onBack:{value:function(){_get(Object.getPrototypeOf(ContrastControl.prototype),"_onBack",this).call(this),this._operationExistedBefore?this._operation.setContrast(this._initialContrast):this._ui.removeOperation("contrast"),this._ui.canvas.render()},writable:!0,configurable:!0},_onUpdate:{value:function(value){this._operation.setContrast(value),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{contrast:this._initialContrast},this._operationExistedBefore)},writable:!0,configurable:!0}}),ContrastControl}(Control);module.exports=ContrastControl},{"../lib/slider":129,"./control":115}],115:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},dot=_interopRequire(require("dot")),Helpers=_interopRequire(require("../../base/helpers")),EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Control=function(EventEmitter){function Control(kit,ui,operation){_classCallCheck(this,Control),_get(Object.getPrototypeOf(Control.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._operation=operation,this._helpers=new Helpers(this._kit,this._ui,this._ui.options),this._partialTemplates=[],this._active=!1,this.init()}return _inherits(Control,EventEmitter),_prototypeProperties(Control,null,{identifier:{get:function(){return null},configurable:!0},setContainers:{value:function(controlsContainer,canvasControlsContainer){this._controlsContainer=controlsContainer,this._canvasControlsContainer=canvasControlsContainer},writable:!0,configurable:!0},init:{value:function(){},writable:!0,configurable:!0},_renderAllControls:{value:function(){this._renderControls(),this._renderCanvasControls()},writable:!0,configurable:!0},_renderControls:{value:function(){if("undefined"==typeof this._controlsTemplate)throw new Error("Control#_renderOverviewControls: Control needs to define this._controlsTemplate.");var template=this._partialTemplates.concat([this._controlsTemplate]).join("\r\n"),renderFn=dot.template(template),html=renderFn(this.context);"undefined"!=typeof this._controls&&null!==this._controls.parentNode&&this._controls.parentNode.removeChild(this._controls),this._controls=document.createElement("div"),this._controls.innerHTML=html,this._controlsContainer.appendChild(this._controls)},writable:!0,configurable:!0},_renderCanvasControls:{value:function(){if("undefined"!=typeof this._canvasControlsTemplate){var template=this._partialTemplates.concat([this._canvasControlsTemplate]).join("\r\n"),renderFn=dot.template(template),html=renderFn(this.context);this._canvasControls=document.createElement("div"),this._canvasControls.innerHTML=html,this._canvasControlsContainer.appendChild(this._canvasControls)}},writable:!0,configurable:!0},_removeControls:{value:function(){this._controls.parentNode.removeChild(this._controls),this._canvasControls&&this._canvasControls.parentNode.removeChild(this._canvasControls)},writable:!0,configurable:!0},_handleBackAndDoneButtons:{value:function(){var backButton=this._controls.querySelector(".imglykit-controls-back");backButton.addEventListener("click",this._onBackButtonClick.bind(this));var doneButton=this._controls.querySelector(".imglykit-controls-done");doneButton.addEventListener("click",this._onDoneButtonClick.bind(this))},writable:!0,configurable:!0},_onBackButtonClick:{value:function(){this._onBack(),this.emit("back")},writable:!0,configurable:!0},_onDoneButtonClick:{value:function(){this._onDone(),this.emit("back")},writable:!0,configurable:!0},enter:{value:function(){this._active=!0,this._ui.hideZoom(),this._renderAllControls(),this._handleBackAndDoneButtons(),this._enableCanvasControls(),this._onEnter()},writable:!0,configurable:!0},leave:{value:function(){this._active=!1,this._ui.showZoom(),this._removeControls(),this._disableCanvasControls(),this._onLeave()},writable:!0,configurable:!0},_enableCanvasControls:{value:function(){this._canvasControlsContainer.classList.remove("imglykit-canvas-controls-disabled")},writable:!0,configurable:!0},_disableCanvasControls:{value:function(){this._canvasControlsContainer.classList.add("imglykit-canvas-controls-disabled")},writable:!0,configurable:!0},_onEnter:{value:function(){},writable:!0,configurable:!0},_onLeave:{value:function(){},writable:!0,configurable:!0},_onBack:{value:function(){},writable:!0,configurable:!0},_onDone:{value:function(){},writable:!0,configurable:!0},onZoom:{value:function(){},writable:!0,configurable:!0},context:{get:function(){return{helpers:this._helpers}},configurable:!0}}),Control}(EventEmitter);module.exports=Control},{"../../../lib/event-emitter":45,"../../base/helpers":111,dot:41}],116:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;
var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),CropControl=function(Control){function CropControl(){_classCallCheck(this,CropControl),null!=Control&&Control.apply(this,arguments)}return _inherits(CropControl,Control),_prototypeProperties(CropControl,null,{identifier:{get:function(){return"crop"},configurable:!0},init:{value:function(){this._availableRatios={},this._ratios={};var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.ratios) { }}\n        {{ var ratio = it.ratios[identifier]; }}\n        {{ var enabled = ratio.selected; }}\n        <li data-identifier="{{= identifier}}" data-ratio="{{= ratio.ratio}}"{{? enabled}} data-selected{{?}}>\n          <img src="{{=it.helpers.assetPath(\'ui/night/crop/\' + identifier + \'.png\')}}" />\n        </li>\n      {{ } }}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-crop-container">\n  <div class="imglykit-canvas-crop-top">\n    <div class="imglykit-canvas-crop-top-left"></div>\n    <div class="imglykit-canvas-crop-top-center"></div>\n    <div class="imglykit-canvas-crop-top-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-center">\n    <div class="imglykit-canvas-crop-center-left"></div>\n    <div class="imglykit-canvas-crop-center-center">\n      <div class="imglykit-canvas-crop-knobs">\n        <div data-corner="top-left"></div>\n        <div data-corner="top-right"></div>\n        <div data-corner="bottom-left"></div>\n        <div data-corner="bottom-right"></div>\n      </div>\n    </div>\n    <div class="imglykit-canvas-crop-center-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-bottom">\n    <div class="imglykit-canvas-crop-bottom-left"></div>\n    <div class="imglykit-canvas-crop-bottom-center"></div>\n    <div class="imglykit-canvas-crop-bottom-right"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._onKnobDown=this._onKnobDown.bind(this),this._onKnobDrag=this._onKnobDrag.bind(this),this._onKnobUp=this._onKnobUp.bind(this),this._onCenterDown=this._onCenterDown.bind(this),this._onCenterDrag=this._onCenterDrag.bind(this),this._onCenterUp=this._onCenterUp.bind(this),this._addDefaultRatios(),this.selectRatios(null)},writable:!0,configurable:!0},selectRatios:{value:function(selector){this._ratios={};for(var ratioIdentifiers=Object.keys(this._availableRatios),selectedRatios=Utils.select(ratioIdentifiers,selector),i=0;i<selectedRatios.length;i++){var identifier=selectedRatios[i];this._ratios[identifier]=this._availableRatios[identifier]}this._active&&this._renderControls()},writable:!0,configurable:!0},_addDefaultRatios:{value:function(){this.addRatio("custom","*",!0),this.addRatio("square","1"),this.addRatio("4-3","1.33"),this.addRatio("16-9","1.77")},writable:!0,configurable:!0},addRatio:{value:function(identifier,ratio,selected){this._availableRatios[identifier]={ratio:ratio,selected:selected}},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;_get(Object.getPrototypeOf(CropControl.prototype),"_onEnter",this).call(this),this._operationExistedBefore=!!this._ui.operations.crop,this._operation=this._ui.getOrCreateOperation("crop"),this._defaultStart=new Vector2(.1,.1),this._defaultEnd=new Vector2(.9,.9),this._initialOptions={start:this._operation.getStart(),end:this._operation.getEnd()},this._start=this._initialOptions.start||this._defaultStart,this._end=this._initialOptions.end||this._defaultEnd,this._minimumSize=new Vector2(50,50),this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(!1);var prefix=".imglykit-canvas-crop",container=this._canvasControls,knobsContainer=container.querySelector(""+prefix+"-knobs");this._initialStart=this._operation.getStart().clone(),this._initialEnd=this._operation.getEnd().clone(),this._operation.set({start:new Vector2(0,0),end:new Vector2(1,1)}),this._knobs={topLeft:knobsContainer.querySelector("[data-corner=top-left]"),topRight:knobsContainer.querySelector("[data-corner=top-right]"),bottomLeft:knobsContainer.querySelector("[data-corner=bottom-left]"),bottomRight:knobsContainer.querySelector("[data-corner=bottom-right]")},this._areas={topLeft:this._canvasControls.querySelector(""+prefix+"-top-left"),topCenter:this._canvasControls.querySelector(""+prefix+"-top-center"),centerLeft:this._canvasControls.querySelector(""+prefix+"-center-left"),centerCenter:this._canvasControls.querySelector(""+prefix+"-center-center")},this._handleControls(),this._handleKnobs(),this._handleCenter(),this._ui.canvas.render().then(function(){_this._updateDOM()})},writable:!0,configurable:!0},_handleControls:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("ul > li");this._ratioItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._ratioItems.length;i++){var _item$dataset;!function(i){var item=_this._ratioItems[i];_item$dataset=item.dataset;var selected=_item$dataset.selected,ratio=_item$dataset.ratio,identifier=_item$dataset.identifier;"undefined"==typeof selected||_this._operationExistedBefore||(_this._setRatio(identifier,ratio,!1),_this._selectRatio(item)),item.addEventListener("click",function(e){e.preventDefault(),_this._onRatioClick(item)})}(i)}},writable:!0,configurable:!0},_onRatioClick:{value:function(item){this._unselectAllRatios(),this._selectRatio(item)},writable:!0,configurable:!0},_unselectAllRatios:{value:function(){for(var i=0;i<this._ratioItems.length;i++){var item=this._ratioItems[i];item.classList.remove("imglykit-controls-item-active")}},writable:!0,configurable:!0},_selectRatio:{value:function(item){item.classList.add("imglykit-controls-item-active");var _item$dataset=item.dataset,ratio=_item$dataset.ratio,identifier=_item$dataset.identifier;this._setRatio(identifier,ratio)},writable:!0,configurable:!0},_setRatio:{value:function(identifier,ratio){var resize=void 0===arguments[2]?!0:arguments[2],canvasSize=this._ui.canvas.size;if(this._selectedRatio=identifier,"*"===ratio)this._ratio=null,this._start=new Vector2(.1,.1),this._end=new Vector2(.9,.9);else if("original"===ratio?this._ratio=canvasSize.x/canvasSize.y:(ratio=parseFloat(ratio),this._ratio=ratio),resize)if(canvasSize.x/canvasSize.y<=this._ratio){this._start.x=.1,this._end.x=.9;var height=1/canvasSize.y*(canvasSize.x/this._ratio)*.8;this._start.y=(1-height)/2,this._end.y=1-this._start.y}else{this._start.y=.1,this._end.y=.9;var width=1/canvasSize.x*this._ratio*canvasSize.y*.8;this._start.x=(1-width)/2,this._end.x=1-this._start.x}this._updateDOM()},writable:!0,configurable:!0},_updateDOM:{value:function(){var canvasSize=this._ui.canvas.size,startAbsolute=this._start.clone().multiply(canvasSize),endAbsolute=this._end.clone().multiply(canvasSize),size=endAbsolute.clone().subtract(startAbsolute),top=Math.max(1,startAbsolute.y),left=Math.max(1,startAbsolute.x),width=Math.max(1,size.x),height=Math.max(1,size.y);this._areas.topLeft.style.width=""+left+"px",this._areas.topCenter.style.width=""+width+"px",this._areas.topLeft.style.height=""+top+"px",this._areas.centerLeft.style.height=""+height+"px"},writable:!0,configurable:!0},_handleKnobs:{value:function(){var _this=this;for(var identifier in this._knobs)!function(identifier){var knob=_this._knobs[identifier];knob.addEventListener("mousedown",function(e){_this._onKnobDown(e,knob)}),knob.addEventListener("touchstart",function(e){_this._onKnobDown(e,knob)})}(identifier)},writable:!0,configurable:!0},_onKnobDown:{value:function(e,knob){e.preventDefault(),e.stopPropagation(),this._currentKnob=knob,this._initialMousePosition=Utils.getEventPosition(e),this._startBeforeDrag=this._start.clone(),this._endBeforeDrag=this._end.clone(),document.addEventListener("mousemove",this._onKnobDrag),document.addEventListener("touchmove",this._onKnobDrag),document.addEventListener("mouseup",this._onKnobUp),document.addEventListener("touchend",this._onKnobUp)},writable:!0,configurable:!0},_onKnobDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),corner=this._currentKnob.dataset.corner,canvasSize=this._ui.canvas.size,absoluteStart=this._startBeforeDrag.clone().multiply(canvasSize),absoluteEnd=this._endBeforeDrag.clone().multiply(canvasSize),maxHeight=canvasSize.y,width=void 0,height=void 0,maximum=void 0,minimum=void 0;switch(corner){case"top-left":absoluteStart.add(mouseDiff),maximum=absoluteEnd.clone().subtract(this._minimumSize),absoluteStart.clamp(null,maximum);break;case"top-right":absoluteEnd.x+=mouseDiff.x,absoluteStart.y+=mouseDiff.y,absoluteEnd.x=Math.max(absoluteStart.x+this._minimumSize.x,absoluteEnd.x),absoluteStart.y=Math.min(absoluteEnd.y-this._minimumSize.y,absoluteStart.y);break;case"bottom-right":absoluteEnd.add(mouseDiff),minimum=absoluteStart.clone().add(this._minimumSize),absoluteEnd.clamp(minimum),maxHeight=canvasSize.y-absoluteStart.y;break;case"bottom-left":absoluteStart.x+=mouseDiff.x,absoluteEnd.y+=mouseDiff.y,absoluteStart.x=Math.min(absoluteEnd.x-this._minimumSize.x,absoluteStart.x),absoluteEnd.y=Math.max(absoluteStart.y+this._minimumSize.y,absoluteEnd.y)}if(this._start.copy(absoluteStart).divide(canvasSize),this._end.copy(absoluteEnd).divide(canvasSize),this._start.clamp(0,1),this._end.clamp(0,1),null!==this._ratio)switch(corner){case"top-left":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._start.y=this._end.y-height/canvasSize.y,this._start.y<=0&&(this._start.y=0,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._start.x=this._end.x-width/canvasSize.x);break;case"top-right":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._start.y=this._end.y-height/canvasSize.y,this._start.y<=0&&(this._start.y=0,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._end.x=this._start.x+width/canvasSize.x);break;case"bottom-right":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._end.y=this._start.y+height/canvasSize.y,this._end.y>=1&&(this._end.y=1,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._end.x=this._start.x+width/canvasSize.x);break;case"bottom-left":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._end.y=this._start.y+height/canvasSize.y,this._end.y>=1&&(this._end.y=1,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._start.x=this._end.x-width/canvasSize.x)}this._updateDOM()},writable:!0,configurable:!0},_onKnobUp:{value:function(){this._currentKnob=null,document.removeEventListener("mousemove",this._onKnobDrag),document.removeEventListener("touchmove",this._onKnobDrag),document.removeEventListener("mouseup",this._onKnobUp),document.removeEventListener("touchend",this._onKnobUp)},writable:!0,configurable:!0},_handleCenter:{value:function(){this._areas.centerCenter.addEventListener("mousedown",this._onCenterDown),this._areas.centerCenter.addEventListener("touchstart",this._onCenterDown)},writable:!0,configurable:!0},_onCenterDown:{value:function(e){this._initialMousePosition=Utils.getEventPosition(e),this._startBeforeDrag=this._start.clone(),this._endBeforeDrag=this._end.clone(),document.addEventListener("mousemove",this._onCenterDrag),document.addEventListener("touchmove",this._onCenterDrag),document.addEventListener("mouseup",this._onCenterUp),document.addEventListener("touchend",this._onCenterUp)},writable:!0,configurable:!0},_onCenterDrag:{value:function(e){var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),canvasSize=this._ui.canvas.size,cropSize=this._endBeforeDrag.clone().subtract(this._startBeforeDrag),absoluteCropSize=cropSize.clone().multiply(canvasSize),absoluteStart=this._startBeforeDrag.clone().multiply(canvasSize),absoluteEnd=this._endBeforeDrag.clone().multiply(canvasSize);absoluteStart.add(mouseDiff);var maxStart=canvasSize.clone().subtract(absoluteCropSize);absoluteStart.clamp(new Vector2(0,0),maxStart),absoluteEnd.copy(absoluteStart).add(absoluteCropSize),this._start.copy(absoluteStart).divide(canvasSize),this._end.copy(absoluteEnd).divide(canvasSize),this._updateDOM()},writable:!0,configurable:!0},_onCenterUp:{value:function(){document.removeEventListener("mousemove",this._onCenterDrag),document.removeEventListener("touchmove",this._onCenterDrag),document.removeEventListener("mouseup",this._onCenterUp),document.removeEventListener("touchend",this._onCenterUp)},writable:!0,configurable:!0},_onBack:{value:function(){this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operationExistedBefore?this._operation.set({start:this._initialStart,end:this._initialEnd}):this._ui.removeOperation("crop"),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._operation.set({start:this._start,end:this._end}),this._ui.canvas.zoomToFit(!0),this._ui.addHistory(this._operation,{start:this._initialStart.clone(),end:this._initialEnd.clone()},this._operationExistedBefore)},writable:!0,configurable:!0},context:{get:function(){var context=_get(Object.getPrototypeOf(CropControl.prototype),"context",this);return context.ratios=this._ratios,context},configurable:!0},selectedRatio:{get:function(){return this._selectedRatio},configurable:!0}}),CropControl}(Control);module.exports=CropControl},{"../../../lib/math/vector2":49,"../../../lib/utils":51,"./control":115}],117:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Utils=_interopRequire(require("../../../lib/utils")),FiltersControl=function(Control){function FiltersControl(){_classCallCheck(this,FiltersControl),null!=Control&&Control.apply(this,arguments)}return _inherits(FiltersControl,Control),_prototypeProperties(FiltersControl,null,{identifier:{get:function(){return"filters"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.filters) { }}\n        {{ var filter = it.filters[identifier]; }}\n        {{ var name = filter.prototype.name; }}\n        {{ var enabled = it.activeFilter.identifier === identifier; }}\n        {{? identifier !== "identity"}}\n        <li data-identifier="{{= identifier}}" class="imglykit-controls-item-with-label{{? enabled}} imglykit-controls-item-active{{?}}">\n          <img src="{{=it.helpers.assetPath(\'ui/night/filters/\' + identifier + \'.png\')}}" />\n          <div class="imglykit-controls-item-label">{{= name }}</div>\n        </li>\n        {{?}}\n      {{ } }}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._availableFilters={},this._filters={},this._addDefaultFilters(),this.selectFilters(null)},writable:!0,configurable:!0},_renderAllControls:{value:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];this._operationExistedBefore=!!this._ui.operations.filters,this._operation=this._ui.getOrCreateOperation("filters"),_get(Object.getPrototypeOf(FiltersControl.prototype),"_renderAllControls",this).apply(this,args)},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._initialFilter=this._operation.getFilter();var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)})}(i)},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?this._operation.setFilter(this._initialFilter):this._ui.removeOperation("filters"),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{filter:this._initialFilter},this._operationExistedBefore)},writable:!0,configurable:!0},_onListItemClick:{value:function(item){this._deactivateAllItems();var identifier=item.dataset.identifier;this._operation.setFilter(this._filters[identifier]),this._ui.canvas.render(),item.classList.add("imglykit-controls-item-active")},writable:!0,configurable:!0},_deactivateAllItems:{value:function(){for(var i=0;i<this._listItems.length;i++){var listItem=this._listItems[i];listItem.classList.remove("imglykit-controls-item-active")}},writable:!0,configurable:!0},_addDefaultFilters:{value:function(){this.addFilter(require("../../../operations/filters/identity-filter")),this.addFilter(require("../../../operations/filters/k1-filter")),this.addFilter(require("../../../operations/filters/k2-filter")),this.addFilter(require("../../../operations/filters/k6-filter")),this.addFilter(require("../../../operations/filters/kdynamic-filter")),this.addFilter(require("../../../operations/filters/fridge-filter")),this.addFilter(require("../../../operations/filters/breeze-filter")),this.addFilter(require("../../../operations/filters/orchid-filter")),this.addFilter(require("../../../operations/filters/chest-filter")),this.addFilter(require("../../../operations/filters/front-filter")),this.addFilter(require("../../../operations/filters/fixie-filter")),this.addFilter(require("../../../operations/filters/x400-filter")),this.addFilter(require("../../../operations/filters/bw-filter")),this.addFilter(require("../../../operations/filters/bwhard-filter")),this.addFilter(require("../../../operations/filters/lenin-filter")),this.addFilter(require("../../../operations/filters/quozi-filter")),this.addFilter(require("../../../operations/filters/pola669-filter")),this.addFilter(require("../../../operations/filters/pola-filter")),this.addFilter(require("../../../operations/filters/food-filter")),this.addFilter(require("../../../operations/filters/glam-filter")),this.addFilter(require("../../../operations/filters/celsius-filter")),this.addFilter(require("../../../operations/filters/texas-filter")),this.addFilter(require("../../../operations/filters/morning-filter")),this.addFilter(require("../../../operations/filters/lomo-filter")),this.addFilter(require("../../../operations/filters/gobblin-filter")),this.addFilter(require("../../../operations/filters/mellow-filter")),this.addFilter(require("../../../operations/filters/sunny-filter")),this.addFilter(require("../../../operations/filters/a15-filter")),this.addFilter(require("../../../operations/filters/semired-filter"))},writable:!0,configurable:!0},addFilter:{value:function(filter){this._availableFilters[filter.identifier]=filter},writable:!0,configurable:!0},selectFilters:{value:function(selector){this._filters={};for(var filterIdentifiers=Object.keys(this._availableFilters),selectedFilters=Utils.select(filterIdentifiers,selector),i=0;i<selectedFilters.length;i++){var identifier=selectedFilters[i];this._filters[identifier]=this._availableFilters[identifier]}this._active&&this._renderControls()},writable:!0,configurable:!0},context:{get:function(){var context=_get(Object.getPrototypeOf(FiltersControl.prototype),"context",this);return context.filters=this._filters,context.activeFilter=this._operation.getFilter(),context},configurable:!0}}),FiltersControl}(Control);module.exports=FiltersControl},{"../../../lib/utils":51,"../../../operations/filters/a15-filter":56,"../../../operations/filters/breeze-filter":57,"../../../operations/filters/bw-filter":58,"../../../operations/filters/bwhard-filter":59,"../../../operations/filters/celsius-filter":60,"../../../operations/filters/chest-filter":61,"../../../operations/filters/fixie-filter":63,"../../../operations/filters/food-filter":64,"../../../operations/filters/fridge-filter":65,"../../../operations/filters/front-filter":66,"../../../operations/filters/glam-filter":67,"../../../operations/filters/gobblin-filter":68,"../../../operations/filters/identity-filter":69,"../../../operations/filters/k1-filter":70,"../../../operations/filters/k2-filter":71,"../../../operations/filters/k6-filter":72,"../../../operations/filters/kdynamic-filter":73,"../../../operations/filters/lenin-filter":74,"../../../operations/filters/lomo-filter":75,"../../../operations/filters/mellow-filter":76,"../../../operations/filters/morning-filter":77,"../../../operations/filters/orchid-filter":78,"../../../operations/filters/pola-filter":79,"../../../operations/filters/pola669-filter":80,"../../../operations/filters/quozi-filter":94,"../../../operations/filters/semired-filter":95,"../../../operations/filters/sunny-filter":96,"../../../operations/filters/texas-filter":97,"../../../operations/filters/x400-filter":98,"./control":115}],118:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),FlipControl=function(Control){function FlipControl(){_classCallCheck(this,FlipControl),null!=Control&&Control.apply(this,arguments)}return _inherits(FlipControl,Control),_prototypeProperties(FlipControl,null,{identifier:{get:function(){return"flip"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      <li data-direction="horizontal">\n        <img src="{{=it.helpers.assetPath(\'ui/night/flip/horizontal.png\')}}" />\n      </li>\n      <li data-direction="vertical">\n        <img src="{{=it.helpers.assetPath(\'ui/night/flip/vertical.png\')}}" />\n      </li>\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.flip,this._operation=this._ui.getOrCreateOperation("flip"),this._initialHorizontal=this._operation.getHorizontal(),this._initialVertical=this._operation.getVertical();var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)});var direction=listItem.dataset.direction;"horizontal"===direction&&_this._operation.getHorizontal()?_this._toggleItem(listItem,!0):"vertical"===direction&&_this._operation.getVertical()&&_this._toggleItem(listItem,!0)}(i)},writable:!0,configurable:!0},_onListItemClick:{value:function(item){var direction=item.dataset.direction,active=!1;if("horizontal"===direction){var currentHorizontal=this._operation.getHorizontal();this._operation.setHorizontal(!currentHorizontal),this._ui.canvas.render(),active=!currentHorizontal}else if("vertical"===direction){var currentVertical=this._operation.getVertical();this._operation.setVertical(!currentVertical),this._ui.canvas.render(),active=!currentVertical}this._toggleItem(item,active)},writable:!0,configurable:!0},_toggleItem:{value:function(item,active){var activeClass="imglykit-controls-item-active";active?item.classList.add(activeClass):item.classList.remove(activeClass)},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?(this._operation.setHorizontal(this._initialHorizontal),this._operation.setVertical(this._initialVertical)):this._ui.removeOperation("flip"),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{vertical:this._initialVertical,horizontal:this._initialHorizontal},this._operationExistedBefore)},writable:!0,configurable:!0}}),FlipControl}(Control);module.exports=FlipControl},{"./control":115}],119:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),ColorPicker=_interopRequire(require("../lib/color-picker")),FramesControl=function(Control){function FramesControl(){_classCallCheck(this,FramesControl),null!=Control&&Control.apply(this,arguments)}return _inherits(FramesControl,Control),_prototypeProperties(FramesControl,null,{identifier:{get:function(){return"frames"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerLabel = "Color";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(SimpleSlider.template),this._partialTemplates.push(ColorPicker.template)},writable:!0,configurable:!0},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.frames,this._operation=this._ui.getOrCreateOperation("frames"),this._initialOptions={thickness:this._operation.getThickness(),color:this._operation.getColor()},this._ui.canvas.render();var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new SimpleSlider(sliderElement,{minValue:0,maxValue:.5}),this._slider.on("update",this._onThicknessUpdate.bind(this)),this._slider.setValue(this._initialOptions.thickness);var colorPickerElement=this._controls.querySelector(".imglykit-color-picker");this._colorPicker=new ColorPicker(this._ui,colorPickerElement),this._colorPicker.on("update",this._onColorUpdate.bind(this)),this._colorPicker.setValue(this._initialOptions.color)},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialOptions):this._ui.removeOperation("frames"),this._ui.canvas.render()},writable:!0,configurable:!0},_onThicknessUpdate:{value:function(value){this._operation.setThickness(value),this._ui.canvas.render()},writable:!0,configurable:!0},_onColorUpdate:{value:function(value){this._operation.setColor(value),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{color:this._initialOptions.color,thickness:this._initialOptions.thickness},this._operationExistedBefore)},writable:!0,configurable:!0}}),FramesControl}(Control);module.exports=FramesControl},{"../lib/color-picker":127,"../lib/simple-slider":128,"./control":115}],120:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),RadialBlurControl=function(Control){function RadialBlurControl(){_classCallCheck(this,RadialBlurControl),null!=Control&&Control.apply(this,arguments)}return _inherits(RadialBlurControl,Control),_prototypeProperties(RadialBlurControl,null,{identifier:{get:function(){return"radial-blur"
},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-radial-blur">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div class="imglykit-controls-icon">\n    <img src="{{=it.helpers.assetPath(\'ui/night/blur/blur.png\')}}" />\n  </div>\n\n  <div>\n    {{var sliderId = "imglykit-blur-radius-slider";}}\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-radial-blur-container">\n  <div class="imglykit-canvas-radial-blur-dot" id="imglykit-radial-blur-position"></div>\n  <div class="imglykit-canvas-radial-blur-dot" id="imglykit-radial-blur-gradient"></div>\n  <div class="imglykit-canvas-radial-blur-circle-container">\n    <div class="imglykit-canvas-radial-blur-circle"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(SimpleSlider.template)},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations["radial-blur"],this._operation=this._ui.getOrCreateOperation("radial-blur"),this._initialSettings={position:this._operation.getPosition().clone(),gradientRadius:this._operation.getGradientRadius(),blurRadius:this._operation.getBlurRadius()},this._onPositionKnobDown=this._onPositionKnobDown.bind(this),this._onPositionKnobDrag=this._onPositionKnobDrag.bind(this),this._onPositionKnobUp=this._onPositionKnobUp.bind(this),this._onGradientKnobDown=this._onGradientKnobDown.bind(this),this._onGradientKnobDrag=this._onGradientKnobDrag.bind(this),this._onGradientKnobUp=this._onGradientKnobUp.bind(this),this._positionKnob=this._canvasControls.querySelector("#imglykit-radial-blur-position"),this._gradientKnob=this._canvasControls.querySelector("#imglykit-radial-blur-gradient"),this._circle=this._canvasControls.querySelector(".imglykit-canvas-radial-blur-circle"),this._handleKnobs(),this._initSliders(),this._ui.canvas.render().then(function(){_this._updateDOM()})},writable:!0,configurable:!0},_initSliders:{value:function(){var blurRadiusSlider=this._controls.querySelector("#imglykit-blur-radius-slider");this._blurRadiusSlider=new SimpleSlider(blurRadiusSlider,{minValue:0,maxValue:40}),this._blurRadiusSlider.on("update",this._onBlurRadiusUpdate.bind(this)),this._blurRadiusSlider.setValue(this._initialSettings.blurRadius)},writable:!0,configurable:!0},_onBlurRadiusUpdate:{value:function(value){this._operation.setBlurRadius(value),this._ui.canvas.render()},writable:!0,configurable:!0},_handleKnobs:{value:function(){var canvasSize=this._ui.canvas.size,position=this._operation.getPosition().clone().multiply(canvasSize);this._gradientKnobPosition=position.clone().add(this._initialSettings.gradientRadius,0),this._positionKnob.addEventListener("mousedown",this._onPositionKnobDown),this._positionKnob.addEventListener("touchstart",this._onPositionKnobDown),this._gradientKnob.addEventListener("mousedown",this._onGradientKnobDown),this._gradientKnob.addEventListener("touchstart",this._onGradientKnobDown)},writable:!0,configurable:!0},_onPositionKnobDown:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size;this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._operation.getPosition().clone(),this._gradientKnobDistance=this._gradientKnobPosition.clone().subtract(this._initialPosition.clone().multiply(canvasSize)),document.addEventListener("mousemove",this._onPositionKnobDrag),document.addEventListener("touchmove",this._onPositionKnobDrag),document.addEventListener("mouseup",this._onPositionKnobUp),document.addEventListener("touchend",this._onPositionKnobUp)},writable:!0,configurable:!0},_onPositionKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),newPosition=this._initialPosition.clone().multiply(canvasSize).add(diff),maxPosition=canvasSize.clone().subtract(this._gradientKnobDistance);newPosition.clamp(new Vector2(0,0),maxPosition),this._gradientKnobPosition.copy(newPosition).add(this._gradientKnobDistance),newPosition.divide(canvasSize),this._operation.setPosition(newPosition),this._updateDOM(),this._ui.canvas.render()},writable:!0,configurable:!0},_onPositionKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onPositionKnobDrag),document.removeEventListener("touchmove",this._onPositionKnobDrag),document.removeEventListener("mouseup",this._onPositionKnobUp),document.removeEventListener("touchend",this._onPositionKnobUp)},writable:!0,configurable:!0},_onGradientKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialGradientKnobPosition=this._gradientKnobPosition.clone(),document.addEventListener("mousemove",this._onGradientKnobDrag),document.addEventListener("touchmove",this._onGradientKnobDrag),document.addEventListener("mouseup",this._onGradientKnobUp),document.addEventListener("touchend",this._onGradientKnobUp)},writable:!0,configurable:!0},_onGradientKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition);this._gradientKnobPosition=this._initialGradientKnobPosition.clone().add(diff),this._gradientKnobPosition.clamp(new Vector2(0,0),canvasSize);var position=this._operation.getPosition().clone().multiply(canvasSize),distance=this._gradientKnobPosition.clone().subtract(position),gradientRadius=Math.sqrt(Math.pow(distance.x,2)+Math.pow(distance.y,2));this._operation.setGradientRadius(gradientRadius),this._updateDOM(),this._ui.canvas.render()},writable:!0,configurable:!0},_onGradientKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onGradientKnobDrag),document.removeEventListener("touchmove",this._onGradientKnobDrag),document.removeEventListener("mouseup",this._onGradientKnobUp),document.removeEventListener("touchend",this._onGradientKnobUp)},writable:!0,configurable:!0},_updateDOM:{value:function(){var canvasSize=this._ui.canvas.size,position=this._operation.getPosition().clone().multiply(canvasSize);this._positionKnob.style.left=""+position.x+"px",this._positionKnob.style.top=""+position.y+"px",this._gradientKnob.style.left=""+this._gradientKnobPosition.x+"px",this._gradientKnob.style.top=""+this._gradientKnobPosition.y+"px";var circleSize=2*this._operation.getGradientRadius();this._circle.style.left=""+position.x+"px",this._circle.style.top=""+position.y+"px",this._circle.style.width=""+circleSize+"px",this._circle.style.height=""+circleSize+"px",this._circle.style.marginLeft="-"+circleSize/2+"px",this._circle.style.marginTop="-"+circleSize/2+"px"},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialSettings):this._ui.removeOperation("radial-blur"),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{position:this._initialSettings.position.clone(),gradientRadius:this._initialSettings.gradientRadius,blurRadius:this._initialSettings.blurRadius},this._operationExistedBefore)},writable:!0,configurable:!0}}),RadialBlurControl}(Control);module.exports=RadialBlurControl},{"../../../lib/math/vector2":49,"../../../lib/utils":51,"../lib/simple-slider":128,"./control":115}],121:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),RotationControl=function(Control){function RotationControl(){_classCallCheck(this,RotationControl),null!=Control&&Control.apply(this,arguments)}return _inherits(RotationControl,Control),_prototypeProperties(RotationControl,null,{identifier:{get:function(){return"rotation"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      <li data-degrees="-90">\n        <img src="{{=it.helpers.assetPath(\'ui/night/rotation/left.png\')}}" />\n      </li>\n      <li data-degrees="90">\n        <img src="{{=it.helpers.assetPath(\'ui/night/rotation/right.png\')}}" />\n      </li>\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-crop-container imglykit-canvas-crop-container-hidden">\n  <div class="imglykit-canvas-crop-top">\n    <div class="imglykit-canvas-crop-top-left"></div>\n    <div class="imglykit-canvas-crop-top-center"></div>\n    <div class="imglykit-canvas-crop-top-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-center">\n    <div class="imglykit-canvas-crop-center-left"></div>\n    <div class="imglykit-canvas-crop-center-center imglykit-canvas-crop-center-center-nomove">\n\n    </div>\n    <div class="imglykit-canvas-crop-center-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-bottom">\n    <div class="imglykit-canvas-crop-bottom-left"></div>\n    <div class="imglykit-canvas-crop-bottom-center"></div>\n    <div class="imglykit-canvas-crop-bottom-right"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.rotation,this._operation=this._ui.getOrCreateOperation("rotation"),this._cropOperation=this._ui.operations.crop,this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(!1),this._cropOperation&&(this._initialStart=this._cropOperation.getStart().clone(),this._initialEnd=this._cropOperation.getEnd().clone(),this._cropOperation.set({start:new Vector2(0,0),end:new Vector2(1,1)})),this._initialDegrees=this._operation.getDegrees();var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)})}(i);var prefix=".imglykit-canvas-crop";this._cropAreas={topLeft:this._canvasControls.querySelector(""+prefix+"-top-left"),topCenter:this._canvasControls.querySelector(""+prefix+"-top-center"),centerLeft:this._canvasControls.querySelector(""+prefix+"-center-left"),centerCenter:this._canvasControls.querySelector(""+prefix+"-center-center")},this._ui.canvas.render().then(function(){_this._showCropContainer(),_this._updateCropDOM()})},writable:!0,configurable:!0},_showCropContainer:{value:function(){var container=this._canvasControls.querySelector(".imglykit-canvas-crop-container");container.classList.remove("imglykit-canvas-crop-container-hidden")},writable:!0,configurable:!0},_onListItemClick:{value:function(item){var _this=this,degrees=item.dataset.degrees;degrees=parseInt(degrees);var currentDegrees=this._operation.getDegrees();this._operation.setDegrees(currentDegrees+degrees),this._ui.canvas.zoomToFit().then(function(){_this._updateCropDOM()})},writable:!0,configurable:!0},onZoom:{value:function(){this._updateCropDOM()},writable:!0,configurable:!0},_updateCropDOM:{value:function(){var start=void 0,end=void 0;this._cropOperation?(start=this._initialStart.clone(),end=this._initialEnd.clone()):(start=new Vector2(0,0),end=new Vector2(1,1));var canvasSize=this._ui.canvas.size,startAbsolute=start.multiply(canvasSize),endAbsolute=end.multiply(canvasSize),size=endAbsolute.clone().subtract(startAbsolute),top=Math.max(1,startAbsolute.y),left=Math.max(1,startAbsolute.x),width=Math.max(1,size.x),height=Math.max(1,size.y);this._cropAreas.topLeft.style.width=""+left+"px",this._cropAreas.topCenter.style.width=""+width+"px",this._cropAreas.topLeft.style.height=""+top+"px",this._cropAreas.centerLeft.style.height=""+height+"px"},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?this._operation.setDegrees(this._initialDegrees):this._ui.removeOperation("rotation"),this._cropOperation&&this._cropOperation.set({start:this._initialStart,end:this._initialEnd}),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._cropOperation&&this._cropOperation.set({start:this._initialStart,end:this._initialEnd}),this._ui.canvas.render(),this._ui.addHistory(this._operation,{degrees:this._initialDegrees},this._operationExistedBefore)},writable:!0,configurable:!0}}),RotationControl}(Control);module.exports=RotationControl},{"../../../lib/math/vector2":49,"./control":115}],122:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Slider=_interopRequire(require("../lib/slider")),Control=_interopRequire(require("./control")),SaturationControl=function(Control){function SaturationControl(){_classCallCheck(this,SaturationControl),null!=Control&&Control.apply(this,arguments)}return _inherits(SaturationControl,Control),_prototypeProperties(SaturationControl,null,{identifier:{get:function(){return"saturation"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)},writable:!0,configurable:!0},_onEnter:{value:function(){_get(Object.getPrototypeOf(SaturationControl.prototype),"_onEnter",this).call(this),this._operationExistedBefore=!!this._ui.operations.saturation,this._operation=this._ui.getOrCreateOperation("saturation");var saturation=this._operation.getSaturation();this._initialSaturation=saturation;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:0,maxValue:2,defaultValue:saturation}),this._slider.on("update",this._onUpdate.bind(this))},writable:!0,configurable:!0},_onBack:{value:function(){_get(Object.getPrototypeOf(SaturationControl.prototype),"_onBack",this).call(this),this._operationExistedBefore?this._operation.setSaturation(this._initialSaturation):this._ui.removeOperation("saturation"),this._ui.canvas.render()},writable:!0,configurable:!0},_onUpdate:{value:function(value){this._operation.setSaturation(value),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{saturation:this._initialSaturation},this._operationExistedBefore)},writable:!0,configurable:!0}}),SaturationControl}(Control);module.exports=SaturationControl},{"../lib/slider":129,"./control":115}],123:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),StickersControl=function(Control){function StickersControl(){_classCallCheck(this,StickersControl),null!=Control&&Control.apply(this,arguments)}return _inherits(StickersControl,Control),_prototypeProperties(StickersControl,null,{identifier:{get:function(){return"stickers"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-stickers">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.stickers) { }}\n        {{ var stickerPath = it.stickers[identifier]; }}\n        {{ var enabled = it.activeSticker === identifier; }}\n        <li data-identifier="{{= identifier}}"{{? enabled}} class="imglykit-controls-item-active"{{?}} style="background-image: url(\'{{=it.helpers.assetPath(stickerPath)}}\');">\n        </li>\n      {{ } }}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-stickers-container">\n  <div class="imglykit-canvas-stickers">\n    <img class="imglykit-canvas-sticker-image" />\n    <div class="imglykit-knob"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._availableStickers={},this._stickers={},this._addDefaultStickers(),this.selectStickers(null)},writable:!0,configurable:!0},_addDefaultStickers:{value:function(){this.addSticker("glasses-nerd","stickers/sticker-glasses-nerd.png"),this.addSticker("glasses-normal","stickers/sticker-glasses-normal.png"),this.addSticker("glasses-shutter-green","stickers/sticker-glasses-shutter-green.png"),this.addSticker("glasses-shutter-yellow","stickers/sticker-glasses-shutter-yellow.png"),this.addSticker("glasses-sun","stickers/sticker-glasses-sun.png"),this.addSticker("hat-cap","stickers/sticker-hat-cap.png"),this.addSticker("hat-cylinder","stickers/sticker-hat-cylinder.png"),this.addSticker("hat-party","stickers/sticker-hat-party.png"),this.addSticker("hat-sheriff","stickers/sticker-hat-sheriff.png"),this.addSticker("heart","stickers/sticker-heart.png"),this.addSticker("mustache-long","stickers/sticker-mustache-long.png"),this.addSticker("mustache1","stickers/sticker-mustache1.png"),this.addSticker("mustache2","stickers/sticker-mustache2.png"),this.addSticker("mustache3","stickers/sticker-mustache3.png"),this.addSticker("pipe","stickers/sticker-pipe.png"),this.addSticker("snowflake","stickers/sticker-snowflake.png"),this.addSticker("star","stickers/sticker-star.png")},writable:!0,configurable:!0},addSticker:{value:function(identifier,path){this._availableStickers[identifier]=path},writable:!0,configurable:!0},selectStickers:{value:function(selector){this._stickers={};for(var stickerIdentifiers=Object.keys(this._availableStickers),selectedStickers=Utils.select(stickerIdentifiers,selector),i=0;i<selectedStickers.length;i++){var identifier=selectedStickers[i];this._stickers[identifier]=this._availableStickers[identifier]}this._active&&this._renderControls()},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.stickers,this._operation=this._ui.getOrCreateOperation("stickers"),this._ui.removeOperation("stickers"),this._initialSettings={sticker:this._operation.getSticker(),position:this._operation.getPosition().clone(),size:this._operation.getSize().clone()};var canvasSize=this._ui.canvas.size;this._size=this._initialSettings.size.clone(),this._position=this._initialSettings.position.clone().multiply(canvasSize),this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(),this._container=this._canvasControls.querySelector(".imglykit-canvas-stickers"),this._stickerImage=this._canvasControls.querySelector("img"),this._stickerImage.addEventListener("load",function(){_this._stickerSize=new Vector2(_this._stickerImage.width,_this._stickerImage.height),_this._onStickerLoad()}),this._knob=this._canvasControls.querySelector("div.imglykit-knob"),this._onImageDown=this._onImageDown.bind(this),this._onImageDrag=this._onImageDrag.bind(this),this._onImageUp=this._onImageUp.bind(this),this._onKnobDown=this._onKnobDown.bind(this),this._onKnobDrag=this._onKnobDrag.bind(this),this._onKnobUp=this._onKnobUp.bind(this),this._handleListItems(),this._handleImage(),this._handleKnob()},writable:!0,configurable:!0},_handleListItems:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i],identifier=listItem.dataset.identifier;listItem.addEventListener("click",function(){_this._onListItemClick(listItem)}),(!_this._operationExistedBefore&&0===i||_this._operationExistedBefore&&_this._stickers[identifier]===_this._initialSettings.sticker)&&_this._onListItemClick(listItem)}(i)},writable:!0,configurable:!0},_applySettings:{value:function(){var ratio=this._stickerSize.y/this._stickerSize.x;this._size.y=this._size.x*ratio,this._stickerImage.style.width=""+this._size.x+"px",this._stickerImage.style.height=""+this._size.y+"px",this._container.style.left=""+this._position.x+"px",this._container.style.top=""+this._position.y+"px"},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?(this._operation=this._ui.getOrCreateOperation("stickers"),this._operation.set(this._initialSettings)):this._ui.removeOperation("stickers"),this._ui.canvas.setZoomLevel(this._initialZoomLevel)},writable:!0,configurable:!0},_onDone:{value:function(){var canvasSize=this._ui.canvas.size,position=this._position.clone().divide(canvasSize),size=this._size.clone().divide(canvasSize);this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operation=this._ui.getOrCreateOperation("stickers"),this._operation.set({sticker:this._availableStickers[this._sticker],position:position,size:size}),this._ui.canvas.render(),this._ui.addHistory(this,{sticker:this._initialSettings.sticker,position:this._initialSettings.position.clone(),size:this._initialSettings.size.clone()},this._operationExistedBefore)},writable:!0,configurable:!0},_handleKnob:{value:function(){this._knob.addEventListener("mousedown",this._onKnobDown),this._knob.addEventListener("touchstart",this._onKnobDown)},writable:!0,configurable:!0},_onKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialSize=this._size.clone(),document.addEventListener("mousemove",this._onKnobDrag),document.addEventListener("touchmove",this._onKnobDrag),document.addEventListener("mouseup",this._onKnobUp),document.addEventListener("touchend",this._onKnobUp)},writable:!0,configurable:!0},_onKnobDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),size=this._initialSize.clone(),ratio=this._stickerImage.height/this._stickerImage.width;size.x+=diff.x,size.y=size.x*ratio,this._size.copy(size),this._applySettings()},writable:!0,configurable:!0},_onKnobUp:{value:function(){document.removeEventListener("mousemove",this._onKnobDrag),document.removeEventListener("touchmove",this._onKnobDrag),document.removeEventListener("mouseup",this._onKnobUp),document.removeEventListener("touchend",this._onKnobUp)},writable:!0,configurable:!0},_handleImage:{value:function(){this._stickerImage.addEventListener("mousedown",this._onImageDown),this._stickerImage.addEventListener("touchstart",this._onImageDown)},writable:!0,configurable:!0},_onImageDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._position.clone(),document.addEventListener("mousemove",this._onImageDrag),document.addEventListener("touchmove",this._onImageDrag),document.addEventListener("mouseup",this._onImageUp),document.addEventListener("touchend",this._onImageUp)},writable:!0,configurable:!0},_onImageDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),position=this._initialPosition.clone();position.add(diff),this._position.copy(position),this._applySettings()},writable:!0,configurable:!0},_onImageUp:{value:function(){document.removeEventListener("mousemove",this._onImageDrag),document.removeEventListener("touchmove",this._onImageDrag),document.removeEventListener("mouseup",this._onImageUp),document.removeEventListener("touchend",this._onImageUp)},writable:!0,configurable:!0},_onStickerLoad:{value:function(){this._size=new Vector2(this._stickerImage.width,this._stickerImage.height),"undefined"==typeof this._position&&(this._position=new Vector2(0,0)),this._applySettings()},writable:!0,configurable:!0},_onListItemClick:{value:function(item){this._deactivateAllItems();var identifier=item.dataset.identifier,stickerPath=this._availableStickers[identifier];stickerPath=this._kit.getAssetPath(stickerPath);try{this._stickerImage.attributes.removeNamedItem("style")}catch(e){}this._sticker=identifier,this._stickerImage.src=stickerPath,item.classList.add("imglykit-controls-item-active")},writable:!0,configurable:!0},_deactivateAllItems:{value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._listItems[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var listItem=_step.value;listItem.classList.remove("imglykit-controls-item-active")}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}},writable:!0,configurable:!0},context:{get:function(){var context=_get(Object.getPrototypeOf(StickersControl.prototype),"context",this);return context.stickers=this._stickers,context},configurable:!0}}),StickersControl}(Control);module.exports=StickersControl},{"../../../lib/math/vector2":49,"../../../lib/utils":51,"./control":115}],124:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),ColorPicker=_interopRequire(require("../lib/color-picker")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),TextControl=function(Control){function TextControl(){_classCallCheck(this,TextControl),null!=Control&&Control.apply(this,arguments)}return _inherits(TextControl,Control),_prototypeProperties(TextControl,null,{identifier:{get:function(){return"text"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-text">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{~it.fonts :value:index}}\n        <li data-name="{{= value.name}}" data-weight="{{= value.weight}}" style="font-family: {{= value.name}}; font-weight: {{= value.weight}}">{{= value.name.substr(0, 2)}}</li>\n      {{~}}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerId = "imglykit-text-foreground-color-picker";}}\n    {{var colorpickerLabel = "Foreground";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerId = "imglykit-text-background-color-picker";}}\n    {{var colorpickerLabel = "Background";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-text-container">\n  <div class="imglykit-canvas-text">\n    <div class="imglykit-crosshair">\n      <img src="{{=it.helpers.assetPath(\'ui/night/crosshair.png\')}}" />\n    </div>\n    <div class="imglykit-canvas-text-textarea">\n      <textarea></textarea>\n      <div class="imglykit-knob"></div>\n    </div>\n  </div>\n</div>\n';
this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(ColorPicker.template),this._fonts=[],this._addFonts()},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.text,this._operation=this._ui.getOrCreateOperation("text"),this._ui.removeOperation("text");var canvasSize=this._ui.canvas.size;this._initialSettings={lineHeight:this._operation.getLineHeight(),fontSize:this._operation.getFontSize(),fontFamily:this._operation.getFontFamily(),fontWeight:this._operation.getFontWeight(),color:this._operation.getColor(),position:this._operation.getPosition(),text:this._operation.getText()||"",maxWidth:this._operation.getMaxWidth(),backgroundColor:this._operation.getBackgroundColor()},this._settings={lineHeight:this._initialSettings.lineHeight,fontSize:this._initialSettings.fontSize,fontFamily:this._initialSettings.fontFamily,fontWeight:this._initialSettings.fontWeight,color:this._initialSettings.color.clone(),position:this._initialSettings.position.clone().multiply(canvasSize),text:this._initialSettings.text,maxWidth:this._initialSettings.maxWidth*canvasSize.x,backgroundColor:this._initialSettings.backgroundColor.clone()},this._initialZoomLevel=this._ui.canvas.zoomLevel,this._container=this._canvasControls.querySelector(".imglykit-canvas-text"),this._textarea=this._canvasControls.querySelector("textarea"),this._textarea.focus(),this._moveKnob=this._canvasControls.querySelector(".imglykit-crosshair"),this._resizeKnob=this._canvasControls.querySelector(".imglykit-knob"),this._operationExistedBefore&&(this._settings.position.x-=2,this._settings.position.y-=2),this._onTextareaKeyUp=this._onTextareaKeyUp.bind(this),this._onResizeKnobDown=this._onResizeKnobDown.bind(this),this._onResizeKnobDrag=this._onResizeKnobDrag.bind(this),this._onResizeKnobUp=this._onResizeKnobUp.bind(this),this._onMoveKnobDown=this._onMoveKnobDown.bind(this),this._onMoveKnobDrag=this._onMoveKnobDrag.bind(this),this._onMoveKnobUp=this._onMoveKnobUp.bind(this),this._onForegroundColorUpdate=this._onForegroundColorUpdate.bind(this),this._onBackgroundColorUpdate=this._onBackgroundColorUpdate.bind(this),this._initColorPickers(),this._handleListItems(),this._handleTextarea(),this._handleResizeKnob(),this._handleMoveKnob(),setTimeout(function(){_this._resizeTextarea()},1),this._ui.canvas.zoomToFit().then(function(){_this._applySettings()})},writable:!0,configurable:!0},_initColorPickers:{value:function(){var _this=this,foregroundColorPicker=this._controls.querySelector("#imglykit-text-foreground-color-picker");this._foregroundColorPicker=new ColorPicker(this._ui,foregroundColorPicker),this._foregroundColorPicker.setValue(this._operation.getColor()),this._foregroundColorPicker.on("update",this._onForegroundColorUpdate),this._foregroundColorPicker.on("show",function(){_this._backgroundColorPicker.hide()});var backgroundColorPicker=this._controls.querySelector("#imglykit-text-background-color-picker");this._backgroundColorPicker=new ColorPicker(this._ui,backgroundColorPicker),this._backgroundColorPicker.setValue(this._operation.getBackgroundColor()),this._backgroundColorPicker.on("update",this._onBackgroundColorUpdate),this._backgroundColorPicker.on("show",function(){_this._foregroundColorPicker.hide()})},writable:!0,configurable:!0},_handleListItems:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)}),(!_this._operationExistedBefore&&0===i||_this._operationExistedBefore&&name===_this._initialSettings.fontFamily)&&_this._onListItemClick(listItem)}(i)},writable:!0,configurable:!0},_handleTextarea:{value:function(){this._textarea.addEventListener("keyup",this._onTextareaKeyUp)},writable:!0,configurable:!0},_onTextareaKeyUp:{value:function(){this._resizeTextarea(),this._settings.text=this._textarea.value},writable:!0,configurable:!0},_resizeTextarea:{value:function(){var scrollTop=this._textarea.scrollTop;if(!scrollTop){var _scrollHeight=void 0,height=void 0;do _scrollHeight=this._textarea.scrollHeight,height=this._textarea.offsetHeight,this._textarea.style.height=""+(height-5)+"px";while(_scrollHeight&&_scrollHeight!=this._textarea.scrollHeight)}var scrollHeight=this._textarea.scrollHeight;this._textarea.style.height=""+(scrollHeight+20)+"px"},writable:!0,configurable:!0},_handleMoveKnob:{value:function(){this._moveKnob.addEventListener("mousedown",this._onMoveKnobDown),this._moveKnob.addEventListener("touchstart",this._onMoveKnobDown)},writable:!0,configurable:!0},_onMoveKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._settings.position.clone(),document.addEventListener("mousemove",this._onMoveKnobDrag),document.addEventListener("touchmove",this._onMoveKnobDrag),document.addEventListener("mouseup",this._onMoveKnobUp),document.addEventListener("tochend",this._onMoveKnobUp)},writable:!0,configurable:!0},_onMoveKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),minPosition=new Vector2(0,0),containerSize=new Vector2(this._container.offsetWidth,this._container.offsetHeight),maxPosition=canvasSize.clone().subtract(containerSize),position=this._initialPosition.clone().add(diff).clamp(minPosition,maxPosition);this._settings.position=position,this._container.style.left=""+position.x+"px",this._container.style.top=""+position.y+"px"},writable:!0,configurable:!0},_onMoveKnobUp:{value:function(){document.removeEventListener("mousemove",this._onMoveKnobDrag),document.removeEventListener("touchmove",this._onMoveKnobDrag),document.removeEventListener("mouseup",this._onMoveKnobUp),document.removeEventListener("touchend",this._onMoveKnobUp)},writable:!0,configurable:!0},_handleResizeKnob:{value:function(){this._resizeKnob.addEventListener("mousedown",this._onResizeKnobDown),this._resizeKnob.addEventListener("touchstart",this._onResizeKnobDown)},writable:!0,configurable:!0},_onResizeKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialMaxWidth=this._settings.maxWidth,document.addEventListener("mousemove",this._onResizeKnobDrag),document.addEventListener("touchmove",this._onResizeKnobDrag),document.addEventListener("mouseup",this._onResizeKnobUp),document.addEventListener("touchend",this._onResizeKnobUp)},writable:!0,configurable:!0},_onResizeKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),position=this._settings.position.clone(),maxWidthAllowed=canvasSize.x-position.x,maxWidth=this._initialMaxWidth+diff.x;maxWidth=Math.max(100,Math.min(maxWidthAllowed,maxWidth)),this._settings.maxWidth=maxWidth,this._textarea.style.width=""+maxWidth+"px",this._resizeTextarea()},writable:!0,configurable:!0},_onResizeKnobUp:{value:function(){document.removeEventListener("mousemove",this._onResizeKnobDrag),document.removeEventListener("touchmove",this._onResizeKnobDrag),document.removeEventListener("mouseup",this._onResizeKnobUp),document.removeEventListener("touchend",this._onResizeKnobUp)},writable:!0,configurable:!0},_onForegroundColorUpdate:{value:function(value){this._settings.color=value,this._applySettings()},writable:!0,configurable:!0},_onBackgroundColorUpdate:{value:function(value){this._settings.backgroundColor=value,this._applySettings()},writable:!0,configurable:!0},_applySettings:{value:function(){var textarea=this._textarea,settings=this._settings,canvasSize=this._ui.canvas.size,actualFontSize=settings.fontSize*canvasSize.y;this._container.style.left=""+settings.position.x+"px",this._container.style.top=""+settings.position.y+"px",textarea.value=settings.text,textarea.style.fontFamily=settings.fontFamily,textarea.style.fontSize=""+actualFontSize+"px",textarea.style.fontWeight=settings.fontWeight,textarea.style.lineHeight=settings.lineHeight,textarea.style.color=settings.color.toRGBA(),textarea.style.backgroundColor=settings.backgroundColor.toRGBA(),textarea.style.width=""+settings.maxWidth+"px"},writable:!0,configurable:!0},_onListItemClick:{value:function(item){this._deactivateAllItems();var _item$dataset=item.dataset,name=_item$dataset.name,weight=_item$dataset.weight;this._settings.fontFamily=name,this._settings.fontWeight=weight,this._applySettings(),item.classList.add("imglykit-controls-item-active")},writable:!0,configurable:!0},_deactivateAllItems:{value:function(){for(var i=0;i<this._listItems.length;i++){var listItem=this._listItems[i];listItem.classList.remove("imglykit-controls-item-active")}},writable:!0,configurable:!0},_addFonts:{value:function(){this.addFont("Helvetica","normal"),this.addFont("Lucida Grande","normal"),this.addFont("Times New Roman","normal")},writable:!0,configurable:!0},addFont:{value:function(name,weight){this._fonts.push({name:name,weight:weight})},writable:!0,configurable:!0},_onDone:{value:function(){var canvasSize=this._ui.canvas.size,padding=new Vector2(2,2),position=this._settings.position.clone().add(padding).divide(canvasSize);this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operation=this._ui.getOrCreateOperation("text"),this._operation.set({fontSize:this._settings.fontSize,fontFamily:this._settings.fontFamily,fontWeight:this._settings.fontWeight,color:this._settings.color,backgroundColor:this._settings.backgroundColor,position:position,text:this._settings.text,maxWidth:this._settings.maxWidth/canvasSize.x}),this._ui.canvas.render(),this._ui.addHistory(this,{fontFamily:this._initialSettings.fontFamily,fontWeight:this._initialSettings.fontWeight,color:this._initialSettings.color.clone(),backgroundColor:this._initialSettings.backgroundColor.clone(),position:this._initialSettings.position.clone(),text:this._initialSettings.text,maxWidth:this._initialSettings.maxWidth},this._operationExistedBefore)},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?(this._operation=this._ui.getOrCreateOperation("text"),this._operation.set(this._initialSettings)):this._ui.removeOperation("text"),this._ui.canvas.setZoomLevel(this._initialZoomLevel)},writable:!0,configurable:!0},context:{get:function(){var context=_get(Object.getPrototypeOf(TextControl.prototype),"context",this);return context.fonts=this._fonts,context},configurable:!0}}),TextControl}(Control);module.exports=TextControl},{"../../../lib/math/vector2":49,"../../../lib/utils":51,"../lib/color-picker":127,"./control":115}],125:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),TiltShiftControl=function(Control){function TiltShiftControl(){_classCallCheck(this,TiltShiftControl),null!=Control&&Control.apply(this,arguments)}return _inherits(TiltShiftControl,Control),_prototypeProperties(TiltShiftControl,null,{identifier:{get:function(){return"tilt-shift"},configurable:!0},init:{value:function(){var controlsTemplate='<div class="imglykit-controls-tilt-shift">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div class="imglykit-controls-icon">\n    <img src="{{=it.helpers.assetPath(\'ui/night/blur/blur.png\')}}" />\n  </div>\n\n  <div>\n    {{var sliderId = "imglykit-blur-radius-slider";}}\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-tilt-shift-container">\n  <div class="imglykit-canvas-tilt-shift-dot" data-option="position"></div>\n  <div class="imglykit-canvas-tilt-shift-dot" data-option="gradient"></div>\n  <div class="imglykit-canvas-tilt-shift-rect-container">\n    <div class="imglykit-canvas-tilt-shift-rect"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(SimpleSlider.template),this._currentKnob=null},writable:!0,configurable:!0},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations["tilt-shift"],this._operation=this._ui.getOrCreateOperation("tilt-shift"),this._initialSettings={start:this._operation.getStart().clone(),end:this._operation.getEnd().clone(),gradientRadius:this._operation.getGradientRadius(),blurRadius:this._operation.getBlurRadius()},this._onPositionKnobDown=this._onPositionKnobDown.bind(this),this._onPositionKnobDrag=this._onPositionKnobDrag.bind(this),this._onPositionKnobUp=this._onPositionKnobUp.bind(this),this._onGradientKnobDown=this._onGradientKnobDown.bind(this),this._onGradientKnobDrag=this._onGradientKnobDrag.bind(this),this._onGradientKnobUp=this._onGradientKnobUp.bind(this);var selector=".imglykit-canvas-tilt-shift-dot";this._positionKnob=this._canvasControls.querySelector(""+selector+'[data-option="position"]'),this._gradientKnob=this._canvasControls.querySelector(""+selector+'[data-option="gradient"]'),this._rect=this._canvasControls.querySelector(".imglykit-canvas-tilt-shift-rect"),this._initSliders(),this._ui.canvas.render().then(function(){_this._handleKnobs(),_this._updateDOM()})},writable:!0,configurable:!0},_initSliders:{value:function(){var blurRadiusSlider=this._controls.querySelector("#imglykit-blur-radius-slider");this._blurRadiusSlider=new SimpleSlider(blurRadiusSlider,{minValue:0,maxValue:40}),this._blurRadiusSlider.on("update",this._onBlurRadiusUpdate.bind(this)),this._blurRadiusSlider.setValue(this._initialSettings.blurRadius)},writable:!0,configurable:!0},_onBlurRadiusUpdate:{value:function(value){this._operation.setBlurRadius(value),this._ui.canvas.render()},writable:!0,configurable:!0},_handleKnobs:{value:function(){this._positionKnob.addEventListener("mousedown",this._onPositionKnobDown),this._positionKnob.addEventListener("touchstart",this._onPositionKnobDown),this._gradientKnob.addEventListener("mousedown",this._onGradientKnobDown),this._gradientKnob.addEventListener("touchstart",this._onGradientKnobDown);var canvasSize=this._ui.canvas.size,_initialSettings=this._initialSettings,start=_initialSettings.start,end=_initialSettings.end;start=start.clone().multiply(canvasSize),end=end.clone().multiply(canvasSize);var dist=end.clone().subtract(start),middle=start.clone().add(dist.clone().divide(2)),totalDist=Math.sqrt(Math.pow(dist.x,2)+Math.pow(dist.y,2)),factor=dist.clone().divide(totalDist).divide(2);this._knobPosition=middle.clone();var gradientRadius=this._initialSettings.gradientRadius;this._gradientKnobPosition=middle.clone().add(-gradientRadius*factor.y,gradientRadius*factor.x),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()},writable:!0,configurable:!0},_updateStartAndEnd:{value:function(){var canvasSize=this._ui.canvas.size,diff=this._gradientKnobPosition.clone().subtract(this._knobPosition),start=this._knobPosition.clone().add(-diff.y,diff.x).divide(canvasSize),end=this._knobPosition.clone().add(diff.y,-diff.x).divide(canvasSize);this._operation.set({start:start,end:end})},writable:!0,configurable:!0},_onPositionKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._knobPosition.clone(),this._initialDistanceToGradientKnob=this._gradientKnobPosition.clone().subtract(this._initialPosition),document.addEventListener("mousemove",this._onPositionKnobDrag),document.addEventListener("touchmove",this._onPositionKnobDrag),document.addEventListener("mouseup",this._onPositionKnobUp),document.addEventListener("touchend",this._onPositionKnobUp)},writable:!0,configurable:!0},_onPositionKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),newPosition=this._initialPosition.clone().add(diff);this._knobPosition.copy(newPosition);var minPosition=(new Vector2).subtract(this._initialDistanceToGradientKnob);minPosition.clamp(new Vector2(0,0));var maxPosition=canvasSize.clone().subtract(this._initialDistanceToGradientKnob);maxPosition.clamp(null,canvasSize),this._knobPosition.clamp(minPosition,maxPosition),this._gradientKnobPosition.copy(this._knobPosition).add(this._initialDistanceToGradientKnob),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()},writable:!0,configurable:!0},_onPositionKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onPositionKnobDrag),document.removeEventListener("touchmove",this._onPositionKnobDrag),document.removeEventListener("mouseup",this._onPositionKnobUp),document.removeEventListener("touchend",this._onPositionKnobUp)},writable:!0,configurable:!0},_onGradientKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialGradientKnobPosition=this._gradientKnobPosition.clone(),document.addEventListener("mousemove",this._onGradientKnobDrag),document.addEventListener("touchmove",this._onGradientKnobDrag),document.addEventListener("mouseup",this._onGradientKnobUp),document.addEventListener("touchend",this._onGradientKnobUp)},writable:!0,configurable:!0},_onGradientKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition);this._gradientKnobPosition.copy(this._initialGradientKnobPosition).add(diff),this._gradientKnobPosition.clamp(new Vector2(0,0),canvasSize);var distance=this._gradientKnobPosition.clone().subtract(this._knobPosition),newGradientRadius=2*Math.sqrt(Math.pow(distance.x,2)+Math.pow(distance.y,2));this._operation.setGradientRadius(newGradientRadius),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()},writable:!0,configurable:!0},_onGradientKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onGradientKnobDrag),document.removeEventListener("touchmove",this._onGradientKnobDrag),document.removeEventListener("mouseup",this._onGradientKnobUp),document.removeEventListener("touchend",this._onGradientKnobUp)},writable:!0,configurable:!0},_updateDOM:{value:function(){var position=this._knobPosition;this._positionKnob.style.left=""+position.x+"px",this._positionKnob.style.top=""+position.y+"px";var gradientPosition=this._gradientKnobPosition;this._gradientKnob.style.left=""+gradientPosition.x+"px",this._gradientKnob.style.top=""+gradientPosition.y+"px";var canvasSize=this._ui.canvas.size,gradientRadius=this._operation.getGradientRadius(),rectSize=new Vector2(2*Math.sqrt(Math.pow(canvasSize.x,2)+Math.pow(canvasSize.y,2)),gradientRadius);this._rect.style.width=""+rectSize.x+"px",this._rect.style.height=""+rectSize.y+"px",this._rect.style.marginLeft="-"+rectSize.x/2+"px",this._rect.style.marginTop="-"+rectSize.y/2+"px",this._rect.style.left=""+position.x+"px",this._rect.style.top=""+position.y+"px";var dist=gradientPosition.clone().subtract(position),degrees=Math.atan2(dist.x,dist.y)*(180/Math.PI);this._rect.style.transform="rotate("+(-degrees).toFixed(2)+"deg)"},writable:!0,configurable:!0},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialSettings):this._ui.removeOperation("tilt-shift"),this._ui.canvas.render()},writable:!0,configurable:!0},_onDone:{value:function(){this._ui.addHistory(this._operation,{start:this._initialSettings.start.clone(),end:this._initialSettings.end.clone(),blurRadius:this._initialSettings.blurRadius,gradientRadius:this._initialSettings.gradientRadius},this._operationExistedBefore)},writable:!0,configurable:!0}}),TiltShiftControl}(Control);module.exports=TiltShiftControl},{"../../../lib/math/vector2":49,"../../../lib/utils":51,"../lib/simple-slider":128,"./control":115}],126:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},bluebird=_interopRequire(require("bluebird")),WebGLRenderer=_interopRequire(require("../../../renderers/webgl-renderer")),CanvasRenderer=_interopRequire(require("../../../renderers/canvas-renderer")),Vector2=_interopRequire(require("../../../lib/math/vector2")),EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Canvas=function(EventEmitter){function Canvas(kit,ui,options){_classCallCheck(this,Canvas),_get(Object.getPrototypeOf(Canvas.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._options=options;var container=this._ui.container;this._canvasContainer=container.querySelector(".imglykit-canvas-container"),this._canvasInnerContainer=container.querySelector(".imglykit-canvas-inner-container"),this._canvas=this._canvasContainer.querySelector("canvas"),this._image=this._options.image,this._roundZoomBy=.1,this._isFirstRender=!0,this._dragOnMousedown=this._dragOnMousedown.bind(this),this._dragOnMousemove=this._dragOnMousemove.bind(this),this._dragOnMouseup=this._dragOnMouseup.bind(this)}return _inherits(Canvas,EventEmitter),_prototypeProperties(Canvas,null,{run:{value:function(){this._initRenderer(),this._zoomLevel=this._getInitialZoomLevel(),this._initialZoomLevel=this._zoomLevel,this._isInitialZoom=!0,this._size=null,this.render(),this._centerCanvas(),this._handleDrag()},writable:!0,configurable:!0},render:{value:function(){var _this=this;this._initialZoomLevel=this._getInitialZoomLevel(),this._isInitialZoom&&this.setZoomLevel(this._initialZoomLevel,!1);var imageSize=new Vector2(this._image.width,this._image.height),initialSize=imageSize.multiply(this._zoomLevel);this._setCanvasSize(initialSize),this._renderer.reset(),(this._isFirstRender||"canvas"===this._renderer.constructor.identifier)&&(this._renderer.drawImage(this._image),this._isFirstRender=!1);var stack=this.sanitizedStack;return this._updateStackDirtyStates(stack),bluebird.map(stack,function(operation){return operation.validateSettings()}).then(function(){return bluebird.map(stack,function(operation){return operation.render(_this._renderer)},{concurrency:1})}).then(function(){return _this._renderer.renderFinal()}).then(function(){_this._storeCanvasSize(),_this._updateContainerSize(),_this._updateCanvasMargins(),_this._applyBoundaries()})},writable:!0,configurable:!0},zoomIn:{value:function(){this._isInitialZoom=!1;var zoomLevel=Math.round(100*this._zoomLevel),roundZoomBy=Math.round(100*this._roundZoomBy),initialZoomLevel=Math.round(100*this._initialZoomLevel);return zoomLevel%roundZoomBy!==0?zoomLevel=Math.ceil(zoomLevel/roundZoomBy)*roundZoomBy:zoomLevel+=roundZoomBy,zoomLevel=Math.min(2*initialZoomLevel,zoomLevel),this.setZoomLevel(zoomLevel/100)},writable:!0,configurable:!0},zoomOut:{value:function(){this._isInitialZoom=!1;var zoomLevel=Math.round(100*this._zoomLevel),roundZoomBy=Math.round(100*this._roundZoomBy),initialZoomLevel=Math.round(100*this._initialZoomLevel);return zoomLevel%roundZoomBy!==0?zoomLevel=Math.floor(zoomLevel/roundZoomBy)*roundZoomBy:zoomLevel-=roundZoomBy,zoomLevel=Math.max(initialZoomLevel,zoomLevel),this.setZoomLevel(zoomLevel/100)},writable:!0,configurable:!0},_setCanvasSize:{value:function(size){size=size||new Vector2(this._canvas.width,this._canvas.height),this._canvas.width=size.x,this._canvas.height=size.y,this._storeCanvasSize(),this._updateContainerSize()},writable:!0,configurable:!0},_updateContainerSize:{value:function(){var size=this._size;this._canvasInnerContainer.style.width=""+size.x+"px",this._canvasInnerContainer.style.height=""+size.y+"px"},writable:!0,configurable:!0},_storeCanvasSize:{value:function(){this._size=new Vector2(this._canvas.width,this._canvas.height)},writable:!0,configurable:!0},_centerCanvas:{value:function(){var position=this._maxSize.divide(2);this._canvasInnerContainer.style.left=""+position.x+"px",this._canvasInnerContainer.style.top=""+position.y+"px",this._updateCanvasMargins()},writable:!0,configurable:!0},_updateCanvasMargins:{value:function(){var canvasSize=new Vector2(this._canvas.width,this._canvas.height),margin=canvasSize.divide(2).multiply(-1);this._canvasInnerContainer.style.marginLeft=""+margin.x+"px",this._canvasInnerContainer.style.marginTop=""+margin.y+"px"},writable:!0,configurable:!0},setZoomLevel:{value:function(zoomLevel){var _this=this,render=void 0===arguments[1]?!0:arguments[1];return this._zoomLevel=zoomLevel,render?(this.setAllOperationsToDirty(),this.render().then(function(){_this._updateCanvasMargins(),_this._applyBoundaries(),_this.emit("zoom")})):(this._updateCanvasMargins(),this._applyBoundaries(),this.emit("zoom"),void 0)},writable:!0,configurable:!0},setAllOperationsToDirty:{value:function(){for(var operationsStack=this._kit.operationsStack,i=0;i<operationsStack.length;i++){var operation=operationsStack[i];operation&&(operation.dirty=!0)}},writable:!0,configurable:!0},_getInitialZoomLevel:{value:function(){var inputSize=new Vector2(this._image.width,this._image.height),cropOperation=this._ui.operations.crop,rotationOperation=this._ui.operations.rotation,cropSize=void 0,croppedSize=void 0,finalSize=void 0,initialSize=void 0;if(cropSize=cropOperation?cropOperation.getEnd().clone().subtract(cropOperation.getStart()):new Vector2(1,1),croppedSize=inputSize.clone().multiply(cropSize),rotationOperation&&rotationOperation.getDegrees()%180!==0){var tempX=croppedSize.x;croppedSize.x=croppedSize.y,croppedSize.y=tempX}if(finalSize=this._resizeVectorToFit(croppedSize),rotationOperation&&rotationOperation.getDegrees()%180!==0){var tempX=finalSize.x;finalSize.x=finalSize.y,finalSize.y=tempX}return initialSize=finalSize.clone().divide(cropSize),initialSize.x/inputSize.x},writable:!0,configurable:!0},_resizeVectorToFit:{value:function(size){var maxSize=this._maxSize,scale=Math.min(maxSize.x/size.x,maxSize.y/size.y),newSize=size.clone().multiply(scale);return newSize},writable:!0,configurable:!0},_initRenderer:{value:function(){var _this=this;if(WebGLRenderer.isSupported()&&"canvas"!==this._options.renderer?(this._renderer=new WebGLRenderer(null,this._canvas),this._webglEnabled=!0):CanvasRenderer.isSupported()&&(this._renderer=new CanvasRenderer(null,this._canvas),this._webglEnabled=!1),null===this._renderer)throw new Error("Neither Canvas nor WebGL renderer are supported.");this._renderer.on("new-canvas",function(canvas){_this._setCanvas(canvas)})},writable:!0,configurable:!0},_setCanvas:{value:function(canvas){var canvasParent=this._canvas.parentNode;canvasParent.removeChild(this._canvas),this._canvas=canvas,canvasParent.appendChild(this._canvas),this._updateCanvasMargins(),this._applyBoundaries(),this._updateContainerSize()},writable:!0,configurable:!0},_handleDrag:{value:function(){this._canvas.addEventListener("mousedown",this._dragOnMousedown),this._canvas.addEventListener("touchstart",this._dragOnMousedown)},writable:!0,configurable:!0},_dragOnMousedown:{value:function(e){if("mousedown"!==e.type||0===e.button){e.preventDefault();var x=e.pageX,y=e.pageY;"touchstart"===e.type&&(x=e.touches[0].pageX,y=e.touches[0].pageY);var canvasX=parseInt(this._canvasInnerContainer.style.left),canvasY=parseInt(this._canvasInnerContainer.style.top);document.addEventListener("mousemove",this._dragOnMousemove),document.addEventListener("touchmove",this._dragOnMousemove),document.addEventListener("mouseup",this._dragOnMouseup),document.addEventListener("touchend",this._dragOnMouseup),this._initialMousePosition=new Vector2(x,y),this._initialCanvasPosition=new Vector2(canvasX,canvasY)}},writable:!0,configurable:!0},_dragOnMousemove:{value:function(e){e.preventDefault();var x=e.pageX,y=e.pageY;"touchmove"===e.type&&(x=e.touches[0].pageX,y=e.touches[0].pageY);var newMousePosition=new Vector2(x,y),mouseDiff=newMousePosition.clone().subtract(this._initialMousePosition),newPosition=this._initialCanvasPosition.clone().add(mouseDiff);this._canvasInnerContainer.style.left=""+newPosition.x+"px",this._canvasInnerContainer.style.top=""+newPosition.y+"px",this._applyBoundaries()},writable:!0,configurable:!0},_applyBoundaries:{value:function(){var x=parseInt(this._canvasInnerContainer.style.left),y=parseInt(this._canvasInnerContainer.style.top),canvasPosition=new Vector2(x,y),boundaries=this._boundaries;canvasPosition.x=Math.min(boundaries.max.x,Math.max(boundaries.min.x,canvasPosition.x)),canvasPosition.y=Math.min(boundaries.max.y,Math.max(boundaries.min.y,canvasPosition.y)),this._canvasInnerContainer.style.left=""+canvasPosition.x+"px",this._canvasInnerContainer.style.top=""+canvasPosition.y+"px"},writable:!0,configurable:!0},_dragOnMouseup:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._dragOnMousemove),document.removeEventListener("touchmove",this._dragOnMousemove),document.removeEventListener("mouseup",this._dragOnMouseup),document.removeEventListener("touchend",this._dragOnMouseup)},writable:!0,configurable:!0},_boundaries:{get:function(){var canvasSize=new Vector2(this._canvas.width,this._canvas.height),maxSize=this._maxSize,diff=canvasSize.clone().subtract(maxSize).multiply(-1),boundaries={min:new Vector2(diff.x,diff.y),max:new Vector2(0,0)};canvasSize.x<maxSize.x&&(boundaries.min.x=diff.x/2,boundaries.max.x=diff.x/2),canvasSize.y<maxSize.y&&(boundaries.min.y=diff.y/2,boundaries.max.y=diff.y/2);var halfCanvasSize=canvasSize.clone().divide(2);return boundaries.min.add(halfCanvasSize),boundaries.max.add(halfCanvasSize),boundaries},configurable:!0},_maxSize:{get:function(){var computedStyle=getComputedStyle(this._canvasContainer),size=new Vector2(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),paddingX=parseInt(computedStyle.getPropertyValue("padding-left"));paddingX+=parseInt(computedStyle.getPropertyValue("padding-right"));
var paddingY=parseInt(computedStyle.getPropertyValue("padding-top"));paddingY+=parseInt(computedStyle.getPropertyValue("padding-bottom")),size.x-=paddingX,size.y-=paddingY;var controlsHeight=this._ui._controlsContainer.offsetHeight;return size.y-=controlsHeight,size},configurable:!0},_updateStackDirtyStates:{value:function(stack){for(var dirtyFound=!1,i=0;i<stack.length;i++){var operation=stack[i];operation&&(operation.dirty&&(dirtyFound=!0),dirtyFound&&(operation.dirty=!0))}},writable:!0,configurable:!0},zoomToFit:{value:function(){var render=void 0===arguments[0]?!0:arguments[0],initialZoomLevel=this._getInitialZoomLevel();return this.setZoomLevel(initialZoomLevel,render)},writable:!0,configurable:!0},sanitizedStack:{get:function(){var sanitizedStack=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._kit.operationsStack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&sanitizedStack.push(operation)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return sanitizedStack},configurable:!0},zoomLevel:{get:function(){return this._zoomLevel},configurable:!0},size:{get:function(){return this._size},configurable:!0}}),Canvas}(EventEmitter);module.exports=Canvas},{"../../../lib/event-emitter":45,"../../../lib/math/vector2":49,"../../../renderers/canvas-renderer":108,"../../../renderers/webgl-renderer":110,bluebird:4}],127:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr)){for(var _step,_arr=[],_iterator=arr[Symbol.iterator]();!(_step=_iterator.next()).done&&(_arr.push(_step.value),!i||_arr.length!==i););return _arr}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Utils=_interopRequire(require("../../../lib/utils")),Color=_interopRequire(require("../../../lib/color")),Vector2=_interopRequire(require("../../../lib/math/vector2")),ColorPicker=(_interopRequire(require("lodash")),function(EventEmitter){function ColorPicker(ui,element){_classCallCheck(this,ColorPicker),_get(Object.getPrototypeOf(ColorPicker.prototype),"constructor",this).call(this),this._ui=ui,this._element=element,this._visible=!1,this._loaded=!1,this._overlay=this._element.querySelector(".imglykit-color-picker-overlay"),this._currentColorCanvas=this._element.querySelector(".imglykit-color-picker-color"),this._alphaCanvas=this._element.querySelector("canvas.imglykit-color-picker-alpha"),this._alphaKnob=this._element.querySelector(".imglykit-color-picker-alpha-container .imglykit-transparent-knob"),this._hueCanvas=this._element.querySelector("canvas.imglykit-color-picker-hue"),this._hueKnob=this._element.querySelector(".imglykit-color-picker-hue-container .imglykit-transparent-knob"),this._saturationCanvas=this._element.querySelector("canvas.imglykit-color-picker-saturation"),this._saturationKnob=this._element.querySelector(".imglykit-color-picker-saturation-container .imglykit-transparent-knob"),this._transparencyImage=new Image,this._transparencyImage.src=ui.helpers.assetPath("ui/night/transparency.png"),this._transparencyImage.addEventListener("load",this._onTransparencyImageLoad.bind(this)),this._onAlphaCanvasDown=this._onAlphaCanvasDown.bind(this),this._onAlphaCanvasDrag=this._onAlphaCanvasDrag.bind(this),this._onAlphaCanvasUp=this._onAlphaCanvasUp.bind(this),this._onHueCanvasDown=this._onHueCanvasDown.bind(this),this._onHueCanvasDrag=this._onHueCanvasDrag.bind(this),this._onHueCanvasUp=this._onHueCanvasUp.bind(this),this._onSaturationCanvasDown=this._onSaturationCanvasDown.bind(this),this._onSaturationCanvasDrag=this._onSaturationCanvasDrag.bind(this),this._onSaturationCanvasUp=this._onSaturationCanvasUp.bind(this),this._onElementClick=this._onElementClick.bind(this),this._handleToggle(),this._handleAlphaKnob(),this._handleHueKnob(),this._handleSaturationKnob()}return _inherits(ColorPicker,EventEmitter),_prototypeProperties(ColorPicker,{template:{get:function(){return'{{##def.colorpicker:\n  <div class="imglykit-color-picker" id="{{=(typeof colorpickerId === "undefined"?\'\':colorpickerId)}}">\n    <canvas class="imglykit-color-picker-color" width="34" height="34"></canvas>\n    <div class="imglykit-controls-item-label">{{=(typeof colorpickerLabel === "undefined"?\'\':colorpickerLabel)}}</div>\n\n    <div class="imglykit-color-picker-overlay">\n      <div class="imglykit-color-picker-alpha-container">\n        <canvas class="imglykit-color-picker-alpha" width="200" height="30"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n\n      <div class="imglykit-color-picker-saturation-container">\n        <canvas class="imglykit-color-picker-saturation" width="160" height="160"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n\n      <div class="imglykit-color-picker-hue-container">\n        <canvas class="imglykit-color-picker-hue" width="30" height="160"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n    </div>\n  </div>\n#}}\n'},configurable:!0}},{_onTransparencyImageLoad:{value:function(){this._loaded=!0,this._render()},writable:!0,configurable:!0},_handleToggle:{value:function(){this._element.addEventListener("click",this._onElementClick)},writable:!0,configurable:!0},_onElementClick:{value:function(e){(e.target===this._element||e.target===this._currentColorCanvas)&&(this._visible?(this.hide(),this.emit("hide")):(this.show(),this.emit("show")))},writable:!0,configurable:!0},hide:{value:function(){this._overlay.classList.remove("imglykit-visible"),this._visible=!1},writable:!0,configurable:!0},show:{value:function(){this._overlay.classList.add("imglykit-visible"),this._visible=!0},writable:!0,configurable:!0},setValue:{value:function(value){this._value=value.clone();var _value$toHSV=this._value.toHSV(),_value$toHSV2=_slicedToArray(_value$toHSV,3),h=_value$toHSV2[0],s=_value$toHSV2[1],v=_value$toHSV2[2];this._hsvColor={h:h,s:s,v:v},this._positionKnobs(),this._render()},writable:!0,configurable:!0},_positionKnobs:{value:function(){this._positionAlphaKnob(),this._positionHueKnob(),this._positionSaturationKnob()},writable:!0,configurable:!0},_positionAlphaKnob:{value:function(){var canvas=this._alphaCanvas,canvasSize=new Vector2(canvas.width,canvas.height),left=this._value.a*canvasSize.x;this._alphaKnob.style.left=""+left+"px"},writable:!0,configurable:!0},_positionHueKnob:{value:function(){var canvas=this._hueCanvas,canvasSize=new Vector2(canvas.width,canvas.height),top=this._hsvColor.h*canvasSize.y;this._hueKnob.style.top=""+top+"px"},writable:!0,configurable:!0},_positionSaturationKnob:{value:function(){var canvas=this._saturationCanvas,canvasSize=new Vector2(canvas.width,canvas.height),left=this._hsvColor.s*canvasSize.x;this._saturationKnob.style.left=""+left+"px";var top=(1-this._hsvColor.v)*canvasSize.y;this._saturationKnob.style.top=""+top+"px"},writable:!0,configurable:!0},_render:{value:function(){this._loaded&&(this._renderCurrentColor(),this._renderAlpha(),this._renderHue(),this._renderSaturation())},writable:!0,configurable:!0},_renderCurrentColor:{value:function(){var canvas=this._currentColorCanvas,context=canvas.getContext("2d"),pattern=context.createPattern(this._transparencyImage,"repeat");context.rect(0,0,canvas.width,canvas.height),context.fillStyle=pattern,context.fill(),context.fillStyle=this._value.toRGBA(),context.fill()},writable:!0,configurable:!0},_renderAlpha:{value:function(){var canvas=this._alphaCanvas,context=canvas.getContext("2d"),pattern=context.createPattern(this._transparencyImage,"repeat");context.rect(0,0,canvas.width,canvas.height),context.fillStyle=pattern,context.fill();var gradient=context.createLinearGradient(0,0,canvas.width,canvas.height),color=this._value.clone();color.a=0,gradient.addColorStop(0,color.toRGBA()),gradient.addColorStop(1,this._value.toHex()),context.fillStyle=gradient,context.fill()},writable:!0,configurable:!0},_renderHue:{value:function(){for(var canvas=this._hueCanvas,context=canvas.getContext("2d"),color=new Color,y=0;y<canvas.height;y++){var ratio=y/canvas.height;color.fromHSV(ratio,1,1),context.strokeStyle=color.toRGBA(),context.beginPath(),context.moveTo(0,y),context.lineTo(canvas.width,y),context.stroke()}},writable:!0,configurable:!0},_renderSaturation:{value:function(){for(var canvas=this._saturationCanvas,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,canvas.width,canvas.height),color=new Color(1,0,0,1),y=0;y<canvas.height;y++)for(var value=(canvas.height-y)/canvas.height,x=0;x<canvas.width;x++){var saturation=x/canvas.width;color.fromHSV(this._hsvColor.h,saturation,value);var r=color.r,g=color.g,b=color.b,a=color.a,index=4*(y*canvas.width+x);imageData.data[index]=255*r,imageData.data[index+1]=255*g,imageData.data[index+2]=255*b,imageData.data[index+3]=255*a}context.putImageData(imageData,0,0)},writable:!0,configurable:!0},_handleAlphaKnob:{value:function(){this._alphaCanvas.addEventListener("mousedown",this._onAlphaCanvasDown),this._alphaCanvas.addEventListener("touchstart",this._onAlphaCanvasDown)},writable:!0,configurable:!0},_onAlphaCanvasDown:{value:function(e){e.preventDefault(),this._onAlphaCanvasDrag(e),document.addEventListener("mousemove",this._onAlphaCanvasDrag),document.addEventListener("touchmove",this._onAlphaCanvasDrag),document.addEventListener("mouseup",this._onAlphaCanvasUp),document.addEventListener("touchend",this._onAlphaCanvasUp)},writable:!0,configurable:!0},_onAlphaCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._alphaCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(new Vector2(0,0),canvasSize),this._alphaKnob.style.left=""+relativePosition.x+"px",this._value.a=relativePosition.x/canvasSize.x,this._updateColor()},writable:!0,configurable:!0},_onAlphaCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onAlphaCanvasDrag),document.removeEventListener("touchmove",this._onAlphaCanvasDrag),document.removeEventListener("mouseup",this._onAlphaCanvasUp),document.removeEventListener("touchend",this._onAlphaCanvasUp)},writable:!0,configurable:!0},_handleHueKnob:{value:function(){this._hueCanvas.addEventListener("mousedown",this._onHueCanvasDown),this._hueCanvas.addEventListener("touchstart",this._onHueCanvasDown)},writable:!0,configurable:!0},_onHueCanvasDown:{value:function(e){e.preventDefault(),this._onHueCanvasDrag(e),document.addEventListener("mousemove",this._onHueCanvasDrag),document.addEventListener("touchmove",this._onHueCanvasDrag),document.addEventListener("mouseup",this._onHueCanvasUp),document.addEventListener("touchend",this._onHueCanvasUp)},writable:!0,configurable:!0},_onHueCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._hueCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(new Vector2(0,0),canvasSize),this._hueKnob.style.top=""+relativePosition.y+"px",relativePosition.divide(canvasSize),this._hsvColor.h=relativePosition.y,this._updateColor()},writable:!0,configurable:!0},_onHueCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onHueCanvasDrag),document.removeEventListener("touchmove",this._onHueCanvasDrag),document.removeEventListener("mouseup",this._onHueCanvasUp),document.removeEventListener("touchend",this._onHueCanvasUp)},writable:!0,configurable:!0},_handleSaturationKnob:{value:function(){this._saturationCanvas.addEventListener("mousedown",this._onSaturationCanvasDown),this._saturationCanvas.addEventListener("touchstart",this._onSaturationCanvasDown)},writable:!0,configurable:!0},_onSaturationCanvasDown:{value:function(e){e.preventDefault(),this._onSaturationCanvasDrag(e),document.addEventListener("mousemove",this._onSaturationCanvasDrag),document.addEventListener("touchmove",this._onSaturationCanvasDrag),document.addEventListener("mouseup",this._onSaturationCanvasUp),document.addEventListener("touchend",this._onSaturationCanvasUp)},writable:!0,configurable:!0},_onSaturationCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._saturationCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(0,canvas.width),this._saturationKnob.style.left=""+relativePosition.x+"px",this._saturationKnob.style.top=""+relativePosition.y+"px",relativePosition.divide(canvasSize),this._hsvColor.s=relativePosition.x,this._hsvColor.v=1-relativePosition.y,this._updateColor()},writable:!0,configurable:!0},_onSaturationCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onSaturationCanvasDrag),document.removeEventListener("touchmove",this._onSaturationCanvasDrag),document.removeEventListener("mouseup",this._onSaturationCanvasUp),document.removeEventListener("touchend",this._onSaturationCanvasUp)},writable:!0,configurable:!0},_updateColor:{value:function(){this._value.fromHSV(this._hsvColor.h,this._hsvColor.s,this._hsvColor.v),this.emit("update",this._value),this._render()},writable:!0,configurable:!0}}),ColorPicker}(EventEmitter));module.exports=ColorPicker},{"../../../lib/color":44,"../../../lib/event-emitter":45,"../../../lib/math/vector2":49,"../../../lib/utils":51,lodash:"lodash"}],128:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Slider=_interopRequire(require("./slider")),SimpleSlider=function(Slider){function SimpleSlider(){_classCallCheck(this,SimpleSlider),null!=Slider&&Slider.apply(this,arguments)}return _inherits(SimpleSlider,Slider),_prototypeProperties(SimpleSlider,{template:{get:function(){return'{{##def.simpleSlider:\n  <div class="imglykit-slider" id="{{=(typeof sliderId === "undefined"?\'\':sliderId)}}">\n    <div class="imglykit-slider-minus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/minus.png\') }}" />\n    </div>\n    <div class="imglykit-slider-slider">\n      <div class="imglykit-slider-background"></div>\n      <div class="imglykit-slider-fill"></div>\n      <div class="imglykit-slider-dot"></div>\n    </div>\n    <div class="imglykit-slider-plus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/plus.png\') }}" />\n    </div>\n  </div>\n#}}\n'},configurable:!0}},{_setX:{value:function(x){this._dotElement.style.left=""+x+"px",this._fillElement.style.width=""+x+"px"},writable:!0,configurable:!0}}),SimpleSlider}(Slider);module.exports=SimpleSlider},{"./slider":129}],129:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Utils=_interopRequire(require("../../../lib/utils")),_=_interopRequire(require("lodash")),Slider=function(EventEmitter){function Slider(element,options){_classCallCheck(this,Slider),_get(Object.getPrototypeOf(Slider.prototype),"constructor",this).call(this),this._element=element,this._options=_.defaults(options,{minValue:0,maxValue:1,defaultValue:0}),this._value=this._options.defaultValue,this._sliderElement=this._element.querySelector(".imglykit-slider-slider"),this._dotElement=this._element.querySelector(".imglykit-slider-dot"),this._centerDotElement=this._element.querySelector(".imglykit-slider-center-dot"),this._fillElement=this._element.querySelector(".imglykit-slider-fill"),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onCenterDotClick=this._onCenterDotClick.bind(this),this._handleDot()}return _inherits(Slider,EventEmitter),_prototypeProperties(Slider,{template:{get:function(){return'{{##def.slider:\n  <div class="imglykit-slider" id="{{=(typeof sliderId === "undefined"?\'\':sliderId)}}">\n    <div class="imglykit-slider-minus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/minus.png\') }}" />\n    </div>\n    <div class="imglykit-slider-slider">\n      <div class="imglykit-slider-background"></div>\n      <div class="imglykit-slider-fill"></div>\n      <div class="imglykit-slider-center-dot"></div>\n      <div class="imglykit-slider-dot"></div>\n    </div>\n    <div class="imglykit-slider-plus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/plus.png\') }}" />\n    </div>\n  </div>\n#}}\n'},configurable:!0}},{setValue:{value:function(value){this._value=value;var _options=this._options,maxValue=_options.maxValue,minValue=_options.minValue,valueRange=maxValue-minValue,percentage=(value-minValue)/valueRange,sliderWidth=this._sliderElement.offsetWidth;this._setX(sliderWidth*percentage)},writable:!0,configurable:!0},_setX:{value:function(x){this._dotElement.style.left=""+x+"px";var halfSliderWidth=this._sliderElement.offsetWidth/2,relativeX=x-halfSliderWidth;this._fillElement.style.width=""+Math.abs(relativeX)+"px",this._fillElement.style.left=0>relativeX?halfSliderWidth-Math.abs(relativeX)+"px":halfSliderWidth+"px"},writable:!0,configurable:!0},_handleDot:{value:function(){this._dotElement.addEventListener("mousedown",this._onMouseDown),this._dotElement.addEventListener("touchstart",this._onMouseDown),this._centerDotElement&&this._centerDotElement.addEventListener("click",this._onCenterDotClick)},writable:!0,configurable:!0},_onCenterDotClick:{value:function(){this.setValue(this._options.defaultValue),this.emit("update",this._value)},writable:!0,configurable:!0},_onMouseDown:{value:function(e){if("mousedown"!==e.type||0===e.button){e.preventDefault();var mousePosition=Utils.getEventPosition(e);document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("touchmove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),document.addEventListener("touchend",this._onMouseUp);var dotPosition=this._dotElement.getBoundingClientRect(),sliderPosition=this._sliderElement.getBoundingClientRect();this._initialSliderX=dotPosition.left-sliderPosition.left,this._initialMousePosition=mousePosition}},writable:!0,configurable:!0},_onMouseMove:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),halfDotWidth=.5*this._dotElement.offsetWidth,newSliderX=this._initialSliderX+mouseDiff.x+halfDotWidth,sliderWidth=this._sliderElement.offsetWidth;newSliderX=Math.max(0,Math.min(newSliderX,sliderWidth)),this._setX(newSliderX);var _options=this._options,minValue=_options.minValue,maxValue=_options.maxValue,percentage=newSliderX/sliderWidth,value=minValue+(maxValue-minValue)*percentage;this.emit("update",value)},writable:!0,configurable:!0},_onMouseUp:{value:function(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("touchmove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("touchend",this._onMouseUp)},writable:!0,configurable:!0}}),Slider}(EventEmitter);module.exports=Slider},{"../../../lib/event-emitter":45,"../../../lib/utils":51,lodash:"lodash"}],130:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),TopControls=function(EventEmitter){function TopControls(kit,ui){_classCallCheck(this,TopControls),_get(Object.getPrototypeOf(TopControls.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._canvas=this._ui.canvas}return _inherits(TopControls,EventEmitter),_prototypeProperties(TopControls,null,{run:{value:function(){var container=this._ui.container;this._rightControls=container.querySelector(".imglykit-top-controls-right"),this._leftControls=container.querySelector(".imglykit-top-controls-left"),this._undoButton=container.querySelector(".imglykit-undo"),this._zoomIn=container.querySelector(".imglykit-zoom-in"),this._zoomOut=container.querySelector(".imglykit-zoom-out"),this._zoomLevel=container.querySelector(".imglykit-zoom-level-num"),this._handleZoom(),this._handleUndo()},writable:!0,configurable:!0},_handleZoom:{value:function(){this._zoomIn.addEventListener("click",this._onZoomInClick.bind(this)),this._zoomOut.addEventListener("click",this._onZoomOutClick.bind(this)),this.updateZoomLevel()},writable:!0,configurable:!0},_handleUndo:{value:function(){this._undoButton.addEventListener("click",this._undo.bind(this)),this._undo()},writable:!0,configurable:!0},_undo:{value:function(){this.emit("undo")},writable:!0,configurable:!0},updateUndoButton:{value:function(){var history=this._ui.history;this._leftControls.style.display=0===history.length?"none":"block"},writable:!0,configurable:!0},_onZoomInClick:{value:function(e){e.preventDefault(),this.emit("zoom-in"),this.updateZoomLevel()},writable:!0,configurable:!0},_onZoomOutClick:{value:function(e){e.preventDefault(),this.emit("zoom-out"),this.updateZoomLevel()},writable:!0,configurable:!0},showZoom:{value:function(){this._rightControls.style.display="block"},writable:!0,configurable:!0},hideZoom:{value:function(){this._rightControls.style.display="none"},writable:!0,configurable:!0},updateZoomLevel:{value:function(){var zoomLevel=this._canvas.zoomLevel;this._zoomLevel.innerHTML=Math.round(100*zoomLevel)},writable:!0,configurable:!0}}),TopControls}(EventEmitter);module.exports=TopControls},{"../../../lib/event-emitter":45}],131:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_prototypeProperties=function(child,staticProps,instanceProps){staticProps&&Object.defineProperties(child,staticProps),instanceProps&&Object.defineProperties(child.prototype,instanceProps)},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},UI=_interopRequire(require("../base/ui")),Canvas=_interopRequire(require("./lib/canvas")),TopControls=_interopRequire(require("./lib/top-controls")),NightUI=function(UI){function NightUI(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,NightUI),this._operationsMap={},this._template='<div class="imglykit-container">\n  <div class="imglykit-top-controls">\n    <div class="imglykit-top-controls-left">\n      <div class="imglykit-undo">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/undo.png\')}}" />\n        Undo\n      </div>\n    </div>\n    <div class="imglykit-top-controls-right">\n      <div class="imglykit-zoom-fit"></div>\n      <div class="imglykit-zoom-level">Zoom: <span class="imglykit-zoom-level-num">100</span>%</div>\n      <div class="imglykit-zoom-in">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/zoom-in.png\')}}" />\n      </div>\n      <div class="imglykit-zoom-out">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/zoom-out.png\')}}" />\n      </div>\n    </div>\n  </div>\n\n  <div class="imglykit-canvas-container">\n    <div class="imglykit-canvas-inner-container">\n      <canvas class="imglykit-canvas-draggable"></canvas>\n      <div class="imglykit-canvas-controls imglykit-canvas-controls-disabled"></div>\n    </div>\n  </div>\n\n  <div class="imglykit-controls-container">\n    <div class="imglykit-controls">\n\n      <div>\n        <div class="imglykit-controls-overview">\n          <ul class="imglykit-controls-list">\n          {{ for (var identifier in it.controls) { }}\n            {{ var control = it.controls[identifier]; }}\n            <li data-identifier="{{= control.identifier}}">\n              <img src="{{=it.helpers.assetPath(\'ui/night/operations/\' + control.identifier + \'.png\') }}" />\n            </li>\n          {{ } }}\n          </ul>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n',this._registeredControls={},this._history=[],this._preferredOperationOrder=["rotation","crop","flip","filters","contrast","brightness","saturation","radial-blur","tilt-shift","frames","stickers","text"],this._paused=!1,_get(Object.getPrototypeOf(NightUI.prototype),"constructor",this).apply(this,args)}return _inherits(NightUI,UI),_prototypeProperties(NightUI,null,{identifier:{get:function(){return"night"},configurable:!0},run:{value:function(){this._registerControls(),_get(Object.getPrototypeOf(NightUI.prototype),"run",this).call(this);var container=this._options.container;this._controlsContainer=container.querySelector(".imglykit-controls"),this._canvasControlsContainer=container.querySelector(".imglykit-canvas-controls"),this._overviewControlsContainer=container.querySelector(".imglykit-controls-overview"),this._handleOverview(),this._initCanvas(),this._initTopControls(),this._initControls()},writable:!0,configurable:!0},_initTopControls:{value:function(){var _this=this;this._topControls=new TopControls(this._kit,this),this._topControls.run(),this._topControls.on("undo",function(){_this.undo()}),this._topControls.on("zoom-in",function(){_this._canvas.zoomIn().then(function(){_this._currentControl&&_this._currentControl.onZoom()})}),this._topControls.on("zoom-out",function(){_this._canvas.zoomOut().then(function(){_this._currentControl&&_this._currentControl.onZoom()})})},writable:!0,configurable:!0},_initCanvas:{value:function(){var _this=this;this._canvas=new Canvas(this._kit,this,this._options),this._canvas.run(),this._canvas.on("zoom",function(){_this._topControls.updateZoomLevel()})},writable:!0,configurable:!0},selectOperations:{value:function(selector){_get(Object.getPrototypeOf(NightUI.prototype),"selectOperations",this).call(this,selector)},writable:!0,configurable:!0},getOrCreateOperation:{value:function(identifier){var _kit=this._kit,operationsStack=_kit.operationsStack,registeredOperations=_kit.registeredOperations,Operation=registeredOperations[identifier];if("undefined"==typeof this._operationsMap[identifier]){var operationInstance=new Operation(this._kit);this._operationsMap[identifier]=operationInstance;var index=this._preferredOperationOrder.indexOf(identifier);return operationsStack[index]=operationInstance,operationInstance}return this._operationsMap[identifier]},writable:!0,configurable:!0},removeOperation:{value:function(identifier){if(this._operationsMap[identifier]){var operation=this._operationsMap[identifier];delete this._operationsMap[identifier];var index=this._kit.operationsStack.indexOf(operation);this._kit.operationsStack.splice(index,1)
}},writable:!0,configurable:!0},_registerControls:{value:function(){this.registerControl("filters","filters",require("./controls/filters")),this.registerControl("rotation","rotation",require("./controls/rotation")),this.registerControl("flip","flip",require("./controls/flip")),this.registerControl("brightness","brightness",require("./controls/brightness")),this.registerControl("contrast","contrast",require("./controls/contrast")),this.registerControl("saturation","saturation",require("./controls/saturation")),this.registerControl("crop","crop",require("./controls/crop")),this.registerControl("radial-blur","radial-blur",require("./controls/radial-blur")),this.registerControl("tilt-shift","tilt-shift",require("./controls/tilt-shift")),this.registerControl("frames","frames",require("./controls/frames")),this.registerControl("stickers","stickers",require("./controls/stickers")),this.registerControl("text","text",require("./controls/text"))},writable:!0,configurable:!0},_handleOverview:{value:function(){var _this=this,listItems=this._overviewControlsContainer.querySelectorAll(":scope > ul > li");listItems=Array.prototype.slice.call(listItems);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=listItems[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)!function(){var listItem=_step.value,identifier=listItem.dataset.identifier;listItem.addEventListener("click",function(){_this._onOverviewButtonClick(identifier)})}()}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}},writable:!0,configurable:!0},_onOverviewButtonClick:{value:function(identifier){this._overviewControlsContainer.style.display="none",this._currentControl&&this._currentControl.leave(),this._currentControl=this._registeredControls[identifier],this._currentControl.enter(),this._currentControl.once("back",this._switchToOverview.bind(this))},writable:!0,configurable:!0},_switchToOverview:{value:function(){this._currentControl&&this._currentControl.leave(),this._currentControl=null,this._overviewControlsContainer.style.display=""},writable:!0,configurable:!0},registerControl:{value:function(identifier,operationIdentifier,ControlClass){if(this.isOperationSelected(operationIdentifier)){var instance=new ControlClass(this._kit,this);this._registeredControls[identifier]=instance}},writable:!0,configurable:!0},_initControls:{value:function(){for(var identifier in this._registeredControls){var control=this._registeredControls[identifier];control.setContainers(this._controlsContainer,this._canvasControlsContainer),control.init()}},writable:!0,configurable:!0},render:{value:function(){this._canvas.render()},writable:!0,configurable:!0},operations:{get:function(){return this._operationsMap},configurable:!0},controls:{get:function(){return this._registeredControls},configurable:!0},context:{get:function(){var context=_get(Object.getPrototypeOf(NightUI.prototype),"context",this);return context.controls=this._registeredControls,context},configurable:!0},pause:{value:function(){this._paused=!0},writable:!0,configurable:!0},resume:{value:function(){var rerender=void 0===arguments[0]?!0:arguments[0];this._paused=!1,rerender&&this.render()},writable:!0,configurable:!0},addHistory:{value:function(operation,options,existent){this._history.push({operation:operation,options:options,existent:existent}),this._topControls.updateUndoButton()},writable:!0,configurable:!0},hideZoom:{value:function(){this._topControls.hideZoom()},writable:!0,configurable:!0},showZoom:{value:function(){this._topControls.showZoom()},writable:!0,configurable:!0},undo:{value:function(){var lastItem=this._history.pop();if(lastItem){{var operation=lastItem.operation,existent=lastItem.existent;lastItem.options}existent||this.removeOperation(operation.identifier),this.canvas.zoomToFit(!0)}this._topControls.updateUndoButton()},writable:!0,configurable:!0},history:{get:function(){return this._history},configurable:!0}}),NightUI}(UI);module.exports=NightUI},{"../base/ui":112,"./controls/brightness":113,"./controls/contrast":114,"./controls/crop":116,"./controls/filters":117,"./controls/flip":118,"./controls/frames":119,"./controls/radial-blur":120,"./controls/rotation":121,"./controls/saturation":122,"./controls/stickers":123,"./controls/text":124,"./controls/tilt-shift":125,"./lib/canvas":126,"./lib/top-controls":130}],132:[function(require,module){"use strict";function stackBlurCanvasRGBA(imageData,top_x,top_y,width,height,radius){if(!(isNaN(radius)||1>radius)){radius|=0;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs,stackEnd,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;div>i;i++)stack=stack.next=new BlurStack,i==radiusPlus1&&(stackEnd=stack);stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;height>y;y++){for(r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(i=1;radiusPlus1>i;i++)p=yi+((i>widthMinus1?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,a_sum+=(stack.a=pa=pixels[p+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;width>x;x++)pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum,0!==pa?(pa=255/pa,pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa,pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],a_in_sum+=stackIn.a=pixels[p+3],r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,a_sum+=a_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;width>x;x++){for(g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0,yi=x<<2,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(yp=width,i=1;radius>=i;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,a_sum+=(stack.a=pa=pixels[yi+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next,heightMinus1>i&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;height>y;y++)p=yi<<2,pixels[p+3]=pa=a_sum*mul_sum>>shg_sum,pa>0?(pa=255/pa,pixels[p]=(r_sum*mul_sum>>shg_sum)*pa,pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[p]=pixels[p+1]=pixels[p+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],a_sum+=a_in_sum+=stackIn.a=pixels[p+3],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=width}}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];module.exports={stackBlurCanvasRGBA:stackBlurCanvasRGBA}},{}],lodash:[function(require,module,exports){(function(global){"use strict";(function(){function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}function lodash(){}function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return setBindData(bound,bindData),bound}function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;var bindData=func.__bindData__;if("undefined"==typeof bindData&&(support.funcNames&&(bindData=!func.name),bindData=bindData||!support.funcDecomp,!bindData)){var source=fnToString.call(func);support.funcNames||(bindData=!reFuncName.test(source)),bindData||(bindData=reThis.test(source),setBindData(func,bindData))}if(bindData===!1||bindData!==!0&&1&bindData[1])return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return setBindData(bound,bindData),bound}function createWrapper(_x,_x2,_x3,_x4,_x5,_x6){for(var _arguments,_again=!0;_again;){_again=!1;var func=_x,bitmask=_x2,partialArgs=_x3,partialRightArgs=_x4,thisArg=_x5,arity=_x6;isBind=isBindKey=isCurry=isCurryBound=isPartial=isPartialRight=bindData=creater=void 0;var isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var bindData=func&&func.__bindData__;if(!bindData||bindData===!0){var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}bindData=slice(bindData),bindData[2]&&(bindData[2]=slice(bindData[2])),bindData[3]&&(bindData[3]=slice(bindData[3])),!isBind||1&bindData[1]||(bindData[4]=thisArg),!isBind&&1&bindData[1]&&(bitmask|=8),!isCurry||4&bindData[1]||(bindData[5]=arity),isPartial&&push.apply(bindData[2]||(bindData[2]=[]),partialArgs),isPartialRight&&unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs),bindData[1]|=bitmask,_arguments=bindData,_x=_arguments[0],_x2=_arguments[1],_x3=_arguments[2],_x4=_arguments[3],_x5=_arguments[4],_x6=_arguments[5],_again=!0}}function createIterator(){iteratorData.shadowedProps=shadowedProps,iteratorData.array=iteratorData.bottom=iteratorData.loop=iteratorData.top="",iteratorData.init="iterable",iteratorData.useHas=!0;for(var object,index=0;object=arguments[index];index++)for(var key in object)iteratorData[key]=object[key];var args=iteratorData.args;iteratorData.firstArg=/^[^,]+/.exec(args)[0];var factory=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+args+") {\n"+iteratorTemplate(iteratorData)+"\n}");return factory(baseCreateCallback,errorClass,errorProto,hasOwnProperty,indicatorObject,isArguments,isArray,isString,iteratorData.keys,objectProto,objectTypes,nonEnumProps,stringClass,stringProto,toString)}function isNative(value){return"function"==typeof value&&reNative.test(value)}function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}function isFunction(value){return"function"==typeof value}function isObject(value){return!(!value||!objectTypes[typeof value])}function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}function identity(value){return value}function noop(){}var indicatorObject={},reFuncName=/^\s*function[ \n\r\t]+\w/,reThis=/\bthis\b/,shadowedProps=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",errorClass="[object Error]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",descriptor={configurable:!1,enumerable:!1,value:null,writable:!1},iteratorData={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var arrayRef=[],errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,unshift=arrayRef.unshift,defineProperty=function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func}catch(e){}return result}(),nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nonEnumProps={};nonEnumProps[arrayClass]=nonEnumProps[dateClass]=nonEnumProps[numberClass]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},nonEnumProps[boolClass]=nonEnumProps[stringClass]={constructor:!0,toString:!0,valueOf:!0},nonEnumProps[errorClass]=nonEnumProps[funcClass]=nonEnumProps[regexpClass]={constructor:!0,toString:!0},nonEnumProps[objectClass]={constructor:!0},function(){for(var length=shadowedProps.length;length--;){var key=shadowedProps[length];for(var className in nonEnumProps)hasOwnProperty.call(nonEnumProps,className)&&!hasOwnProperty.call(nonEnumProps[className],key)&&(nonEnumProps[className][key]=!1)}}();var support=lodash.support={};!function(){var ctor=function(){this.x=1},object={0:1,length:1},props=[];ctor.prototype={valueOf:1,y:1};for(var key in new ctor)props.push(key);for(key in arguments);support.argsClass=toString.call(arguments)==argsClass,support.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),support.enumErrorProps=propertyIsEnumerable.call(errorProto,"message")||propertyIsEnumerable.call(errorProto,"name"),support.enumPrototypes=propertyIsEnumerable.call(ctor,"prototype"),support.funcDecomp=!isNative(root.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name,support.nonEnumArgs=0!=key,support.nonEnumShadows=!/valueOf/.test(props),support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0]),support.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1);var iteratorTemplate=function(obj){var __p="var index, iterable = "+obj.firstArg+", result = "+obj.init+";\nif (!iterable) return result;\n"+obj.top+";";obj.array?(__p+="\nvar length = iterable.length; index = -1;\nif ("+obj.array+") {  ",support.unindexedChars&&(__p+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),__p+="\n  while (++index < length) {\n    "+obj.loop+";\n  }\n}\nelse {  "):support.nonEnumArgs&&(__p+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+obj.loop+";\n    }\n  } else {  "),support.enumPrototypes&&(__p+="\n  var skipProto = typeof iterable == 'function';\n  "),support.enumErrorProps&&(__p+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var conditions=[];if(support.enumPrototypes&&conditions.push('!(skipProto && index == "prototype")'),support.enumErrorProps&&conditions.push('!(skipErrorProps && (index == "message" || index == "name"))'),obj.useHas&&obj.keys)__p+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",conditions.length&&(__p+="    if ("+conditions.join(" && ")+") {\n  "),__p+=obj.loop+";    ",conditions.length&&(__p+="\n    }"),__p+="\n  }  ";else if(__p+="\n  for (index in iterable) {\n",obj.useHas&&conditions.push("hasOwnProperty.call(iterable, index)"),conditions.length&&(__p+="    if ("+conditions.join(" && ")+") {\n  "),__p+=obj.loop+";    ",conditions.length&&(__p+="\n    }"),__p+="\n  }    ",support.nonEnumShadows){for(__p+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)__p+="\n    index = '"+obj.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",obj.useHas||(__p+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),__p+=") {\n      "+obj.loop+";\n    }      ";__p+="\n  }    "}return(obj.array||support.nonEnumArgs)&&(__p+="\n}"),__p+=obj.bottom+";\nreturn result"};nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||root.Object()}}());var setBindData=defineProperty?function(func,value){descriptor.value=value,defineProperty(func,"__bindData__",descriptor)}:noop;support.argsClass||(isArguments=function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1},shimKeys=createIterator({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),keys=nativeKeys?function(object){return isObject(object)?support.enumPrototypes&&"function"==typeof object||support.nonEnumArgs&&object.length&&isArguments(object)?shimKeys(object):nativeKeys(object):[]}:shimKeys,defaultsIteratorOptions={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:keys,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},assign=createIterator(defaultsIteratorOptions,{top:defaultsIteratorOptions.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),defaults=createIterator(defaultsIteratorOptions);isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&toString.call(value)==funcClass}),lodash.assign=assign,lodash.bind=bind,lodash.defaults=defaults,lodash.keys=keys,lodash.extend=assign,lodash.identity=identity,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isFunction=isFunction,lodash.isObject=isObject,lodash.isString=isString,lodash.noop=noop,lodash.VERSION="2.4.1","function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=lodash,define(function(){return lodash})):freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}).call(void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);